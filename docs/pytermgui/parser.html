<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>pytermgui.parser API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pytermgui.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pytermgui</a>

            <img src="https://github.com/bczsalba/pytermgui/blob/master/assets/title.png?raw=true" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#basic-rundown">Basic rundown</a></li>
  <li><a href="#general-syntax">General syntax</a></li>
  <li><a href="#markuplanguage-and-instancing"><code>MarkupLanguage</code> and instancing</a></li>
  <li><a href="#caching">Caching</a></li>
  <li><a href="#customization">Customization</a></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#StyledText">StyledText</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StyledText.__init__">StyledText</a>
                        </li>
                        <li>
                                <a class="variable" href="#StyledText.value">value</a>
                        </li>
                        <li>
                                <a class="variable" href="#StyledText.tokens">tokens</a>
                        </li>
                        <li>
                                <a class="variable" href="#StyledText.plain">plain</a>
                        </li>
                        <li>
                                <a class="function" href="#StyledText.plain_index">plain_index</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#MacroCallable">MacroCallable</a>
            </li>
            <li>
                    <a class="variable" href="#MacroCall">MacroCall</a>
            </li>
            <li>
                    <a class="class" href="#MarkupLanguage">MarkupLanguage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MarkupLanguage.__init__">MarkupLanguage</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkupLanguage.raise_unknown_markup">raise_unknown_markup</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.print">print</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.tokenize_markup">tokenize_markup</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.tokenize_ansi">tokenize_ansi</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.define">define</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.alias">alias</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.parse">parse</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.get_markup">get_markup</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.prettify_ansi">prettify_ansi</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.prettify_markup">prettify_markup</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkupLanguage.get_styled_plains">get_styled_plains</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#markup">markup</a>
            </li>
            <li>
                    <a class="variable" href="#tim">tim</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pytermgui.html">pytermgui</a><wbr>.parser    </h1>

                        <div class="docstring"><p>This module provides <code>TIM</code>, PyTermGUI's Terminal Inline Markup language. It is a simple,
performant and easy to read way to style, colorize &amp; modify text.</p>

<h2 id="basic-rundown">Basic rundown</h2>

<p>TIM is included with the purpose of making styling easier to read and manage.</p>

<p>Its syntax is based on square brackets, within which tags are strictly separated by one
space character. Tags can stand for colors (xterm-256, RGB or HEX, both background &amp;
foreground), styles, unsetters and macros.</p>

<p>The 16 simple colors of the terminal exist as named tags that refer to their numerical
value.</p>

<p>Here is a simple example of the syntax, using the <code><a href="pretty.html">pytermgui.pretty</a></code> submodule to
syntax-highlight it inside the REPL:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pytermgui</span> <span class="kn">import</span> <span class="n">pretty</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s1">&#39;[141 @61 bold] Hello [!upper inverse] There &#39;</span>
</code></pre></div>

<p align=center>
<img src="https://github.com/bczsalba/pytermgui/blob/master/assets/docs/parser/simple_example.png?raw=true" width=70%>
</p>

<h2 id="general-syntax">General syntax</h2>

<p>Background colors are always denoted by a leading <code>@</code> character in front of the color
tag. Styles are just the name of the style and macros have an exclamation mark in front
of them. Additionally, unsetters use a leading slash (<code>/</code>) for their syntax. Color
tokens have special unsetters: they use <code>/fg</code> to cancel foreground colors, and <code>/bg</code> to
do so with backgrounds.</p>

<h3 id="macros">Macros:</h3>

<p>Macros are any type of callable that take at least *args; this is the value of the plain
text enclosed by the tag group within which the given macro resides. Additionally,
macros can be given any number of positional arguments from within markup, using the
syntax:</p>

<pre><code>[!macro(arg1:arg2:arg3)]Text that the macro applies to.[/!macro]plain text, no macro
</code></pre>

<p>This syntax gets parsed as follows:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">macro</span><span class="p">(</span><span class="s2">&quot;Text that the macro applies to.&quot;</span><span class="p">,</span> <span class="s2">&quot;arg1&quot;</span><span class="p">,</span> <span class="s2">&quot;arg2&quot;</span><span class="p">,</span> <span class="s2">&quot;arg3&quot;</span><span class="p">)</span>
</code></pre></div>

<p><code>macro</code> here is whatever the name <code>macro</code> was defined as prior.</p>

<h3 id="colors">Colors:</h3>

<p>Colors can be of three general types: xterm-256, RGB and HEX.</p>

<p><code>xterm-256</code> stands for one of the 256 xterm colors. You can use <code>ptg -c</code> to see the all
of the available colors. Its syntax is just the 0-base index of the color, like <code>[141]</code></p>

<p><code>RGB</code> colors are pretty self explanatory. Their syntax is follows the format
<code>RED;GREEN;BLUE</code>, such as <code>[111;222;333]</code>.</p>

<p><code>HEX</code> colors are basically just RGB with extra steps. Their syntax is <code>#RRGGBB</code>, such as
<code>[#FA72BF]</code>. This code then gets converted to a tuple of RGB colors under the hood, so
from then on RGB and HEX colors are treated the same, and emit the same tokens.</p>

<p>As mentioned above, all colors can be made to act on the background instead by
prepending the color tag with <code>@</code>, such as <code>@141</code>, <code>@111;222;333</code> or <code>@#FA72BF</code>. To
clear these effects, use <code>/fg</code> for foreground and <code>/bg</code> for background colors.</p>

<h2 id="markuplanguage-and-instancing"><code><a href="#MarkupLanguage">MarkupLanguage</a></code> and instancing</h2>

<p>All markup behaviour is done by an instance of the <code><a href="#MarkupLanguage">MarkupLanguage</a></code> class. This is done
partially for organization reasons, but also to allow a sort of sandboxing of custom
definitions and settings.</p>

<p>PyTermGUI provides the <code><a href="#tim">tim</a></code> name as the global markup language instance. For historical
reasons, the same instance is available as <code><a href="#markup">markup</a></code>. This should be used pretty much all
of the time, and custom instances should only ever come about when some
security-sensitive macro definitions are needed, as <code><a href="#markup">markup</a></code> is used by every widget,
including user-input ones such as <code>InputField</code>.</p>

<p>For the rest of this page, <code><a href="#MarkupLanguage">MarkupLanguage</a></code> will refer to whichever instance you are
using.</p>

<p>TL;DR : Use <code><a href="#tim">tim</a></code> always, unless a security concern blocks you from doing so.</p>

<h2 id="caching">Caching</h2>

<p>By default, all markup parse results are cached and returned when the same input is
given. To disable this behaviour, set your markup instance (usually <code><a href="#markup">markup</a></code>)'s
<code>should_cache</code> field to False.</p>

<h2 id="customization">Customization</h2>

<p>There are a couple of ways to customize how markup is parsed. Custom tags can be created
by calling <code><a href="#MarkupLanguage.alias">MarkupLanguage.alias</a></code>. For defining custom macros, you can use
<code><a href="#MarkupLanguage.define">MarkupLanguage.define</a></code>. For more information, see each method's documentation.</p>
</div>

                        <input id="parser-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="parser-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">This module provides `TIM`, PyTermGUI&#39;s Terminal Inline Markup language. It is a simple,</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">performant and easy to read way to style, colorize &amp; modify text.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">Basic rundown</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">-------------</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">TIM is included with the purpose of making styling easier to read and manage.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">Its syntax is based on square brackets, within which tags are strictly separated by one</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">space character. Tags can stand for colors (xterm-256, RGB or HEX, both background &amp;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">foreground), styles, unsetters and macros.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">The 16 simple colors of the terminal exist as named tags that refer to their numerical</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">value.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">Here is a simple example of the syntax, using the `pytermgui.pretty` submodule to</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">syntax-highlight it inside the REPL:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">```python3</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">&gt;&gt;&gt; from pytermgui import pretty</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">&gt;&gt;&gt; &#39;[141 @61 bold] Hello [!upper inverse] There &#39;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">```</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">&lt;p align=center&gt;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">&lt;img src=&quot;https://github.com/bczsalba/pytermgui/blob/master/assets/docs/parser/\</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">simple_example.png?raw=true&quot; width=70%&gt;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">&lt;/p&gt;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">General syntax</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">--------------</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">Background colors are always denoted by a leading `@` character in front of the color</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">tag. Styles are just the name of the style and macros have an exclamation mark in front</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">of them. Additionally, unsetters use a leading slash (`/`) for their syntax. Color</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">tokens have special unsetters: they use `/fg` to cancel foreground colors, and `/bg` to</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">do so with backgrounds.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">### Macros:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">Macros are any type of callable that take at least *args; this is the value of the plain</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">text enclosed by the tag group within which the given macro resides. Additionally,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">macros can be given any number of positional arguments from within markup, using the</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">syntax:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">```</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">[!macro(arg1:arg2:arg3)]Text that the macro applies to.[/!macro]plain text, no macro</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">```</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">This syntax gets parsed as follows:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">```python3</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">macro(&quot;Text that the macro applies to.&quot;, &quot;arg1&quot;, &quot;arg2&quot;, &quot;arg3&quot;)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">```</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">`macro` here is whatever the name `macro` was defined as prior.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">### Colors:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">Colors can be of three general types: xterm-256, RGB and HEX.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">`xterm-256` stands for one of the 256 xterm colors. You can use `ptg -c` to see the all</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">of the available colors. Its syntax is just the 0-base index of the color, like `[141]`</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">`RGB` colors are pretty self explanatory. Their syntax is follows the format</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">`RED;GREEN;BLUE`, such as `[111;222;333]`.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">`HEX` colors are basically just RGB with extra steps. Their syntax is `#RRGGBB`, such as</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">`[#FA72BF]`. This code then gets converted to a tuple of RGB colors under the hood, so</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">from then on RGB and HEX colors are treated the same, and emit the same tokens.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">As mentioned above, all colors can be made to act on the background instead by</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">prepending the color tag with `@`, such as `@141`, `@111;222;333` or `@#FA72BF`. To</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">clear these effects, use `/fg` for foreground and `/bg` for background colors.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">`MarkupLanguage` and instancing</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">-------------------------------</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">All markup behaviour is done by an instance of the `MarkupLanguage` class. This is done</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">partially for organization reasons, but also to allow a sort of sandboxing of custom</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">definitions and settings.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">PyTermGUI provides the `tim` name as the global markup language instance. For historical</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">reasons, the same instance is available as `markup`. This should be used pretty much all</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">of the time, and custom instances should only ever come about when some</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">security-sensitive macro definitions are needed, as `markup` is used by every widget,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">including user-input ones such as `InputField`.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">For the rest of this page, `MarkupLanguage` will refer to whichever instance you are</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">using.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">TL;DR : Use `tim` always, unless a security concern blocks you from doing so.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">Caching</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">-------</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">By default, all markup parse results are cached and returned when the same input is</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">given. To disable this behaviour, set your markup instance (usually `markup`)&#39;s</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">`should_cache` field to False.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">Customization</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">-------------</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">There are a couple of ways to customize how markup is parsed. Custom tags can be created</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">by calling `MarkupLanguage.alias`. For defining custom macros, you can use</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">`MarkupLanguage.define`. For more information, see each method&#39;s documentation.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="c1"># pylint: disable=too-many-lines</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">suppress</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">auto</span> <span class="k">as</span> <span class="n">_auto</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cached_property</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="kn">from</span> <span class="nn">.colors</span> <span class="kn">import</span> <span class="n">Color</span><span class="p">,</span> <span class="n">StandardColor</span><span class="p">,</span> <span class="n">str_to_color</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">AnsiSyntaxError</span><span class="p">,</span> <span class="n">ColorSyntaxError</span><span class="p">,</span> <span class="n">MarkupSyntaxError</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="kn">from</span> <span class="nn">.regex</span> <span class="kn">import</span> <span class="n">RE_ANSI</span><span class="p">,</span> <span class="n">RE_LINK</span><span class="p">,</span> <span class="n">RE_MACRO</span><span class="p">,</span> <span class="n">RE_MARKUP</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="kn">from</span> <span class="nn">.terminal</span> <span class="kn">import</span> <span class="n">get_terminal</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="s2">&quot;StyledText&quot;</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="s2">&quot;MacroCallable&quot;</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="s2">&quot;MacroCall&quot;</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="s2">&quot;MarkupLanguage&quot;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="s2">&quot;markup&quot;</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="s2">&quot;tim&quot;</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="p">]</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="n">MacroCallable</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="n">MacroCall</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">MacroCallable</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="n">STYLE_MAP</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="s2">&quot;bold&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="s2">&quot;dim&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="s2">&quot;italic&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="s2">&quot;underline&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="s2">&quot;blink&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>    <span class="s2">&quot;blink2&quot;</span><span class="p">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="s2">&quot;inverse&quot;</span><span class="p">:</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="s2">&quot;invisible&quot;</span><span class="p">:</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="s2">&quot;strikethrough&quot;</span><span class="p">:</span> <span class="s2">&quot;9&quot;</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="s2">&quot;overline&quot;</span><span class="p">:</span> <span class="s2">&quot;53&quot;</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="p">}</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="n">UNSETTER_MAP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>    <span class="s2">&quot;/bold&quot;</span><span class="p">:</span> <span class="s2">&quot;22&quot;</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="s2">&quot;/dim&quot;</span><span class="p">:</span> <span class="s2">&quot;22&quot;</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="s2">&quot;/italic&quot;</span><span class="p">:</span> <span class="s2">&quot;23&quot;</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>    <span class="s2">&quot;/underline&quot;</span><span class="p">:</span> <span class="s2">&quot;24&quot;</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="s2">&quot;/blink&quot;</span><span class="p">:</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="s2">&quot;/blink2&quot;</span><span class="p">:</span> <span class="s2">&quot;26&quot;</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="s2">&quot;/inverse&quot;</span><span class="p">:</span> <span class="s2">&quot;27&quot;</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="s2">&quot;/invisible&quot;</span><span class="p">:</span> <span class="s2">&quot;28&quot;</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="s2">&quot;/strikethrough&quot;</span><span class="p">:</span> <span class="s2">&quot;29&quot;</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>    <span class="s2">&quot;/fg&quot;</span><span class="p">:</span> <span class="s2">&quot;39&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="s2">&quot;/bg&quot;</span><span class="p">:</span> <span class="s2">&quot;49&quot;</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="s2">&quot;/overline&quot;</span><span class="p">:</span> <span class="s2">&quot;54&quot;</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="p">}</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="k">def</span> <span class="nf">macro_align</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="sd">&quot;&quot;&quot;Aligns given text using fstrings.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">    Args:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        width: The width to align to.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        alignment: One of &quot;left&quot;, &quot;center&quot;, &quot;right&quot;.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">        content: The content to align; implicit argument.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="n">aligner</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;&gt;&quot;</span> <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span> <span class="k">else</span> <span class="s2">&quot;^&quot;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">content</span><span class="si">:{</span><span class="n">aligner</span><span class="si">}{</span><span class="n">width</span><span class="si">}}</span><span class="s2">&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="k">def</span> <span class="nf">macro_expand</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span> <span class="n">MarkupLanguage</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="sd">&quot;&quot;&quot;Expands a tag alias.&quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">lang</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="k">return</span> <span class="n">tag</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="k">return</span> <span class="n">lang</span><span class="o">.</span><span class="n">get_markup</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">lang</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="si">}</span><span class="s2">m &quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="k">def</span> <span class="nf">macro_strip_fg</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>    <span class="sd">&quot;&quot;&quot;Strips foreground color from item&quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[/fg]</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="k">def</span> <span class="nf">macro_strip_bg</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="sd">&quot;&quot;&quot;Strips foreground color from item&quot;&quot;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>    <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[/bg]</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="k">def</span> <span class="nf">macro_shuffle</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>    <span class="sd">&quot;&quot;&quot;Shuffles a string using shuffle.shuffle on its list cast.&quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>    <span class="n">shuffled</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>    <span class="n">shuffle</span><span class="p">(</span><span class="n">shuffled</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shuffled</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="k">def</span> <span class="nf">macro_link</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>    <span class="sd">&quot;&quot;&quot;Creates a clickable hyperlink.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    Note:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Since this is a pretty new feature for terminals, its support is limited.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>    <span class="o">*</span><span class="n">uri_parts</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uri_parts</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">]8;;</span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="se">\x1b\\</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\x1b</span><span class="s2">]8;;</span><span class="se">\x1b\\</span><span class="s2">&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="k">def</span> <span class="nf">_apply_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>    <span class="sd">&quot;&quot;&quot;Applies the given list of colors to the item, spread out evenly.&quot;&quot;&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="n">blocksize</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="n">current_block</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">blocksize</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current_block</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="n">current_block</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="n">current_block</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">out</span> <span class="o">+=</span> <span class="n">char</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>    <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="k">def</span> <span class="nf">macro_rainbow</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>    <span class="sd">&quot;&quot;&quot;Creates rainbow-colored text.&quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;208&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;brightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;93&quot;</span><span class="p">]</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="k">return</span> <span class="n">_apply_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="k">def</span> <span class="nf">macro_gradient</span><span class="p">(</span><span class="n">base_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>    <span class="sd">&quot;&quot;&quot;Creates an xterm-256 gradient from a base color.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">    This exploits the way the colors are arranged in the xterm color table; every</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    36th color is the next item of a single gradient.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">    The start of this given gradient is calculated by decreasing the given base by 36 on</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">    every iteration as long as the point is a valid gradient start.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">    After that, the 6 colors of this gradient are calculated and applied.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">base_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gradient base has to be a digit, got </span><span class="si">{</span><span class="n">base_str</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="n">base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_str</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="ow">or</span> <span class="n">base</span> <span class="o">&gt;</span> <span class="mi">231</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gradient base must be between 16 and 232&quot;</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">while</span> <span class="n">base</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="n">base</span> <span class="o">-=</span> <span class="mi">36</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>    <span class="k">return</span> <span class="n">_apply_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="k">class</span> <span class="nc">TokenType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="sd">&quot;&quot;&quot;An Enum to store various token types.&quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>    <span class="n">LINK</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>    <span class="sd">&quot;&quot;&quot;A terminal hyperlink.&quot;&quot;&quot;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="n">PLAIN</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>    <span class="sd">&quot;&quot;&quot;Plain text, nothing interesting.&quot;&quot;&quot;</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>    <span class="n">COLOR</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>    <span class="sd">&quot;&quot;&quot;A color token. Has a `pytermgui.colors.Color` instance as its data.&quot;&quot;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>    <span class="n">STYLE</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>    <span class="sd">&quot;&quot;&quot;A builtin terminal style, such as `bold` or `italic`.&quot;&quot;&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="n">MACRO</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="sd">&quot;&quot;&quot;A PTG markup macro. The macro itself is stored inside `self.data`.&quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>    <span class="n">ESCAPED</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>    <span class="sd">&quot;&quot;&quot;An escaped token.&quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="n">UNSETTER</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="sd">&quot;&quot;&quot;A token that unsets some other attribute.&quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="n">POSITION</span> <span class="o">=</span> <span class="n">_auto</span><span class="p">()</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="sd">&quot;&quot;&quot;A token representing a positioning string. `self.data` follows the format `x,y`.&quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="nd">@dataclass</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="k">class</span> <span class="nc">Token</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="sd">&quot;&quot;&quot;A class holding information on a singular markup or ANSI style unit.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">    Attributes:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>    <span class="n">ttype</span><span class="p">:</span> <span class="n">TokenType</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>    <span class="sd">&quot;&quot;&quot;The type of this token.&quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">MacroCall</span> <span class="o">|</span> <span class="n">Color</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="sd">&quot;&quot;&quot;The data contained within this token. This changes based on the `ttype` attr.&quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;unnamed-token&gt;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>    <span class="sd">&quot;&quot;&quot;An optional display name of the token. Defaults to `data` when not given.&quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="sd">&quot;&quot;&quot;Sets `name` to `data` if not provided.&quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&lt;unnamed-token&gt;&quot;</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="c1"># Create LINK from a plain token</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="n">link_match</span> <span class="o">=</span> <span class="n">RE_LINK</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="k">if</span> <span class="n">link_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">link_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">LINK</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="sd">&quot;&quot;&quot;Checks equality with `other`.&quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="nd">@cached_property</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="k">def</span> <span class="nf">sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="sd">&quot;&quot;&quot;Returns the ANSI sequence this token represents.&quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">]:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">LINK</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>            <span class="k">return</span> <span class="n">macro_link</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">H&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="c1"># Colors and styles</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">]:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">m&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="k">class</span> <span class="nc">StyledText</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="sd">&quot;&quot;&quot;A styled text object.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">    The purpose of this class is to implement some things regular `str`</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">    breaks at when encountering ANSI sequences.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">    Instances of this class are usually spat out by `MarkupLanguage.parse`,</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">    but may be manually constructed if the need arises. Everything works even</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    if there is no ANSI tomfoolery going on.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="sd">&quot;&quot;&quot;The underlying, ANSI-inclusive string value.&quot;&quot;&quot;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="n">_plain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="n">_tokens</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="sd">&quot;&quot;&quot;Creates a StyledText, gets markup tags.&quot;&quot;&quot;</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="k">return</span> <span class="n">obj</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="k">def</span> <span class="nf">_generate_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="sd">&quot;&quot;&quot;Generates self._tokens &amp; self._plain.&quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tim</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                <span class="k">continue</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>    <span class="nd">@property</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>    <span class="k">def</span> <span class="nf">tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="sd">&quot;&quot;&quot;Returns all markup tokens of this object.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        Generated on-demand, at the first call to this or the self.plain</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        property.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_tokens</span><span class="p">()</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>    <span class="nd">@property</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>    <span class="k">def</span> <span class="nf">plain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="sd">&quot;&quot;&quot;Returns the value of this object, with no ANSI sequences.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">        Generated on-demand, at the first call to this or the self.tokens</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        property.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_tokens</span><span class="p">()</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="k">def</span> <span class="nf">plain_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="sd">&quot;&quot;&quot;Finds given index inside plain text.&quot;&quot;&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="n">styled_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="n">plain_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">tokens</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                <span class="k">continue</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                <span class="n">styled_chars</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                <span class="k">continue</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                <span class="k">if</span> <span class="n">plain_chars</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                    <span class="k">if</span> <span class="n">negative_index</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">plain_chars</span> <span class="o">+</span> <span class="n">styled_chars</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                    <span class="k">return</span> <span class="n">styled_chars</span> <span class="o">+</span> <span class="n">plain_chars</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="n">plain_chars</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="sd">&quot;&quot;&quot;Gets &quot;real&quot; length of object.&quot;&quot;&quot;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscript</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="sd">&quot;&quot;&quot;Gets an item, adjusted for non-plain text.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">        Args:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">            subscript: The integer or slice to find.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        Returns:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            The elements described by the subscript.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        Raises:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">            IndexError: The given index is out of range.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="n">plain_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="k">if</span> <span class="n">plain_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;StyledText index out of range&quot;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">plain_index</span><span class="p">]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="nb">slice</span><span class="p">(</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="o">.</span><span class="n">start</span><span class="p">),</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="n">subscript</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="p">]</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="k">class</span> <span class="nc">MarkupLanguage</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="sd">&quot;&quot;&quot;A class representing an instance of a Markup Language.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">    This class is used for all markup/ANSI parsing, tokenizing and usage.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">    ```python3</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">    from pytermgui import tim</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">    tim.alias(&quot;my-tag&quot;, &quot;@152 72 bold&quot;)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">    tim.print(&quot;This is [my-tag]my-tag[/]!&quot;)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">    ```</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">    &lt;p style=&quot;text-align: center&quot;&gt;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        &lt;img src=&quot;https://raw.githubusercontent.com/bczsalba/pytermgui/master/assets/\</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">docs/parser/markup_language.png&quot;</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        style=&quot;width: 80%&quot;&gt;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">    &lt;/p&gt;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="n">raise_unknown_markup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>    <span class="sd">&quot;&quot;&quot;Raise `pytermgui.exceptions.MarkupSyntaxError` when encountering unknown markup tags.&quot;&quot;&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_macros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="sd">&quot;&quot;&quot;Initializes a MarkupLanguage.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        Args:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">            default_macros: If not set, the builtin macros are not defined.</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">STYLE_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCallable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNSETTER_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="n">default_macros</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!link&quot;</span><span class="p">,</span> <span class="n">macro_link</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!align&quot;</span><span class="p">,</span> <span class="n">macro_align</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!markup&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_markup</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!shuffle&quot;</span><span class="p">,</span> <span class="n">macro_shuffle</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_bg&quot;</span><span class="p">,</span> <span class="n">macro_strip_bg</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_fg&quot;</span><span class="p">,</span> <span class="n">macro_strip_fg</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!rainbow&quot;</span><span class="p">,</span> <span class="n">macro_rainbow</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!gradient&quot;</span><span class="p">,</span> <span class="n">macro_gradient</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!upper&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!lower&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!title&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">()))</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!capitalize&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()))</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!expand&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tag</span><span class="p">:</span> <span class="n">macro_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!debug&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ascii</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">))</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;dim @black&quot;</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.str&quot;</span><span class="p">,</span> <span class="s2">&quot;142&quot;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.multiline_str&quot;</span><span class="p">,</span> <span class="s2">&quot;code.str&quot;</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.none&quot;</span><span class="p">,</span> <span class="s2">&quot;167&quot;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.global&quot;</span><span class="p">,</span> <span class="s2">&quot;214&quot;</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.number&quot;</span><span class="p">,</span> <span class="s2">&quot;175&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.keyword&quot;</span><span class="p">,</span> <span class="s2">&quot;203&quot;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.identifier&quot;</span><span class="p">,</span> <span class="s2">&quot;109&quot;</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.name&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.comment&quot;</span><span class="p">,</span> <span class="s2">&quot;240 italic&quot;</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.builtin&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.file&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>    <span class="k">def</span> <span class="nf">_get_color_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="sd">&quot;&quot;&quot;Tries to get a color token from the given tag.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">        Args:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">            tag: The tag to parse.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        Returns:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">            A color token if the given tag could be parsed into one, else None.</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="n">str_to_color</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">except</span> <span class="n">ColorSyntaxError</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>    <span class="k">def</span> <span class="nf">_get_style_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="sd">&quot;&quot;&quot;Tries to get a style (including unsetter) token from tags, user tags and unsetters.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        Args:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">            tag: The tag to parse.</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        Returns:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">            A `Token` if one could be created, None otherwise.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="sd">&quot;&quot;&quot;Parse all arguments and pass them through to print, along with kwargs.&quot;&quot;&quot;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="n">parsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="n">get_terminal</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">parsed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>    <span class="k">def</span> <span class="nf">tokenize_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given markup string into an iterator of `Token`.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Args:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">            markup_text: The text to look at.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        Returns:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">            on memory.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_MARKUP</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="n">full</span><span class="p">,</span> <span class="n">escapes</span><span class="p">,</span> <span class="n">tag_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="c1"># Add plain text between last and current match</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">escapes</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:])</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>                <span class="k">continue</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_style_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                    <span class="k">continue</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                <span class="c1"># Try to find a color token</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_color_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                    <span class="k">continue</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                <span class="k">if</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                    <span class="n">macro_args</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                        <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                            <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;is not a defined macro&quot;</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                            <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span><span class="p">,</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                        <span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                    <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                        <span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                        <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                        <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">macro_args</span><span class="p">),</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                    <span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                    <span class="k">continue</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_unknown_markup</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                    <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not defined&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                    <span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="c1"># Add remaining text as plain</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markup_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:])</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="k">def</span> <span class="nf">tokenize_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given ANSI string into an iterator of `Token`.</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        Args:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">            ansi: The text to look at.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        Returns:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            on memory.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        <span class="k">def</span> <span class="nf">_is_in_tags</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>            <span class="sd">&quot;&quot;&quot;Determines whether a code is in the given dict of tags.&quot;&quot;&quot;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">code</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                    <span class="k">return</span> <span class="n">name</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="k">def</span> <span class="nf">_generate_color</span><span class="p">(</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="n">parts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenType</span><span class="p">,</span> <span class="n">Color</span><span class="p">]:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="sd">&quot;&quot;&quot;Generates a color token.&quot;&quot;&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">Color</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">StandardColor</span><span class="o">.</span><span class="n">from_ansi</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">str_to_color</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="c1"># StyledText messes with indexing, so we need to cast it</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="c1"># back to str.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ansi</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="n">ansi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ansi</span><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_ANSI</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                <span class="k">continue</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">plain</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">code</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="n">ttype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="c1"># Styles &amp; Unsetters</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="c1"># Covariancy is not an issue here, even though mypy seems to think so.</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                        <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="c1"># Colors</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="k">if</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">ColorSyntaxError</span><span class="p">):</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_generate_color</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="k">raise</span> <span class="n">AnsiSyntaxError</span><span class="p">(</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not recognized&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ansi</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                    <span class="p">)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">ttype</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:]</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">MacroCallable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="sd">&quot;&quot;&quot;Defines a Macro tag that executes the given method.</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">        Args:</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">            name: The name the given method will be reachable by within markup.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">                The given value gets &quot;!&quot; prepended if it isn&#39;t present already.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            method: The method this macro will execute.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;!</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>    <span class="k">def</span> <span class="nf">alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="sd">&quot;&quot;&quot;Aliases the given name to a value, and generates an unsetter for it.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">        Note that it is not possible to alias macros.</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">        Args:</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">            name: The name of the new tag.</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">            value: The value the new tag will stand for.</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">def</span> <span class="nf">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="sd">&quot;&quot;&quot;Get unsetter for a token&quot;&quot;&quot;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/bg&quot;</span><span class="p">]</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/fg&quot;</span><span class="p">]</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find unsetter for token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only macro tags can always start with &quot;!&quot;.&#39;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="n">setter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="n">unsetter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="c1"># Try to link to existing tag</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="k">return</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">):</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                <span class="k">continue</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="n">setter</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">t_unsetter</span> <span class="o">=</span> <span class="n">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="n">unsetter</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">t_unsetter</span><span class="si">}</span><span class="s2">m&quot;</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unsetter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">setter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="n">marked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="n">marked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="c1"># TODO: I cannot cut down the one-too-many branch that this has at the moment.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="c1">#       We could look into it in the future, however.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-branches</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StyledText</span><span class="p">:</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="sd">&quot;&quot;&quot;Parses the given markup.</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">        Args:</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">            markup_text: The markup to parse.</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">        Returns:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">            A `StyledText` instance of the result of parsing the input. This</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">            custom `str` class is used to allow accessing the plain value of</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">            the output, as well as to cleanly index within it. It is analogous</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">            to builtin `str`, only adds extra things on top.</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="n">previous_token</span><span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">previous_sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">def</span> <span class="nf">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">):</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>                <span class="nb">type</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="ow">and</span> <span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="ow">and</span> <span class="n">markup_text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">RE_MACRO</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">markup_text</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="p">):</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="n">token</span><span class="p">:</span> <span class="n">Token</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="k">if</span> <span class="n">sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">previous_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                <span class="k">continue</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="c1"># Optimize out previously added color tokens, as only the most</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="c1"># recent would be visible anyways.</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                <span class="ow">and</span> <span class="n">previous_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="ow">and</span> <span class="n">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous_token</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="p">):</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="k">continue</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                <span class="k">continue</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">previous_token</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="c1"># Macro unsetters are stored with None as their data</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                    <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                    <span class="k">assert</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                    <span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">macro_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                        <span class="n">applied_macros</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="k">continue</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="k">continue</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                <span class="n">applied</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">previous_sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                            <span class="k">continue</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                        <span class="n">item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                        <span class="n">applied</span> <span class="o">=</span> <span class="n">applied</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">applied</span> <span class="o">+</span> <span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                <span class="n">previous_sequence</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                <span class="k">continue</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="n">sequence</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="k">if</span> <span class="n">sequence</span> <span class="o">+</span> <span class="n">previous_sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>    <span class="k">def</span> <span class="nf">get_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="sd">&quot;&quot;&quot;Generates markup from ANSI text.</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">        Args:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">            ansi: The text to get markup from.</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">        Returns:</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">            A markup string that can be parsed to get (visually) the same</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">            result. Note that this conversion is lossy in a way: there are some</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">            details (like macros) that cannot be preserved in an ANSI-&gt;Markup-&gt;ANSI</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">            conversion.</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">current_tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">current_tags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="k">continue</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="k">continue</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>    <span class="k">def</span> <span class="nf">prettify_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) ANSI str.</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">        This is useful to quickly &quot;inspect&quot; a given ANSI string. However,</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">        for most real uses `MarkupLanguage.prettify_markup` would be</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        preferable, given an argument of `MarkupLanguage.get_markup(text)`,</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">        as it is much more verbose.</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">        Args:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">            text: The ANSI-text to prettify.</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        Returns:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">            The prettified ANSI text. This text&#39;s styles remain valid,</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">            so copy-pasting the argument into a command (like printf)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">            that can show styled text will work the same way.</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="k">continue</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x1b&quot;</span><span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">sequences</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="n">sequences</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="k">def</span> <span class="nf">prettify_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) markup str.</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        Args:</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">            text: The markup-text to prettify.</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">        Returns:</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">            Prettified markup. This markup, excluding its styles,</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">            remains valid markup.</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="k">def</span> <span class="nf">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="sd">&quot;&quot;&quot;Pops a macro from applied_macros.&quot;&quot;&quot;</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">macro_name</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">applied_macros</span><span class="p">):</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="k">if</span> <span class="n">macro_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                    <span class="n">applied_macros</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                    <span class="k">break</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="k">def</span> <span class="nf">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>            <span class="sd">&quot;&quot;&quot;Adds ending cap to the given string.&quot;&quot;&quot;</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;[/]&quot;</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">TokenType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span> <span class="s2">&quot;210&quot;</span><span class="p">,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span> <span class="s2">&quot;210 bold&quot;</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span> <span class="s2">&quot;strikethrough&quot;</span><span class="p">,</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="p">}</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="n">current_styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">]:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>                <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">current_styles</span><span class="p">:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                        <span class="k">continue</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}{</span><span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                <span class="k">continue</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="k">if</span> <span class="n">in_sequence</span> <span class="k">else</span> <span class="s2">&quot;[&quot;</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                    <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>                    <span class="n">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                    <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">styles</span><span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">]</span><span class="si">}</span><span class="s2">]/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                <span class="p">)</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                <span class="k">continue</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)]</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>                    <span class="k">continue</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># Not enough arguments</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                    <span class="k">pass</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>            <span class="n">style_markup</span> <span class="o">=</span> <span class="n">styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">ttype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">style_markup</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">)</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>    <span class="k">def</span> <span class="nf">get_styled_plains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">StyledText</span><span class="p">]:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="sd">&quot;&quot;&quot;Gets all plain tokens within text, with their respective styles applied.</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        Args:</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">            text: The ANSI-sequence containing string to find plains from.</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">        Returns:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">            An iterator of `StyledText` objects, each yielded when a new plain token is found,</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">            containing the styles that are relevant and active on the given plain.</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="k">def</span> <span class="nf">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="sd">&quot;&quot;&quot;Applies given styles to text.&quot;&quot;&quot;</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                    <span class="k">continue</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                    <span class="k">continue</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">text</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="k">def</span> <span class="nf">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="sd">&quot;&quot;&quot;Removes an unsetter from the list, returns the new list.&quot;&quot;&quot;</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tkn</span><span class="p">:</span> <span class="n">tkn</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">,</span> <span class="n">styles</span><span class="p">))</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="n">target_name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                <span class="c1"># bold &amp; dim unsetters represent the same character, so we have</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="c1"># to treat them the same way.</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                <span class="n">style_name</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;dim&quot;</span><span class="p">:</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                <span class="k">if</span> <span class="n">style_name</span> <span class="o">==</span> <span class="n">target_name</span><span class="p">:</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>                <span class="k">elif</span> <span class="p">(</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                    <span class="n">style_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>                    <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                <span class="p">):</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                <span class="k">elif</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                    <span class="k">if</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;fg&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>                    <span class="k">elif</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;bg&quot;</span> <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="k">def</span> <span class="nf">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">styles</span><span class="p">)):</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                        <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">!=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                            <span class="k">continue</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                        <span class="n">styles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                        <span class="k">break</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                <span class="k">continue</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">LINK</span><span class="p">:</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>                <span class="k">continue</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                <span class="k">continue</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>            <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>    <span class="sd">&quot;&quot;&quot;Main method&quot;&quot;&quot;</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>    <span class="n">markup_group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Markup-&gt;ANSI&quot;</span><span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="n">markup_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--parse&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;TXT&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;parse a markup text&quot;</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>    <span class="n">markup_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--escape&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;escape parsed markup&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>    <span class="p">)</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="c1"># markup_group.add_argument(</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="c1"># &quot;-o&quot;,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>    <span class="c1"># &quot;--optimize&quot;,</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>    <span class="c1"># help=&quot;set optimization level for markup parsing&quot;,</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="c1"># action=&quot;count&quot;,</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>    <span class="c1"># default=0,</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>    <span class="c1"># )</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>    <span class="n">markup_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--alias&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;alias src=dst&quot;</span><span class="p">)</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>    <span class="n">ansi_group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;ANSI-&gt;Markup&quot;</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>    <span class="n">ansi_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;--markup&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;TXT&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;get markup from ANSI text&quot;</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="p">)</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="n">ansi_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="s2">&quot;--show-inverse&quot;</span><span class="p">,</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show result of parsing result markup&quot;</span><span class="p">,</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>    <span class="p">)</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>    <span class="n">lang</span> <span class="o">=</span> <span class="n">MarkupLanguage</span><span class="p">()</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">markup</span><span class="p">:</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="n">markup_text</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">get_markup</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">markup</span><span class="p">)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">markup_text</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">show_inverse</span><span class="p">:</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">lang</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">markup_text</span><span class="p">))</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>            <span class="nb">print</span><span class="p">()</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">parse</span><span class="p">:</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                <span class="n">src</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                <span class="n">lang</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ascii</span><span class="p">(</span><span class="n">parsed</span><span class="p">))</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>        <span class="k">return</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="n">tim</span> <span class="o">=</span> <span class="n">markup</span> <span class="o">=</span> <span class="n">MarkupLanguage</span><span class="p">()</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">&quot;&quot;&quot;The default TIM instances.&quot;&quot;&quot;</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="StyledText">
                            <input id="StyledText-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StyledText</span><wbr>(<span class="base">builtins.str</span>):

                <label class="view-source-button" for="StyledText-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StyledText"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StyledText-391"><a href="#StyledText-391"><span class="linenos">391</span></a><span class="k">class</span> <span class="nc">StyledText</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
</span><span id="StyledText-392"><a href="#StyledText-392"><span class="linenos">392</span></a>    <span class="sd">&quot;&quot;&quot;A styled text object.</span>
</span><span id="StyledText-393"><a href="#StyledText-393"><span class="linenos">393</span></a>
</span><span id="StyledText-394"><a href="#StyledText-394"><span class="linenos">394</span></a><span class="sd">    The purpose of this class is to implement some things regular `str`</span>
</span><span id="StyledText-395"><a href="#StyledText-395"><span class="linenos">395</span></a><span class="sd">    breaks at when encountering ANSI sequences.</span>
</span><span id="StyledText-396"><a href="#StyledText-396"><span class="linenos">396</span></a>
</span><span id="StyledText-397"><a href="#StyledText-397"><span class="linenos">397</span></a><span class="sd">    Instances of this class are usually spat out by `MarkupLanguage.parse`,</span>
</span><span id="StyledText-398"><a href="#StyledText-398"><span class="linenos">398</span></a><span class="sd">    but may be manually constructed if the need arises. Everything works even</span>
</span><span id="StyledText-399"><a href="#StyledText-399"><span class="linenos">399</span></a><span class="sd">    if there is no ANSI tomfoolery going on.</span>
</span><span id="StyledText-400"><a href="#StyledText-400"><span class="linenos">400</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StyledText-401"><a href="#StyledText-401"><span class="linenos">401</span></a>
</span><span id="StyledText-402"><a href="#StyledText-402"><span class="linenos">402</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="StyledText-403"><a href="#StyledText-403"><span class="linenos">403</span></a>    <span class="sd">&quot;&quot;&quot;The underlying, ANSI-inclusive string value.&quot;&quot;&quot;</span>
</span><span id="StyledText-404"><a href="#StyledText-404"><span class="linenos">404</span></a>
</span><span id="StyledText-405"><a href="#StyledText-405"><span class="linenos">405</span></a>    <span class="n">_plain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StyledText-406"><a href="#StyledText-406"><span class="linenos">406</span></a>    <span class="n">_tokens</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StyledText-407"><a href="#StyledText-407"><span class="linenos">407</span></a>
</span><span id="StyledText-408"><a href="#StyledText-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="StyledText-409"><a href="#StyledText-409"><span class="linenos">409</span></a>        <span class="sd">&quot;&quot;&quot;Creates a StyledText, gets markup tags.&quot;&quot;&quot;</span>
</span><span id="StyledText-410"><a href="#StyledText-410"><span class="linenos">410</span></a>
</span><span id="StyledText-411"><a href="#StyledText-411"><span class="linenos">411</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="StyledText-412"><a href="#StyledText-412"><span class="linenos">412</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="StyledText-413"><a href="#StyledText-413"><span class="linenos">413</span></a>
</span><span id="StyledText-414"><a href="#StyledText-414"><span class="linenos">414</span></a>        <span class="k">return</span> <span class="n">obj</span>
</span><span id="StyledText-415"><a href="#StyledText-415"><span class="linenos">415</span></a>
</span><span id="StyledText-416"><a href="#StyledText-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">_generate_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-417"><a href="#StyledText-417"><span class="linenos">417</span></a>        <span class="sd">&quot;&quot;&quot;Generates self._tokens &amp; self._plain.&quot;&quot;&quot;</span>
</span><span id="StyledText-418"><a href="#StyledText-418"><span class="linenos">418</span></a>
</span><span id="StyledText-419"><a href="#StyledText-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tim</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span><span id="StyledText-420"><a href="#StyledText-420"><span class="linenos">420</span></a>
</span><span id="StyledText-421"><a href="#StyledText-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StyledText-422"><a href="#StyledText-422"><span class="linenos">422</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">:</span>
</span><span id="StyledText-423"><a href="#StyledText-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="StyledText-424"><a href="#StyledText-424"><span class="linenos">424</span></a>                <span class="k">continue</span>
</span><span id="StyledText-425"><a href="#StyledText-425"><span class="linenos">425</span></a>
</span><span id="StyledText-426"><a href="#StyledText-426"><span class="linenos">426</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="StyledText-427"><a href="#StyledText-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="StyledText-428"><a href="#StyledText-428"><span class="linenos">428</span></a>
</span><span id="StyledText-429"><a href="#StyledText-429"><span class="linenos">429</span></a>    <span class="nd">@property</span>
</span><span id="StyledText-430"><a href="#StyledText-430"><span class="linenos">430</span></a>    <span class="k">def</span> <span class="nf">tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="StyledText-431"><a href="#StyledText-431"><span class="linenos">431</span></a>        <span class="sd">&quot;&quot;&quot;Returns all markup tokens of this object.</span>
</span><span id="StyledText-432"><a href="#StyledText-432"><span class="linenos">432</span></a>
</span><span id="StyledText-433"><a href="#StyledText-433"><span class="linenos">433</span></a><span class="sd">        Generated on-demand, at the first call to this or the self.plain</span>
</span><span id="StyledText-434"><a href="#StyledText-434"><span class="linenos">434</span></a><span class="sd">        property.</span>
</span><span id="StyledText-435"><a href="#StyledText-435"><span class="linenos">435</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StyledText-436"><a href="#StyledText-436"><span class="linenos">436</span></a>
</span><span id="StyledText-437"><a href="#StyledText-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-438"><a href="#StyledText-438"><span class="linenos">438</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>
</span><span id="StyledText-439"><a href="#StyledText-439"><span class="linenos">439</span></a>
</span><span id="StyledText-440"><a href="#StyledText-440"><span class="linenos">440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_tokens</span><span class="p">()</span>
</span><span id="StyledText-441"><a href="#StyledText-441"><span class="linenos">441</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="StyledText-442"><a href="#StyledText-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>
</span><span id="StyledText-443"><a href="#StyledText-443"><span class="linenos">443</span></a>
</span><span id="StyledText-444"><a href="#StyledText-444"><span class="linenos">444</span></a>    <span class="nd">@property</span>
</span><span id="StyledText-445"><a href="#StyledText-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">plain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="StyledText-446"><a href="#StyledText-446"><span class="linenos">446</span></a>        <span class="sd">&quot;&quot;&quot;Returns the value of this object, with no ANSI sequences.</span>
</span><span id="StyledText-447"><a href="#StyledText-447"><span class="linenos">447</span></a>
</span><span id="StyledText-448"><a href="#StyledText-448"><span class="linenos">448</span></a><span class="sd">        Generated on-demand, at the first call to this or the self.tokens</span>
</span><span id="StyledText-449"><a href="#StyledText-449"><span class="linenos">449</span></a><span class="sd">        property.</span>
</span><span id="StyledText-450"><a href="#StyledText-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StyledText-451"><a href="#StyledText-451"><span class="linenos">451</span></a>
</span><span id="StyledText-452"><a href="#StyledText-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-453"><a href="#StyledText-453"><span class="linenos">453</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span>
</span><span id="StyledText-454"><a href="#StyledText-454"><span class="linenos">454</span></a>
</span><span id="StyledText-455"><a href="#StyledText-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_tokens</span><span class="p">()</span>
</span><span id="StyledText-456"><a href="#StyledText-456"><span class="linenos">456</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="StyledText-457"><a href="#StyledText-457"><span class="linenos">457</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plain</span>
</span><span id="StyledText-458"><a href="#StyledText-458"><span class="linenos">458</span></a>
</span><span id="StyledText-459"><a href="#StyledText-459"><span class="linenos">459</span></a>    <span class="k">def</span> <span class="nf">plain_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-460"><a href="#StyledText-460"><span class="linenos">460</span></a>        <span class="sd">&quot;&quot;&quot;Finds given index inside plain text.&quot;&quot;&quot;</span>
</span><span id="StyledText-461"><a href="#StyledText-461"><span class="linenos">461</span></a>
</span><span id="StyledText-462"><a href="#StyledText-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-463"><a href="#StyledText-463"><span class="linenos">463</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="StyledText-464"><a href="#StyledText-464"><span class="linenos">464</span></a>
</span><span id="StyledText-465"><a href="#StyledText-465"><span class="linenos">465</span></a>        <span class="n">styled_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StyledText-466"><a href="#StyledText-466"><span class="linenos">466</span></a>        <span class="n">plain_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StyledText-467"><a href="#StyledText-467"><span class="linenos">467</span></a>        <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StyledText-468"><a href="#StyledText-468"><span class="linenos">468</span></a>
</span><span id="StyledText-469"><a href="#StyledText-469"><span class="linenos">469</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StyledText-470"><a href="#StyledText-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="StyledText-471"><a href="#StyledText-471"><span class="linenos">471</span></a>            <span class="n">tokens</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="StyledText-472"><a href="#StyledText-472"><span class="linenos">472</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="StyledText-473"><a href="#StyledText-473"><span class="linenos">473</span></a>            <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StyledText-474"><a href="#StyledText-474"><span class="linenos">474</span></a>
</span><span id="StyledText-475"><a href="#StyledText-475"><span class="linenos">475</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
</span><span id="StyledText-476"><a href="#StyledText-476"><span class="linenos">476</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-477"><a href="#StyledText-477"><span class="linenos">477</span></a>                <span class="k">continue</span>
</span><span id="StyledText-478"><a href="#StyledText-478"><span class="linenos">478</span></a>
</span><span id="StyledText-479"><a href="#StyledText-479"><span class="linenos">479</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="StyledText-480"><a href="#StyledText-480"><span class="linenos">480</span></a>                <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="StyledText-481"><a href="#StyledText-481"><span class="linenos">481</span></a>                <span class="n">styled_chars</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="StyledText-482"><a href="#StyledText-482"><span class="linenos">482</span></a>                <span class="k">continue</span>
</span><span id="StyledText-483"><a href="#StyledText-483"><span class="linenos">483</span></a>
</span><span id="StyledText-484"><a href="#StyledText-484"><span class="linenos">484</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="StyledText-485"><a href="#StyledText-485"><span class="linenos">485</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span id="StyledText-486"><a href="#StyledText-486"><span class="linenos">486</span></a>                <span class="k">if</span> <span class="n">plain_chars</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
</span><span id="StyledText-487"><a href="#StyledText-487"><span class="linenos">487</span></a>                    <span class="k">if</span> <span class="n">negative_index</span><span class="p">:</span>
</span><span id="StyledText-488"><a href="#StyledText-488"><span class="linenos">488</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">plain_chars</span> <span class="o">+</span> <span class="n">styled_chars</span><span class="p">)</span>
</span><span id="StyledText-489"><a href="#StyledText-489"><span class="linenos">489</span></a>
</span><span id="StyledText-490"><a href="#StyledText-490"><span class="linenos">490</span></a>                    <span class="k">return</span> <span class="n">styled_chars</span> <span class="o">+</span> <span class="n">plain_chars</span>
</span><span id="StyledText-491"><a href="#StyledText-491"><span class="linenos">491</span></a>
</span><span id="StyledText-492"><a href="#StyledText-492"><span class="linenos">492</span></a>                <span class="n">plain_chars</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StyledText-493"><a href="#StyledText-493"><span class="linenos">493</span></a>
</span><span id="StyledText-494"><a href="#StyledText-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="StyledText-495"><a href="#StyledText-495"><span class="linenos">495</span></a>
</span><span id="StyledText-496"><a href="#StyledText-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="StyledText-497"><a href="#StyledText-497"><span class="linenos">497</span></a>        <span class="sd">&quot;&quot;&quot;Gets &quot;real&quot; length of object.&quot;&quot;&quot;</span>
</span><span id="StyledText-498"><a href="#StyledText-498"><span class="linenos">498</span></a>
</span><span id="StyledText-499"><a href="#StyledText-499"><span class="linenos">499</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
</span><span id="StyledText-500"><a href="#StyledText-500"><span class="linenos">500</span></a>
</span><span id="StyledText-501"><a href="#StyledText-501"><span class="linenos">501</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscript</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="StyledText-502"><a href="#StyledText-502"><span class="linenos">502</span></a>        <span class="sd">&quot;&quot;&quot;Gets an item, adjusted for non-plain text.</span>
</span><span id="StyledText-503"><a href="#StyledText-503"><span class="linenos">503</span></a>
</span><span id="StyledText-504"><a href="#StyledText-504"><span class="linenos">504</span></a><span class="sd">        Args:</span>
</span><span id="StyledText-505"><a href="#StyledText-505"><span class="linenos">505</span></a><span class="sd">            subscript: The integer or slice to find.</span>
</span><span id="StyledText-506"><a href="#StyledText-506"><span class="linenos">506</span></a>
</span><span id="StyledText-507"><a href="#StyledText-507"><span class="linenos">507</span></a><span class="sd">        Returns:</span>
</span><span id="StyledText-508"><a href="#StyledText-508"><span class="linenos">508</span></a><span class="sd">            The elements described by the subscript.</span>
</span><span id="StyledText-509"><a href="#StyledText-509"><span class="linenos">509</span></a>
</span><span id="StyledText-510"><a href="#StyledText-510"><span class="linenos">510</span></a><span class="sd">        Raises:</span>
</span><span id="StyledText-511"><a href="#StyledText-511"><span class="linenos">511</span></a><span class="sd">            IndexError: The given index is out of range.</span>
</span><span id="StyledText-512"><a href="#StyledText-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StyledText-513"><a href="#StyledText-513"><span class="linenos">513</span></a>
</span><span id="StyledText-514"><a href="#StyledText-514"><span class="linenos">514</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="StyledText-515"><a href="#StyledText-515"><span class="linenos">515</span></a>            <span class="n">plain_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="p">)</span>
</span><span id="StyledText-516"><a href="#StyledText-516"><span class="linenos">516</span></a>            <span class="k">if</span> <span class="n">plain_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText-517"><a href="#StyledText-517"><span class="linenos">517</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;StyledText index out of range&quot;</span><span class="p">)</span>
</span><span id="StyledText-518"><a href="#StyledText-518"><span class="linenos">518</span></a>
</span><span id="StyledText-519"><a href="#StyledText-519"><span class="linenos">519</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">plain_index</span><span class="p">]</span>
</span><span id="StyledText-520"><a href="#StyledText-520"><span class="linenos">520</span></a>
</span><span id="StyledText-521"><a href="#StyledText-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span>
</span><span id="StyledText-522"><a href="#StyledText-522"><span class="linenos">522</span></a>            <span class="nb">slice</span><span class="p">(</span>
</span><span id="StyledText-523"><a href="#StyledText-523"><span class="linenos">523</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="o">.</span><span class="n">start</span><span class="p">),</span>
</span><span id="StyledText-524"><a href="#StyledText-524"><span class="linenos">524</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plain_index</span><span class="p">(</span><span class="n">subscript</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span>
</span><span id="StyledText-525"><a href="#StyledText-525"><span class="linenos">525</span></a>                <span class="n">subscript</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="StyledText-526"><a href="#StyledText-526"><span class="linenos">526</span></a>            <span class="p">)</span>
</span><span id="StyledText-527"><a href="#StyledText-527"><span class="linenos">527</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A styled text object.</p>

<p>The purpose of this class is to implement some things regular <code>str</code>
breaks at when encountering ANSI sequences.</p>

<p>Instances of this class are usually spat out by <code><a href="#MarkupLanguage.parse">MarkupLanguage.parse</a></code>,
but may be manually constructed if the need arises. Everything works even
if there is no ANSI tomfoolery going on.</p>
</div>


                            <div id="StyledText.__init__" class="classattr">
                                        <input id="StyledText.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StyledText</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="StyledText.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StyledText.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StyledText.__init__-408"><a href="#StyledText.__init__-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="StyledText.__init__-409"><a href="#StyledText.__init__-409"><span class="linenos">409</span></a>        <span class="sd">&quot;&quot;&quot;Creates a StyledText, gets markup tags.&quot;&quot;&quot;</span>
</span><span id="StyledText.__init__-410"><a href="#StyledText.__init__-410"><span class="linenos">410</span></a>
</span><span id="StyledText.__init__-411"><a href="#StyledText.__init__-411"><span class="linenos">411</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="StyledText.__init__-412"><a href="#StyledText.__init__-412"><span class="linenos">412</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="StyledText.__init__-413"><a href="#StyledText.__init__-413"><span class="linenos">413</span></a>
</span><span id="StyledText.__init__-414"><a href="#StyledText.__init__-414"><span class="linenos">414</span></a>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Creates a StyledText, gets markup tags.</p>
</div>


                            </div>
                            <div id="StyledText.value" class="classattr">
                                <div class="attr variable">
            <span class="name">value</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#StyledText.value"></a>
    
            <div class="docstring"><p>The underlying, ANSI-inclusive string value.</p>
</div>


                            </div>
                            <div id="StyledText.tokens" class="classattr">
                                <div class="attr variable">
            <span class="name">tokens</span><span class="annotation">: list[pytermgui.parser.Token]</span>

        
    </div>
    <a class="headerlink" href="#StyledText.tokens"></a>
    
            <div class="docstring"><p>Returns all markup tokens of this object.</p>

<p>Generated on-demand, at the first call to this or the self.plain
property.</p>
</div>


                            </div>
                            <div id="StyledText.plain" class="classattr">
                                <div class="attr variable">
            <span class="name">plain</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#StyledText.plain"></a>
    
            <div class="docstring"><p>Returns the value of this object, with no ANSI sequences.</p>

<p>Generated on-demand, at the first call to this or the self.tokens
property.</p>
</div>


                            </div>
                            <div id="StyledText.plain_index" class="classattr">
                                        <input id="StyledText.plain_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plain_index</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="StyledText.plain_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StyledText.plain_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StyledText.plain_index-459"><a href="#StyledText.plain_index-459"><span class="linenos">459</span></a>    <span class="k">def</span> <span class="nf">plain_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText.plain_index-460"><a href="#StyledText.plain_index-460"><span class="linenos">460</span></a>        <span class="sd">&quot;&quot;&quot;Finds given index inside plain text.&quot;&quot;&quot;</span>
</span><span id="StyledText.plain_index-461"><a href="#StyledText.plain_index-461"><span class="linenos">461</span></a>
</span><span id="StyledText.plain_index-462"><a href="#StyledText.plain_index-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText.plain_index-463"><a href="#StyledText.plain_index-463"><span class="linenos">463</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="StyledText.plain_index-464"><a href="#StyledText.plain_index-464"><span class="linenos">464</span></a>
</span><span id="StyledText.plain_index-465"><a href="#StyledText.plain_index-465"><span class="linenos">465</span></a>        <span class="n">styled_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StyledText.plain_index-466"><a href="#StyledText.plain_index-466"><span class="linenos">466</span></a>        <span class="n">plain_chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StyledText.plain_index-467"><a href="#StyledText.plain_index-467"><span class="linenos">467</span></a>        <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StyledText.plain_index-468"><a href="#StyledText.plain_index-468"><span class="linenos">468</span></a>
</span><span id="StyledText.plain_index-469"><a href="#StyledText.plain_index-469"><span class="linenos">469</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StyledText.plain_index-470"><a href="#StyledText.plain_index-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="StyledText.plain_index-471"><a href="#StyledText.plain_index-471"><span class="linenos">471</span></a>            <span class="n">tokens</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="StyledText.plain_index-472"><a href="#StyledText.plain_index-472"><span class="linenos">472</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="StyledText.plain_index-473"><a href="#StyledText.plain_index-473"><span class="linenos">473</span></a>            <span class="n">negative_index</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StyledText.plain_index-474"><a href="#StyledText.plain_index-474"><span class="linenos">474</span></a>
</span><span id="StyledText.plain_index-475"><a href="#StyledText.plain_index-475"><span class="linenos">475</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
</span><span id="StyledText.plain_index-476"><a href="#StyledText.plain_index-476"><span class="linenos">476</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StyledText.plain_index-477"><a href="#StyledText.plain_index-477"><span class="linenos">477</span></a>                <span class="k">continue</span>
</span><span id="StyledText.plain_index-478"><a href="#StyledText.plain_index-478"><span class="linenos">478</span></a>
</span><span id="StyledText.plain_index-479"><a href="#StyledText.plain_index-479"><span class="linenos">479</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="StyledText.plain_index-480"><a href="#StyledText.plain_index-480"><span class="linenos">480</span></a>                <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="StyledText.plain_index-481"><a href="#StyledText.plain_index-481"><span class="linenos">481</span></a>                <span class="n">styled_chars</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="StyledText.plain_index-482"><a href="#StyledText.plain_index-482"><span class="linenos">482</span></a>                <span class="k">continue</span>
</span><span id="StyledText.plain_index-483"><a href="#StyledText.plain_index-483"><span class="linenos">483</span></a>
</span><span id="StyledText.plain_index-484"><a href="#StyledText.plain_index-484"><span class="linenos">484</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="StyledText.plain_index-485"><a href="#StyledText.plain_index-485"><span class="linenos">485</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span id="StyledText.plain_index-486"><a href="#StyledText.plain_index-486"><span class="linenos">486</span></a>                <span class="k">if</span> <span class="n">plain_chars</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
</span><span id="StyledText.plain_index-487"><a href="#StyledText.plain_index-487"><span class="linenos">487</span></a>                    <span class="k">if</span> <span class="n">negative_index</span><span class="p">:</span>
</span><span id="StyledText.plain_index-488"><a href="#StyledText.plain_index-488"><span class="linenos">488</span></a>                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">plain_chars</span> <span class="o">+</span> <span class="n">styled_chars</span><span class="p">)</span>
</span><span id="StyledText.plain_index-489"><a href="#StyledText.plain_index-489"><span class="linenos">489</span></a>
</span><span id="StyledText.plain_index-490"><a href="#StyledText.plain_index-490"><span class="linenos">490</span></a>                    <span class="k">return</span> <span class="n">styled_chars</span> <span class="o">+</span> <span class="n">plain_chars</span>
</span><span id="StyledText.plain_index-491"><a href="#StyledText.plain_index-491"><span class="linenos">491</span></a>
</span><span id="StyledText.plain_index-492"><a href="#StyledText.plain_index-492"><span class="linenos">492</span></a>                <span class="n">plain_chars</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StyledText.plain_index-493"><a href="#StyledText.plain_index-493"><span class="linenos">493</span></a>
</span><span id="StyledText.plain_index-494"><a href="#StyledText.plain_index-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Finds given index inside plain text.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.str</dt>
                                <dd id="StyledText.encode" class="function">encode</dd>
                <dd id="StyledText.replace" class="function">replace</dd>
                <dd id="StyledText.split" class="function">split</dd>
                <dd id="StyledText.rsplit" class="function">rsplit</dd>
                <dd id="StyledText.join" class="function">join</dd>
                <dd id="StyledText.capitalize" class="function">capitalize</dd>
                <dd id="StyledText.casefold" class="function">casefold</dd>
                <dd id="StyledText.title" class="function">title</dd>
                <dd id="StyledText.center" class="function">center</dd>
                <dd id="StyledText.count" class="function">count</dd>
                <dd id="StyledText.expandtabs" class="function">expandtabs</dd>
                <dd id="StyledText.find" class="function">find</dd>
                <dd id="StyledText.partition" class="function">partition</dd>
                <dd id="StyledText.index" class="function">index</dd>
                <dd id="StyledText.ljust" class="function">ljust</dd>
                <dd id="StyledText.lower" class="function">lower</dd>
                <dd id="StyledText.lstrip" class="function">lstrip</dd>
                <dd id="StyledText.rfind" class="function">rfind</dd>
                <dd id="StyledText.rindex" class="function">rindex</dd>
                <dd id="StyledText.rjust" class="function">rjust</dd>
                <dd id="StyledText.rstrip" class="function">rstrip</dd>
                <dd id="StyledText.rpartition" class="function">rpartition</dd>
                <dd id="StyledText.splitlines" class="function">splitlines</dd>
                <dd id="StyledText.strip" class="function">strip</dd>
                <dd id="StyledText.swapcase" class="function">swapcase</dd>
                <dd id="StyledText.translate" class="function">translate</dd>
                <dd id="StyledText.upper" class="function">upper</dd>
                <dd id="StyledText.startswith" class="function">startswith</dd>
                <dd id="StyledText.endswith" class="function">endswith</dd>
                <dd id="StyledText.removeprefix" class="function">removeprefix</dd>
                <dd id="StyledText.removesuffix" class="function">removesuffix</dd>
                <dd id="StyledText.isascii" class="function">isascii</dd>
                <dd id="StyledText.islower" class="function">islower</dd>
                <dd id="StyledText.isupper" class="function">isupper</dd>
                <dd id="StyledText.istitle" class="function">istitle</dd>
                <dd id="StyledText.isspace" class="function">isspace</dd>
                <dd id="StyledText.isdecimal" class="function">isdecimal</dd>
                <dd id="StyledText.isdigit" class="function">isdigit</dd>
                <dd id="StyledText.isnumeric" class="function">isnumeric</dd>
                <dd id="StyledText.isalpha" class="function">isalpha</dd>
                <dd id="StyledText.isalnum" class="function">isalnum</dd>
                <dd id="StyledText.isidentifier" class="function">isidentifier</dd>
                <dd id="StyledText.isprintable" class="function">isprintable</dd>
                <dd id="StyledText.zfill" class="function">zfill</dd>
                <dd id="StyledText.format" class="function">format</dd>
                <dd id="StyledText.format_map" class="function">format_map</dd>
                <dd id="StyledText.maketrans" class="function">maketrans</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MacroCallable">
                    <div class="attr variable">
            <span class="name">MacroCallable</span><span class="default_value"> = typing.Callable[..., str]</span>

        
    </div>
    <a class="headerlink" href="#MacroCallable"></a>
    
    

                </section>
                <section id="MacroCall">
                    <div class="attr variable">
            <span class="name">MacroCall</span><span class="default_value"> = typing.Tuple[typing.Callable[..., str], typing.List[str]]</span>

        
    </div>
    <a class="headerlink" href="#MacroCall"></a>
    
    

                </section>
                <section id="MarkupLanguage">
                            <input id="MarkupLanguage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MarkupLanguage</span>:

                <label class="view-source-button" for="MarkupLanguage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage-530"><a href="#MarkupLanguage-530"><span class="linenos"> 530</span></a><span class="k">class</span> <span class="nc">MarkupLanguage</span><span class="p">:</span>
</span><span id="MarkupLanguage-531"><a href="#MarkupLanguage-531"><span class="linenos"> 531</span></a>    <span class="sd">&quot;&quot;&quot;A class representing an instance of a Markup Language.</span>
</span><span id="MarkupLanguage-532"><a href="#MarkupLanguage-532"><span class="linenos"> 532</span></a>
</span><span id="MarkupLanguage-533"><a href="#MarkupLanguage-533"><span class="linenos"> 533</span></a><span class="sd">    This class is used for all markup/ANSI parsing, tokenizing and usage.</span>
</span><span id="MarkupLanguage-534"><a href="#MarkupLanguage-534"><span class="linenos"> 534</span></a>
</span><span id="MarkupLanguage-535"><a href="#MarkupLanguage-535"><span class="linenos"> 535</span></a><span class="sd">    ```python3</span>
</span><span id="MarkupLanguage-536"><a href="#MarkupLanguage-536"><span class="linenos"> 536</span></a><span class="sd">    from pytermgui import tim</span>
</span><span id="MarkupLanguage-537"><a href="#MarkupLanguage-537"><span class="linenos"> 537</span></a>
</span><span id="MarkupLanguage-538"><a href="#MarkupLanguage-538"><span class="linenos"> 538</span></a><span class="sd">    tim.alias(&quot;my-tag&quot;, &quot;@152 72 bold&quot;)</span>
</span><span id="MarkupLanguage-539"><a href="#MarkupLanguage-539"><span class="linenos"> 539</span></a><span class="sd">    tim.print(&quot;This is [my-tag]my-tag[/]!&quot;)</span>
</span><span id="MarkupLanguage-540"><a href="#MarkupLanguage-540"><span class="linenos"> 540</span></a><span class="sd">    ```</span>
</span><span id="MarkupLanguage-541"><a href="#MarkupLanguage-541"><span class="linenos"> 541</span></a>
</span><span id="MarkupLanguage-542"><a href="#MarkupLanguage-542"><span class="linenos"> 542</span></a><span class="sd">    &lt;p style=&quot;text-align: center&quot;&gt;</span>
</span><span id="MarkupLanguage-543"><a href="#MarkupLanguage-543"><span class="linenos"> 543</span></a><span class="sd">        &lt;img src=&quot;https://raw.githubusercontent.com/bczsalba/pytermgui/master/assets/\</span>
</span><span id="MarkupLanguage-544"><a href="#MarkupLanguage-544"><span class="linenos"> 544</span></a><span class="sd">docs/parser/markup_language.png&quot;</span>
</span><span id="MarkupLanguage-545"><a href="#MarkupLanguage-545"><span class="linenos"> 545</span></a><span class="sd">        style=&quot;width: 80%&quot;&gt;</span>
</span><span id="MarkupLanguage-546"><a href="#MarkupLanguage-546"><span class="linenos"> 546</span></a><span class="sd">    &lt;/p&gt;</span>
</span><span id="MarkupLanguage-547"><a href="#MarkupLanguage-547"><span class="linenos"> 547</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-548"><a href="#MarkupLanguage-548"><span class="linenos"> 548</span></a>
</span><span id="MarkupLanguage-549"><a href="#MarkupLanguage-549"><span class="linenos"> 549</span></a>    <span class="n">raise_unknown_markup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MarkupLanguage-550"><a href="#MarkupLanguage-550"><span class="linenos"> 550</span></a>    <span class="sd">&quot;&quot;&quot;Raise `pytermgui.exceptions.MarkupSyntaxError` when encountering unknown markup tags.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-551"><a href="#MarkupLanguage-551"><span class="linenos"> 551</span></a>
</span><span id="MarkupLanguage-552"><a href="#MarkupLanguage-552"><span class="linenos"> 552</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_macros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-553"><a href="#MarkupLanguage-553"><span class="linenos"> 553</span></a>        <span class="sd">&quot;&quot;&quot;Initializes a MarkupLanguage.</span>
</span><span id="MarkupLanguage-554"><a href="#MarkupLanguage-554"><span class="linenos"> 554</span></a>
</span><span id="MarkupLanguage-555"><a href="#MarkupLanguage-555"><span class="linenos"> 555</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-556"><a href="#MarkupLanguage-556"><span class="linenos"> 556</span></a><span class="sd">            default_macros: If not set, the builtin macros are not defined.</span>
</span><span id="MarkupLanguage-557"><a href="#MarkupLanguage-557"><span class="linenos"> 557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-558"><a href="#MarkupLanguage-558"><span class="linenos"> 558</span></a>
</span><span id="MarkupLanguage-559"><a href="#MarkupLanguage-559"><span class="linenos"> 559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">STYLE_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MarkupLanguage-560"><a href="#MarkupLanguage-560"><span class="linenos"> 560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage-561"><a href="#MarkupLanguage-561"><span class="linenos"> 561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCallable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage-562"><a href="#MarkupLanguage-562"><span class="linenos"> 562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage-563"><a href="#MarkupLanguage-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNSETTER_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MarkupLanguage-564"><a href="#MarkupLanguage-564"><span class="linenos"> 564</span></a>
</span><span id="MarkupLanguage-565"><a href="#MarkupLanguage-565"><span class="linenos"> 565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MarkupLanguage-566"><a href="#MarkupLanguage-566"><span class="linenos"> 566</span></a>
</span><span id="MarkupLanguage-567"><a href="#MarkupLanguage-567"><span class="linenos"> 567</span></a>        <span class="k">if</span> <span class="n">default_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage-568"><a href="#MarkupLanguage-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!link&quot;</span><span class="p">,</span> <span class="n">macro_link</span><span class="p">)</span>
</span><span id="MarkupLanguage-569"><a href="#MarkupLanguage-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!align&quot;</span><span class="p">,</span> <span class="n">macro_align</span><span class="p">)</span>
</span><span id="MarkupLanguage-570"><a href="#MarkupLanguage-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!markup&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_markup</span><span class="p">)</span>
</span><span id="MarkupLanguage-571"><a href="#MarkupLanguage-571"><span class="linenos"> 571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!shuffle&quot;</span><span class="p">,</span> <span class="n">macro_shuffle</span><span class="p">)</span>
</span><span id="MarkupLanguage-572"><a href="#MarkupLanguage-572"><span class="linenos"> 572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_bg&quot;</span><span class="p">,</span> <span class="n">macro_strip_bg</span><span class="p">)</span>
</span><span id="MarkupLanguage-573"><a href="#MarkupLanguage-573"><span class="linenos"> 573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_fg&quot;</span><span class="p">,</span> <span class="n">macro_strip_fg</span><span class="p">)</span>
</span><span id="MarkupLanguage-574"><a href="#MarkupLanguage-574"><span class="linenos"> 574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!rainbow&quot;</span><span class="p">,</span> <span class="n">macro_rainbow</span><span class="p">)</span>
</span><span id="MarkupLanguage-575"><a href="#MarkupLanguage-575"><span class="linenos"> 575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!gradient&quot;</span><span class="p">,</span> <span class="n">macro_gradient</span><span class="p">)</span>
</span><span id="MarkupLanguage-576"><a href="#MarkupLanguage-576"><span class="linenos"> 576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!upper&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
</span><span id="MarkupLanguage-577"><a href="#MarkupLanguage-577"><span class="linenos"> 577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!lower&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</span><span id="MarkupLanguage-578"><a href="#MarkupLanguage-578"><span class="linenos"> 578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!title&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">()))</span>
</span><span id="MarkupLanguage-579"><a href="#MarkupLanguage-579"><span class="linenos"> 579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!capitalize&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()))</span>
</span><span id="MarkupLanguage-580"><a href="#MarkupLanguage-580"><span class="linenos"> 580</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!expand&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tag</span><span class="p">:</span> <span class="n">macro_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span><span id="MarkupLanguage-581"><a href="#MarkupLanguage-581"><span class="linenos"> 581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!debug&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ascii</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">))</span>
</span><span id="MarkupLanguage-582"><a href="#MarkupLanguage-582"><span class="linenos"> 582</span></a>
</span><span id="MarkupLanguage-583"><a href="#MarkupLanguage-583"><span class="linenos"> 583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;dim @black&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-584"><a href="#MarkupLanguage-584"><span class="linenos"> 584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.str&quot;</span><span class="p">,</span> <span class="s2">&quot;142&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-585"><a href="#MarkupLanguage-585"><span class="linenos"> 585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.multiline_str&quot;</span><span class="p">,</span> <span class="s2">&quot;code.str&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-586"><a href="#MarkupLanguage-586"><span class="linenos"> 586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.none&quot;</span><span class="p">,</span> <span class="s2">&quot;167&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-587"><a href="#MarkupLanguage-587"><span class="linenos"> 587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.global&quot;</span><span class="p">,</span> <span class="s2">&quot;214&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-588"><a href="#MarkupLanguage-588"><span class="linenos"> 588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.number&quot;</span><span class="p">,</span> <span class="s2">&quot;175&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-589"><a href="#MarkupLanguage-589"><span class="linenos"> 589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.keyword&quot;</span><span class="p">,</span> <span class="s2">&quot;203&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-590"><a href="#MarkupLanguage-590"><span class="linenos"> 590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.identifier&quot;</span><span class="p">,</span> <span class="s2">&quot;109&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-591"><a href="#MarkupLanguage-591"><span class="linenos"> 591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.name&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-592"><a href="#MarkupLanguage-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.comment&quot;</span><span class="p">,</span> <span class="s2">&quot;240 italic&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-593"><a href="#MarkupLanguage-593"><span class="linenos"> 593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.builtin&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-594"><a href="#MarkupLanguage-594"><span class="linenos"> 594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.file&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-595"><a href="#MarkupLanguage-595"><span class="linenos"> 595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-596"><a href="#MarkupLanguage-596"><span class="linenos"> 596</span></a>
</span><span id="MarkupLanguage-597"><a href="#MarkupLanguage-597"><span class="linenos"> 597</span></a>    <span class="k">def</span> <span class="nf">_get_color_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-598"><a href="#MarkupLanguage-598"><span class="linenos"> 598</span></a>        <span class="sd">&quot;&quot;&quot;Tries to get a color token from the given tag.</span>
</span><span id="MarkupLanguage-599"><a href="#MarkupLanguage-599"><span class="linenos"> 599</span></a>
</span><span id="MarkupLanguage-600"><a href="#MarkupLanguage-600"><span class="linenos"> 600</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-601"><a href="#MarkupLanguage-601"><span class="linenos"> 601</span></a><span class="sd">            tag: The tag to parse.</span>
</span><span id="MarkupLanguage-602"><a href="#MarkupLanguage-602"><span class="linenos"> 602</span></a>
</span><span id="MarkupLanguage-603"><a href="#MarkupLanguage-603"><span class="linenos"> 603</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-604"><a href="#MarkupLanguage-604"><span class="linenos"> 604</span></a><span class="sd">            A color token if the given tag could be parsed into one, else None.</span>
</span><span id="MarkupLanguage-605"><a href="#MarkupLanguage-605"><span class="linenos"> 605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-606"><a href="#MarkupLanguage-606"><span class="linenos"> 606</span></a>
</span><span id="MarkupLanguage-607"><a href="#MarkupLanguage-607"><span class="linenos"> 607</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MarkupLanguage-608"><a href="#MarkupLanguage-608"><span class="linenos"> 608</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="n">str_to_color</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span><span class="p">)</span>
</span><span id="MarkupLanguage-609"><a href="#MarkupLanguage-609"><span class="linenos"> 609</span></a>
</span><span id="MarkupLanguage-610"><a href="#MarkupLanguage-610"><span class="linenos"> 610</span></a>        <span class="k">except</span> <span class="n">ColorSyntaxError</span><span class="p">:</span>
</span><span id="MarkupLanguage-611"><a href="#MarkupLanguage-611"><span class="linenos"> 611</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-612"><a href="#MarkupLanguage-612"><span class="linenos"> 612</span></a>
</span><span id="MarkupLanguage-613"><a href="#MarkupLanguage-613"><span class="linenos"> 613</span></a>        <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="MarkupLanguage-614"><a href="#MarkupLanguage-614"><span class="linenos"> 614</span></a>
</span><span id="MarkupLanguage-615"><a href="#MarkupLanguage-615"><span class="linenos"> 615</span></a>    <span class="k">def</span> <span class="nf">_get_style_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-616"><a href="#MarkupLanguage-616"><span class="linenos"> 616</span></a>        <span class="sd">&quot;&quot;&quot;Tries to get a style (including unsetter) token from tags, user tags and unsetters.</span>
</span><span id="MarkupLanguage-617"><a href="#MarkupLanguage-617"><span class="linenos"> 617</span></a>
</span><span id="MarkupLanguage-618"><a href="#MarkupLanguage-618"><span class="linenos"> 618</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-619"><a href="#MarkupLanguage-619"><span class="linenos"> 619</span></a><span class="sd">            tag: The tag to parse.</span>
</span><span id="MarkupLanguage-620"><a href="#MarkupLanguage-620"><span class="linenos"> 620</span></a>
</span><span id="MarkupLanguage-621"><a href="#MarkupLanguage-621"><span class="linenos"> 621</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-622"><a href="#MarkupLanguage-622"><span class="linenos"> 622</span></a><span class="sd">            A `Token` if one could be created, None otherwise.</span>
</span><span id="MarkupLanguage-623"><a href="#MarkupLanguage-623"><span class="linenos"> 623</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-624"><a href="#MarkupLanguage-624"><span class="linenos"> 624</span></a>
</span><span id="MarkupLanguage-625"><a href="#MarkupLanguage-625"><span class="linenos"> 625</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span>
</span><span id="MarkupLanguage-626"><a href="#MarkupLanguage-626"><span class="linenos"> 626</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="MarkupLanguage-627"><a href="#MarkupLanguage-627"><span class="linenos"> 627</span></a>
</span><span id="MarkupLanguage-628"><a href="#MarkupLanguage-628"><span class="linenos"> 628</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="MarkupLanguage-629"><a href="#MarkupLanguage-629"><span class="linenos"> 629</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="MarkupLanguage-630"><a href="#MarkupLanguage-630"><span class="linenos"> 630</span></a>
</span><span id="MarkupLanguage-631"><a href="#MarkupLanguage-631"><span class="linenos"> 631</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="MarkupLanguage-632"><a href="#MarkupLanguage-632"><span class="linenos"> 632</span></a>            <span class="k">return</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
</span><span id="MarkupLanguage-633"><a href="#MarkupLanguage-633"><span class="linenos"> 633</span></a>
</span><span id="MarkupLanguage-634"><a href="#MarkupLanguage-634"><span class="linenos"> 634</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-635"><a href="#MarkupLanguage-635"><span class="linenos"> 635</span></a>
</span><span id="MarkupLanguage-636"><a href="#MarkupLanguage-636"><span class="linenos"> 636</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-637"><a href="#MarkupLanguage-637"><span class="linenos"> 637</span></a>        <span class="sd">&quot;&quot;&quot;Parse all arguments and pass them through to print, along with kwargs.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-638"><a href="#MarkupLanguage-638"><span class="linenos"> 638</span></a>
</span><span id="MarkupLanguage-639"><a href="#MarkupLanguage-639"><span class="linenos"> 639</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-640"><a href="#MarkupLanguage-640"><span class="linenos"> 640</span></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="MarkupLanguage-641"><a href="#MarkupLanguage-641"><span class="linenos"> 641</span></a>            <span class="n">parsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</span><span id="MarkupLanguage-642"><a href="#MarkupLanguage-642"><span class="linenos"> 642</span></a>
</span><span id="MarkupLanguage-643"><a href="#MarkupLanguage-643"><span class="linenos"> 643</span></a>        <span class="n">get_terminal</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">parsed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="MarkupLanguage-644"><a href="#MarkupLanguage-644"><span class="linenos"> 644</span></a>
</span><span id="MarkupLanguage-645"><a href="#MarkupLanguage-645"><span class="linenos"> 645</span></a>    <span class="k">def</span> <span class="nf">tokenize_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage-646"><a href="#MarkupLanguage-646"><span class="linenos"> 646</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given markup string into an iterator of `Token`.</span>
</span><span id="MarkupLanguage-647"><a href="#MarkupLanguage-647"><span class="linenos"> 647</span></a>
</span><span id="MarkupLanguage-648"><a href="#MarkupLanguage-648"><span class="linenos"> 648</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-649"><a href="#MarkupLanguage-649"><span class="linenos"> 649</span></a><span class="sd">            markup_text: The text to look at.</span>
</span><span id="MarkupLanguage-650"><a href="#MarkupLanguage-650"><span class="linenos"> 650</span></a>
</span><span id="MarkupLanguage-651"><a href="#MarkupLanguage-651"><span class="linenos"> 651</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-652"><a href="#MarkupLanguage-652"><span class="linenos"> 652</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="MarkupLanguage-653"><a href="#MarkupLanguage-653"><span class="linenos"> 653</span></a><span class="sd">            on memory.</span>
</span><span id="MarkupLanguage-654"><a href="#MarkupLanguage-654"><span class="linenos"> 654</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-655"><a href="#MarkupLanguage-655"><span class="linenos"> 655</span></a>
</span><span id="MarkupLanguage-656"><a href="#MarkupLanguage-656"><span class="linenos"> 656</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-657"><a href="#MarkupLanguage-657"><span class="linenos"> 657</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-658"><a href="#MarkupLanguage-658"><span class="linenos"> 658</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-659"><a href="#MarkupLanguage-659"><span class="linenos"> 659</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_MARKUP</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="MarkupLanguage-660"><a href="#MarkupLanguage-660"><span class="linenos"> 660</span></a>            <span class="n">full</span><span class="p">,</span> <span class="n">escapes</span><span class="p">,</span> <span class="n">tag_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="MarkupLanguage-661"><a href="#MarkupLanguage-661"><span class="linenos"> 661</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="MarkupLanguage-662"><a href="#MarkupLanguage-662"><span class="linenos"> 662</span></a>
</span><span id="MarkupLanguage-663"><a href="#MarkupLanguage-663"><span class="linenos"> 663</span></a>            <span class="c1"># Add plain text between last and current match</span>
</span><span id="MarkupLanguage-664"><a href="#MarkupLanguage-664"><span class="linenos"> 664</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage-665"><a href="#MarkupLanguage-665"><span class="linenos"> 665</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span id="MarkupLanguage-666"><a href="#MarkupLanguage-666"><span class="linenos"> 666</span></a>
</span><span id="MarkupLanguage-667"><a href="#MarkupLanguage-667"><span class="linenos"> 667</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">escapes</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage-668"><a href="#MarkupLanguage-668"><span class="linenos"> 668</span></a>                <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage-669"><a href="#MarkupLanguage-669"><span class="linenos"> 669</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:])</span>
</span><span id="MarkupLanguage-670"><a href="#MarkupLanguage-670"><span class="linenos"> 670</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-671"><a href="#MarkupLanguage-671"><span class="linenos"> 671</span></a>
</span><span id="MarkupLanguage-672"><a href="#MarkupLanguage-672"><span class="linenos"> 672</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="MarkupLanguage-673"><a href="#MarkupLanguage-673"><span class="linenos"> 673</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_style_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage-674"><a href="#MarkupLanguage-674"><span class="linenos"> 674</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-675"><a href="#MarkupLanguage-675"><span class="linenos"> 675</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="MarkupLanguage-676"><a href="#MarkupLanguage-676"><span class="linenos"> 676</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-677"><a href="#MarkupLanguage-677"><span class="linenos"> 677</span></a>
</span><span id="MarkupLanguage-678"><a href="#MarkupLanguage-678"><span class="linenos"> 678</span></a>                <span class="c1"># Try to find a color token</span>
</span><span id="MarkupLanguage-679"><a href="#MarkupLanguage-679"><span class="linenos"> 679</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_color_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage-680"><a href="#MarkupLanguage-680"><span class="linenos"> 680</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-681"><a href="#MarkupLanguage-681"><span class="linenos"> 681</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="MarkupLanguage-682"><a href="#MarkupLanguage-682"><span class="linenos"> 682</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-683"><a href="#MarkupLanguage-683"><span class="linenos"> 683</span></a>
</span><span id="MarkupLanguage-684"><a href="#MarkupLanguage-684"><span class="linenos"> 684</span></a>                <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage-685"><a href="#MarkupLanguage-685"><span class="linenos"> 685</span></a>                <span class="k">if</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-686"><a href="#MarkupLanguage-686"><span class="linenos"> 686</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="MarkupLanguage-687"><a href="#MarkupLanguage-687"><span class="linenos"> 687</span></a>                    <span class="n">macro_args</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-688"><a href="#MarkupLanguage-688"><span class="linenos"> 688</span></a>
</span><span id="MarkupLanguage-689"><a href="#MarkupLanguage-689"><span class="linenos"> 689</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="MarkupLanguage-690"><a href="#MarkupLanguage-690"><span class="linenos"> 690</span></a>                        <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage-691"><a href="#MarkupLanguage-691"><span class="linenos"> 691</span></a>                            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="MarkupLanguage-692"><a href="#MarkupLanguage-692"><span class="linenos"> 692</span></a>                            <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;is not a defined macro&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage-693"><a href="#MarkupLanguage-693"><span class="linenos"> 693</span></a>                            <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span><span class="p">,</span>
</span><span id="MarkupLanguage-694"><a href="#MarkupLanguage-694"><span class="linenos"> 694</span></a>                        <span class="p">)</span>
</span><span id="MarkupLanguage-695"><a href="#MarkupLanguage-695"><span class="linenos"> 695</span></a>
</span><span id="MarkupLanguage-696"><a href="#MarkupLanguage-696"><span class="linenos"> 696</span></a>                    <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="MarkupLanguage-697"><a href="#MarkupLanguage-697"><span class="linenos"> 697</span></a>                        <span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="MarkupLanguage-698"><a href="#MarkupLanguage-698"><span class="linenos"> 698</span></a>                        <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">,</span>
</span><span id="MarkupLanguage-699"><a href="#MarkupLanguage-699"><span class="linenos"> 699</span></a>                        <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">macro_args</span><span class="p">),</span>
</span><span id="MarkupLanguage-700"><a href="#MarkupLanguage-700"><span class="linenos"> 700</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage-701"><a href="#MarkupLanguage-701"><span class="linenos"> 701</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-702"><a href="#MarkupLanguage-702"><span class="linenos"> 702</span></a>
</span><span id="MarkupLanguage-703"><a href="#MarkupLanguage-703"><span class="linenos"> 703</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_unknown_markup</span><span class="p">:</span>
</span><span id="MarkupLanguage-704"><a href="#MarkupLanguage-704"><span class="linenos"> 704</span></a>                    <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage-705"><a href="#MarkupLanguage-705"><span class="linenos"> 705</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not defined&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span>
</span><span id="MarkupLanguage-706"><a href="#MarkupLanguage-706"><span class="linenos"> 706</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage-707"><a href="#MarkupLanguage-707"><span class="linenos"> 707</span></a>
</span><span id="MarkupLanguage-708"><a href="#MarkupLanguage-708"><span class="linenos"> 708</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage-709"><a href="#MarkupLanguage-709"><span class="linenos"> 709</span></a>
</span><span id="MarkupLanguage-710"><a href="#MarkupLanguage-710"><span class="linenos"> 710</span></a>        <span class="c1"># Add remaining text as plain</span>
</span><span id="MarkupLanguage-711"><a href="#MarkupLanguage-711"><span class="linenos"> 711</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markup_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage-712"><a href="#MarkupLanguage-712"><span class="linenos"> 712</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:])</span>
</span><span id="MarkupLanguage-713"><a href="#MarkupLanguage-713"><span class="linenos"> 713</span></a>
</span><span id="MarkupLanguage-714"><a href="#MarkupLanguage-714"><span class="linenos"> 714</span></a>    <span class="k">def</span> <span class="nf">tokenize_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage-715"><a href="#MarkupLanguage-715"><span class="linenos"> 715</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given ANSI string into an iterator of `Token`.</span>
</span><span id="MarkupLanguage-716"><a href="#MarkupLanguage-716"><span class="linenos"> 716</span></a>
</span><span id="MarkupLanguage-717"><a href="#MarkupLanguage-717"><span class="linenos"> 717</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-718"><a href="#MarkupLanguage-718"><span class="linenos"> 718</span></a><span class="sd">            ansi: The text to look at.</span>
</span><span id="MarkupLanguage-719"><a href="#MarkupLanguage-719"><span class="linenos"> 719</span></a>
</span><span id="MarkupLanguage-720"><a href="#MarkupLanguage-720"><span class="linenos"> 720</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-721"><a href="#MarkupLanguage-721"><span class="linenos"> 721</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="MarkupLanguage-722"><a href="#MarkupLanguage-722"><span class="linenos"> 722</span></a><span class="sd">            on memory.</span>
</span><span id="MarkupLanguage-723"><a href="#MarkupLanguage-723"><span class="linenos"> 723</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-724"><a href="#MarkupLanguage-724"><span class="linenos"> 724</span></a>
</span><span id="MarkupLanguage-725"><a href="#MarkupLanguage-725"><span class="linenos"> 725</span></a>        <span class="k">def</span> <span class="nf">_is_in_tags</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-726"><a href="#MarkupLanguage-726"><span class="linenos"> 726</span></a>            <span class="sd">&quot;&quot;&quot;Determines whether a code is in the given dict of tags.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-727"><a href="#MarkupLanguage-727"><span class="linenos"> 727</span></a>
</span><span id="MarkupLanguage-728"><a href="#MarkupLanguage-728"><span class="linenos"> 728</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MarkupLanguage-729"><a href="#MarkupLanguage-729"><span class="linenos"> 729</span></a>                <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">code</span><span class="p">:</span>
</span><span id="MarkupLanguage-730"><a href="#MarkupLanguage-730"><span class="linenos"> 730</span></a>                    <span class="k">return</span> <span class="n">name</span>
</span><span id="MarkupLanguage-731"><a href="#MarkupLanguage-731"><span class="linenos"> 731</span></a>
</span><span id="MarkupLanguage-732"><a href="#MarkupLanguage-732"><span class="linenos"> 732</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-733"><a href="#MarkupLanguage-733"><span class="linenos"> 733</span></a>
</span><span id="MarkupLanguage-734"><a href="#MarkupLanguage-734"><span class="linenos"> 734</span></a>        <span class="k">def</span> <span class="nf">_generate_color</span><span class="p">(</span>
</span><span id="MarkupLanguage-735"><a href="#MarkupLanguage-735"><span class="linenos"> 735</span></a>            <span class="n">parts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MarkupLanguage-736"><a href="#MarkupLanguage-736"><span class="linenos"> 736</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenType</span><span class="p">,</span> <span class="n">Color</span><span class="p">]:</span>
</span><span id="MarkupLanguage-737"><a href="#MarkupLanguage-737"><span class="linenos"> 737</span></a>            <span class="sd">&quot;&quot;&quot;Generates a color token.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-738"><a href="#MarkupLanguage-738"><span class="linenos"> 738</span></a>
</span><span id="MarkupLanguage-739"><a href="#MarkupLanguage-739"><span class="linenos"> 739</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">Color</span>
</span><span id="MarkupLanguage-740"><a href="#MarkupLanguage-740"><span class="linenos"> 740</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage-741"><a href="#MarkupLanguage-741"><span class="linenos"> 741</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">StandardColor</span><span class="o">.</span><span class="n">from_ansi</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage-742"><a href="#MarkupLanguage-742"><span class="linenos"> 742</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage-743"><a href="#MarkupLanguage-743"><span class="linenos"> 743</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="MarkupLanguage-744"><a href="#MarkupLanguage-744"><span class="linenos"> 744</span></a>
</span><span id="MarkupLanguage-745"><a href="#MarkupLanguage-745"><span class="linenos"> 745</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage-746"><a href="#MarkupLanguage-746"><span class="linenos"> 746</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">str_to_color</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage-747"><a href="#MarkupLanguage-747"><span class="linenos"> 747</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage-748"><a href="#MarkupLanguage-748"><span class="linenos"> 748</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="MarkupLanguage-749"><a href="#MarkupLanguage-749"><span class="linenos"> 749</span></a>
</span><span id="MarkupLanguage-750"><a href="#MarkupLanguage-750"><span class="linenos"> 750</span></a>            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MarkupLanguage-751"><a href="#MarkupLanguage-751"><span class="linenos"> 751</span></a>
</span><span id="MarkupLanguage-752"><a href="#MarkupLanguage-752"><span class="linenos"> 752</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-753"><a href="#MarkupLanguage-753"><span class="linenos"> 753</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-754"><a href="#MarkupLanguage-754"><span class="linenos"> 754</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-755"><a href="#MarkupLanguage-755"><span class="linenos"> 755</span></a>
</span><span id="MarkupLanguage-756"><a href="#MarkupLanguage-756"><span class="linenos"> 756</span></a>        <span class="c1"># StyledText messes with indexing, so we need to cast it</span>
</span><span id="MarkupLanguage-757"><a href="#MarkupLanguage-757"><span class="linenos"> 757</span></a>        <span class="c1"># back to str.</span>
</span><span id="MarkupLanguage-758"><a href="#MarkupLanguage-758"><span class="linenos"> 758</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ansi</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">):</span>
</span><span id="MarkupLanguage-759"><a href="#MarkupLanguage-759"><span class="linenos"> 759</span></a>            <span class="n">ansi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ansi</span><span class="p">)</span>
</span><span id="MarkupLanguage-760"><a href="#MarkupLanguage-760"><span class="linenos"> 760</span></a>
</span><span id="MarkupLanguage-761"><a href="#MarkupLanguage-761"><span class="linenos"> 761</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_ANSI</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage-762"><a href="#MarkupLanguage-762"><span class="linenos"> 762</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage-763"><a href="#MarkupLanguage-763"><span class="linenos"> 763</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="MarkupLanguage-764"><a href="#MarkupLanguage-764"><span class="linenos"> 764</span></a>
</span><span id="MarkupLanguage-765"><a href="#MarkupLanguage-765"><span class="linenos"> 765</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-766"><a href="#MarkupLanguage-766"><span class="linenos"> 766</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-767"><a href="#MarkupLanguage-767"><span class="linenos"> 767</span></a>
</span><span id="MarkupLanguage-768"><a href="#MarkupLanguage-768"><span class="linenos"> 768</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-769"><a href="#MarkupLanguage-769"><span class="linenos"> 769</span></a>
</span><span id="MarkupLanguage-770"><a href="#MarkupLanguage-770"><span class="linenos"> 770</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage-771"><a href="#MarkupLanguage-771"><span class="linenos"> 771</span></a>                <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
</span><span id="MarkupLanguage-772"><a href="#MarkupLanguage-772"><span class="linenos"> 772</span></a>
</span><span id="MarkupLanguage-773"><a href="#MarkupLanguage-773"><span class="linenos"> 773</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">plain</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span><span id="MarkupLanguage-774"><a href="#MarkupLanguage-774"><span class="linenos"> 774</span></a>
</span><span id="MarkupLanguage-775"><a href="#MarkupLanguage-775"><span class="linenos"> 775</span></a>            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">code</span>
</span><span id="MarkupLanguage-776"><a href="#MarkupLanguage-776"><span class="linenos"> 776</span></a>            <span class="n">ttype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-777"><a href="#MarkupLanguage-777"><span class="linenos"> 777</span></a>            <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage-778"><a href="#MarkupLanguage-778"><span class="linenos"> 778</span></a>
</span><span id="MarkupLanguage-779"><a href="#MarkupLanguage-779"><span class="linenos"> 779</span></a>            <span class="c1"># Styles &amp; Unsetters</span>
</span><span id="MarkupLanguage-780"><a href="#MarkupLanguage-780"><span class="linenos"> 780</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage-781"><a href="#MarkupLanguage-781"><span class="linenos"> 781</span></a>                <span class="c1"># Covariancy is not an issue here, even though mypy seems to think so.</span>
</span><span id="MarkupLanguage-782"><a href="#MarkupLanguage-782"><span class="linenos"> 782</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="MarkupLanguage-783"><a href="#MarkupLanguage-783"><span class="linenos"> 783</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-784"><a href="#MarkupLanguage-784"><span class="linenos"> 784</span></a>                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span>
</span><span id="MarkupLanguage-785"><a href="#MarkupLanguage-785"><span class="linenos"> 785</span></a>
</span><span id="MarkupLanguage-786"><a href="#MarkupLanguage-786"><span class="linenos"> 786</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage-787"><a href="#MarkupLanguage-787"><span class="linenos"> 787</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="MarkupLanguage-788"><a href="#MarkupLanguage-788"><span class="linenos"> 788</span></a>                    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-789"><a href="#MarkupLanguage-789"><span class="linenos"> 789</span></a>                        <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span>
</span><span id="MarkupLanguage-790"><a href="#MarkupLanguage-790"><span class="linenos"> 790</span></a>
</span><span id="MarkupLanguage-791"><a href="#MarkupLanguage-791"><span class="linenos"> 791</span></a>            <span class="c1"># Colors</span>
</span><span id="MarkupLanguage-792"><a href="#MarkupLanguage-792"><span class="linenos"> 792</span></a>            <span class="k">if</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-793"><a href="#MarkupLanguage-793"><span class="linenos"> 793</span></a>                <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">ColorSyntaxError</span><span class="p">):</span>
</span><span id="MarkupLanguage-794"><a href="#MarkupLanguage-794"><span class="linenos"> 794</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_generate_color</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage-795"><a href="#MarkupLanguage-795"><span class="linenos"> 795</span></a>
</span><span id="MarkupLanguage-796"><a href="#MarkupLanguage-796"><span class="linenos"> 796</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-797"><a href="#MarkupLanguage-797"><span class="linenos"> 797</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MarkupLanguage-798"><a href="#MarkupLanguage-798"><span class="linenos"> 798</span></a>                    <span class="k">raise</span> <span class="n">AnsiSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage-799"><a href="#MarkupLanguage-799"><span class="linenos"> 799</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not recognized&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ansi</span>
</span><span id="MarkupLanguage-800"><a href="#MarkupLanguage-800"><span class="linenos"> 800</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage-801"><a href="#MarkupLanguage-801"><span class="linenos"> 801</span></a>
</span><span id="MarkupLanguage-802"><a href="#MarkupLanguage-802"><span class="linenos"> 802</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
</span><span id="MarkupLanguage-803"><a href="#MarkupLanguage-803"><span class="linenos"> 803</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span>
</span><span id="MarkupLanguage-804"><a href="#MarkupLanguage-804"><span class="linenos"> 804</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
</span><span id="MarkupLanguage-805"><a href="#MarkupLanguage-805"><span class="linenos"> 805</span></a>
</span><span id="MarkupLanguage-806"><a href="#MarkupLanguage-806"><span class="linenos"> 806</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">ttype</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="MarkupLanguage-807"><a href="#MarkupLanguage-807"><span class="linenos"> 807</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage-808"><a href="#MarkupLanguage-808"><span class="linenos"> 808</span></a>
</span><span id="MarkupLanguage-809"><a href="#MarkupLanguage-809"><span class="linenos"> 809</span></a>        <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage-810"><a href="#MarkupLanguage-810"><span class="linenos"> 810</span></a>            <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:]</span>
</span><span id="MarkupLanguage-811"><a href="#MarkupLanguage-811"><span class="linenos"> 811</span></a>
</span><span id="MarkupLanguage-812"><a href="#MarkupLanguage-812"><span class="linenos"> 812</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span><span id="MarkupLanguage-813"><a href="#MarkupLanguage-813"><span class="linenos"> 813</span></a>
</span><span id="MarkupLanguage-814"><a href="#MarkupLanguage-814"><span class="linenos"> 814</span></a>    <span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">MacroCallable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-815"><a href="#MarkupLanguage-815"><span class="linenos"> 815</span></a>        <span class="sd">&quot;&quot;&quot;Defines a Macro tag that executes the given method.</span>
</span><span id="MarkupLanguage-816"><a href="#MarkupLanguage-816"><span class="linenos"> 816</span></a>
</span><span id="MarkupLanguage-817"><a href="#MarkupLanguage-817"><span class="linenos"> 817</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-818"><a href="#MarkupLanguage-818"><span class="linenos"> 818</span></a><span class="sd">            name: The name the given method will be reachable by within markup.</span>
</span><span id="MarkupLanguage-819"><a href="#MarkupLanguage-819"><span class="linenos"> 819</span></a><span class="sd">                The given value gets &quot;!&quot; prepended if it isn&#39;t present already.</span>
</span><span id="MarkupLanguage-820"><a href="#MarkupLanguage-820"><span class="linenos"> 820</span></a><span class="sd">            method: The method this macro will execute.</span>
</span><span id="MarkupLanguage-821"><a href="#MarkupLanguage-821"><span class="linenos"> 821</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-822"><a href="#MarkupLanguage-822"><span class="linenos"> 822</span></a>
</span><span id="MarkupLanguage-823"><a href="#MarkupLanguage-823"><span class="linenos"> 823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-824"><a href="#MarkupLanguage-824"><span class="linenos"> 824</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;!</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage-825"><a href="#MarkupLanguage-825"><span class="linenos"> 825</span></a>
</span><span id="MarkupLanguage-826"><a href="#MarkupLanguage-826"><span class="linenos"> 826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
</span><span id="MarkupLanguage-827"><a href="#MarkupLanguage-827"><span class="linenos"> 827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-828"><a href="#MarkupLanguage-828"><span class="linenos"> 828</span></a>
</span><span id="MarkupLanguage-829"><a href="#MarkupLanguage-829"><span class="linenos"> 829</span></a>    <span class="k">def</span> <span class="nf">alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-830"><a href="#MarkupLanguage-830"><span class="linenos"> 830</span></a>        <span class="sd">&quot;&quot;&quot;Aliases the given name to a value, and generates an unsetter for it.</span>
</span><span id="MarkupLanguage-831"><a href="#MarkupLanguage-831"><span class="linenos"> 831</span></a>
</span><span id="MarkupLanguage-832"><a href="#MarkupLanguage-832"><span class="linenos"> 832</span></a><span class="sd">        Note that it is not possible to alias macros.</span>
</span><span id="MarkupLanguage-833"><a href="#MarkupLanguage-833"><span class="linenos"> 833</span></a>
</span><span id="MarkupLanguage-834"><a href="#MarkupLanguage-834"><span class="linenos"> 834</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-835"><a href="#MarkupLanguage-835"><span class="linenos"> 835</span></a><span class="sd">            name: The name of the new tag.</span>
</span><span id="MarkupLanguage-836"><a href="#MarkupLanguage-836"><span class="linenos"> 836</span></a><span class="sd">            value: The value the new tag will stand for.</span>
</span><span id="MarkupLanguage-837"><a href="#MarkupLanguage-837"><span class="linenos"> 837</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-838"><a href="#MarkupLanguage-838"><span class="linenos"> 838</span></a>
</span><span id="MarkupLanguage-839"><a href="#MarkupLanguage-839"><span class="linenos"> 839</span></a>        <span class="k">def</span> <span class="nf">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-840"><a href="#MarkupLanguage-840"><span class="linenos"> 840</span></a>            <span class="sd">&quot;&quot;&quot;Get unsetter for a token&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-841"><a href="#MarkupLanguage-841"><span class="linenos"> 841</span></a>
</span><span id="MarkupLanguage-842"><a href="#MarkupLanguage-842"><span class="linenos"> 842</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage-843"><a href="#MarkupLanguage-843"><span class="linenos"> 843</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-844"><a href="#MarkupLanguage-844"><span class="linenos"> 844</span></a>
</span><span id="MarkupLanguage-845"><a href="#MarkupLanguage-845"><span class="linenos"> 845</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage-846"><a href="#MarkupLanguage-846"><span class="linenos"> 846</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="MarkupLanguage-847"><a href="#MarkupLanguage-847"><span class="linenos"> 847</span></a>
</span><span id="MarkupLanguage-848"><a href="#MarkupLanguage-848"><span class="linenos"> 848</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage-849"><a href="#MarkupLanguage-849"><span class="linenos"> 849</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage-850"><a href="#MarkupLanguage-850"><span class="linenos"> 850</span></a>
</span><span id="MarkupLanguage-851"><a href="#MarkupLanguage-851"><span class="linenos"> 851</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage-852"><a href="#MarkupLanguage-852"><span class="linenos"> 852</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/bg&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage-853"><a href="#MarkupLanguage-853"><span class="linenos"> 853</span></a>
</span><span id="MarkupLanguage-854"><a href="#MarkupLanguage-854"><span class="linenos"> 854</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/fg&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage-855"><a href="#MarkupLanguage-855"><span class="linenos"> 855</span></a>
</span><span id="MarkupLanguage-856"><a href="#MarkupLanguage-856"><span class="linenos"> 856</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage-857"><a href="#MarkupLanguage-857"><span class="linenos"> 857</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span>
</span><span id="MarkupLanguage-858"><a href="#MarkupLanguage-858"><span class="linenos"> 858</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find unsetter for token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-859"><a href="#MarkupLanguage-859"><span class="linenos"> 859</span></a>
</span><span id="MarkupLanguage-860"><a href="#MarkupLanguage-860"><span class="linenos"> 860</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="MarkupLanguage-861"><a href="#MarkupLanguage-861"><span class="linenos"> 861</span></a>
</span><span id="MarkupLanguage-862"><a href="#MarkupLanguage-862"><span class="linenos"> 862</span></a>        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-863"><a href="#MarkupLanguage-863"><span class="linenos"> 863</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only macro tags can always start with &quot;!&quot;.&#39;</span><span class="p">)</span>
</span><span id="MarkupLanguage-864"><a href="#MarkupLanguage-864"><span class="linenos"> 864</span></a>
</span><span id="MarkupLanguage-865"><a href="#MarkupLanguage-865"><span class="linenos"> 865</span></a>        <span class="n">setter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-866"><a href="#MarkupLanguage-866"><span class="linenos"> 866</span></a>        <span class="n">unsetter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-867"><a href="#MarkupLanguage-867"><span class="linenos"> 867</span></a>
</span><span id="MarkupLanguage-868"><a href="#MarkupLanguage-868"><span class="linenos"> 868</span></a>        <span class="c1"># Try to link to existing tag</span>
</span><span id="MarkupLanguage-869"><a href="#MarkupLanguage-869"><span class="linenos"> 869</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="MarkupLanguage-870"><a href="#MarkupLanguage-870"><span class="linenos"> 870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage-871"><a href="#MarkupLanguage-871"><span class="linenos"> 871</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
</span><span id="MarkupLanguage-872"><a href="#MarkupLanguage-872"><span class="linenos"> 872</span></a>            <span class="k">return</span>
</span><span id="MarkupLanguage-873"><a href="#MarkupLanguage-873"><span class="linenos"> 873</span></a>
</span><span id="MarkupLanguage-874"><a href="#MarkupLanguage-874"><span class="linenos"> 874</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-875"><a href="#MarkupLanguage-875"><span class="linenos"> 875</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage-876"><a href="#MarkupLanguage-876"><span class="linenos"> 876</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-877"><a href="#MarkupLanguage-877"><span class="linenos"> 877</span></a>
</span><span id="MarkupLanguage-878"><a href="#MarkupLanguage-878"><span class="linenos"> 878</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-879"><a href="#MarkupLanguage-879"><span class="linenos"> 879</span></a>            <span class="n">setter</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage-880"><a href="#MarkupLanguage-880"><span class="linenos"> 880</span></a>
</span><span id="MarkupLanguage-881"><a href="#MarkupLanguage-881"><span class="linenos"> 881</span></a>            <span class="n">t_unsetter</span> <span class="o">=</span> <span class="n">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-882"><a href="#MarkupLanguage-882"><span class="linenos"> 882</span></a>            <span class="n">unsetter</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">t_unsetter</span><span class="si">}</span><span class="s2">m&quot;</span>
</span><span id="MarkupLanguage-883"><a href="#MarkupLanguage-883"><span class="linenos"> 883</span></a>
</span><span id="MarkupLanguage-884"><a href="#MarkupLanguage-884"><span class="linenos"> 884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unsetter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-885"><a href="#MarkupLanguage-885"><span class="linenos"> 885</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">setter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-886"><a href="#MarkupLanguage-886"><span class="linenos"> 886</span></a>
</span><span id="MarkupLanguage-887"><a href="#MarkupLanguage-887"><span class="linenos"> 887</span></a>        <span class="n">marked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-888"><a href="#MarkupLanguage-888"><span class="linenos"> 888</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
</span><span id="MarkupLanguage-889"><a href="#MarkupLanguage-889"><span class="linenos"> 889</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span><span id="MarkupLanguage-890"><a href="#MarkupLanguage-890"><span class="linenos"> 890</span></a>                <span class="n">marked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="MarkupLanguage-891"><a href="#MarkupLanguage-891"><span class="linenos"> 891</span></a>
</span><span id="MarkupLanguage-892"><a href="#MarkupLanguage-892"><span class="linenos"> 892</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
</span><span id="MarkupLanguage-893"><a href="#MarkupLanguage-893"><span class="linenos"> 893</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</span><span id="MarkupLanguage-894"><a href="#MarkupLanguage-894"><span class="linenos"> 894</span></a>
</span><span id="MarkupLanguage-895"><a href="#MarkupLanguage-895"><span class="linenos"> 895</span></a>    <span class="c1"># TODO: I cannot cut down the one-too-many branch that this has at the moment.</span>
</span><span id="MarkupLanguage-896"><a href="#MarkupLanguage-896"><span class="linenos"> 896</span></a>    <span class="c1">#       We could look into it in the future, however.</span>
</span><span id="MarkupLanguage-897"><a href="#MarkupLanguage-897"><span class="linenos"> 897</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-branches</span>
</span><span id="MarkupLanguage-898"><a href="#MarkupLanguage-898"><span class="linenos"> 898</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MarkupLanguage-899"><a href="#MarkupLanguage-899"><span class="linenos"> 899</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StyledText</span><span class="p">:</span>
</span><span id="MarkupLanguage-900"><a href="#MarkupLanguage-900"><span class="linenos"> 900</span></a>        <span class="sd">&quot;&quot;&quot;Parses the given markup.</span>
</span><span id="MarkupLanguage-901"><a href="#MarkupLanguage-901"><span class="linenos"> 901</span></a>
</span><span id="MarkupLanguage-902"><a href="#MarkupLanguage-902"><span class="linenos"> 902</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-903"><a href="#MarkupLanguage-903"><span class="linenos"> 903</span></a><span class="sd">            markup_text: The markup to parse.</span>
</span><span id="MarkupLanguage-904"><a href="#MarkupLanguage-904"><span class="linenos"> 904</span></a>
</span><span id="MarkupLanguage-905"><a href="#MarkupLanguage-905"><span class="linenos"> 905</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-906"><a href="#MarkupLanguage-906"><span class="linenos"> 906</span></a><span class="sd">            A `StyledText` instance of the result of parsing the input. This</span>
</span><span id="MarkupLanguage-907"><a href="#MarkupLanguage-907"><span class="linenos"> 907</span></a><span class="sd">            custom `str` class is used to allow accessing the plain value of</span>
</span><span id="MarkupLanguage-908"><a href="#MarkupLanguage-908"><span class="linenos"> 908</span></a><span class="sd">            the output, as well as to cleanly index within it. It is analogous</span>
</span><span id="MarkupLanguage-909"><a href="#MarkupLanguage-909"><span class="linenos"> 909</span></a><span class="sd">            to builtin `str`, only adds extra things on top.</span>
</span><span id="MarkupLanguage-910"><a href="#MarkupLanguage-910"><span class="linenos"> 910</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-911"><a href="#MarkupLanguage-911"><span class="linenos"> 911</span></a>
</span><span id="MarkupLanguage-912"><a href="#MarkupLanguage-912"><span class="linenos"> 912</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-913"><a href="#MarkupLanguage-913"><span class="linenos"> 913</span></a>        <span class="n">previous_token</span><span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-914"><a href="#MarkupLanguage-914"><span class="linenos"> 914</span></a>        <span class="n">previous_sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-915"><a href="#MarkupLanguage-915"><span class="linenos"> 915</span></a>        <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-916"><a href="#MarkupLanguage-916"><span class="linenos"> 916</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-917"><a href="#MarkupLanguage-917"><span class="linenos"> 917</span></a>
</span><span id="MarkupLanguage-918"><a href="#MarkupLanguage-918"><span class="linenos"> 918</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-919"><a href="#MarkupLanguage-919"><span class="linenos"> 919</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-920"><a href="#MarkupLanguage-920"><span class="linenos"> 920</span></a>
</span><span id="MarkupLanguage-921"><a href="#MarkupLanguage-921"><span class="linenos"> 921</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage-922"><a href="#MarkupLanguage-922"><span class="linenos"> 922</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage-923"><a href="#MarkupLanguage-923"><span class="linenos"> 923</span></a>
</span><span id="MarkupLanguage-924"><a href="#MarkupLanguage-924"><span class="linenos"> 924</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage-925"><a href="#MarkupLanguage-925"><span class="linenos"> 925</span></a>
</span><span id="MarkupLanguage-926"><a href="#MarkupLanguage-926"><span class="linenos"> 926</span></a>        <span class="k">def</span> <span class="nf">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MarkupLanguage-927"><a href="#MarkupLanguage-927"><span class="linenos"> 927</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">):</span>
</span><span id="MarkupLanguage-928"><a href="#MarkupLanguage-928"><span class="linenos"> 928</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="MarkupLanguage-929"><a href="#MarkupLanguage-929"><span class="linenos"> 929</span></a>
</span><span id="MarkupLanguage-930"><a href="#MarkupLanguage-930"><span class="linenos"> 930</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="MarkupLanguage-931"><a href="#MarkupLanguage-931"><span class="linenos"> 931</span></a>                <span class="nb">type</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</span><span id="MarkupLanguage-932"><a href="#MarkupLanguage-932"><span class="linenos"> 932</span></a>                <span class="ow">and</span> <span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span>
</span><span id="MarkupLanguage-933"><a href="#MarkupLanguage-933"><span class="linenos"> 933</span></a>            <span class="p">)</span>
</span><span id="MarkupLanguage-934"><a href="#MarkupLanguage-934"><span class="linenos"> 934</span></a>
</span><span id="MarkupLanguage-935"><a href="#MarkupLanguage-935"><span class="linenos"> 935</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="MarkupLanguage-936"><a href="#MarkupLanguage-936"><span class="linenos"> 936</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span>
</span><span id="MarkupLanguage-937"><a href="#MarkupLanguage-937"><span class="linenos"> 937</span></a>            <span class="ow">and</span> <span class="n">markup_text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span>
</span><span id="MarkupLanguage-938"><a href="#MarkupLanguage-938"><span class="linenos"> 938</span></a>            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">RE_MACRO</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">markup_text</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MarkupLanguage-939"><a href="#MarkupLanguage-939"><span class="linenos"> 939</span></a>        <span class="p">):</span>
</span><span id="MarkupLanguage-940"><a href="#MarkupLanguage-940"><span class="linenos"> 940</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span>
</span><span id="MarkupLanguage-941"><a href="#MarkupLanguage-941"><span class="linenos"> 941</span></a>
</span><span id="MarkupLanguage-942"><a href="#MarkupLanguage-942"><span class="linenos"> 942</span></a>        <span class="n">token</span><span class="p">:</span> <span class="n">Token</span>
</span><span id="MarkupLanguage-943"><a href="#MarkupLanguage-943"><span class="linenos"> 943</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="MarkupLanguage-944"><a href="#MarkupLanguage-944"><span class="linenos"> 944</span></a>            <span class="k">if</span> <span class="n">sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">previous_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">:</span>
</span><span id="MarkupLanguage-945"><a href="#MarkupLanguage-945"><span class="linenos"> 945</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-946"><a href="#MarkupLanguage-946"><span class="linenos"> 946</span></a>
</span><span id="MarkupLanguage-947"><a href="#MarkupLanguage-947"><span class="linenos"> 947</span></a>            <span class="c1"># Optimize out previously added color tokens, as only the most</span>
</span><span id="MarkupLanguage-948"><a href="#MarkupLanguage-948"><span class="linenos"> 948</span></a>            <span class="c1"># recent would be visible anyways.</span>
</span><span id="MarkupLanguage-949"><a href="#MarkupLanguage-949"><span class="linenos"> 949</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MarkupLanguage-950"><a href="#MarkupLanguage-950"><span class="linenos"> 950</span></a>                <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-951"><a href="#MarkupLanguage-951"><span class="linenos"> 951</span></a>                <span class="ow">and</span> <span class="n">previous_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-952"><a href="#MarkupLanguage-952"><span class="linenos"> 952</span></a>                <span class="ow">and</span> <span class="n">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous_token</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-953"><a href="#MarkupLanguage-953"><span class="linenos"> 953</span></a>            <span class="p">):</span>
</span><span id="MarkupLanguage-954"><a href="#MarkupLanguage-954"><span class="linenos"> 954</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage-955"><a href="#MarkupLanguage-955"><span class="linenos"> 955</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-956"><a href="#MarkupLanguage-956"><span class="linenos"> 956</span></a>
</span><span id="MarkupLanguage-957"><a href="#MarkupLanguage-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage-958"><a href="#MarkupLanguage-958"><span class="linenos"> 958</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage-959"><a href="#MarkupLanguage-959"><span class="linenos"> 959</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-960"><a href="#MarkupLanguage-960"><span class="linenos"> 960</span></a>                <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-961"><a href="#MarkupLanguage-961"><span class="linenos"> 961</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-962"><a href="#MarkupLanguage-962"><span class="linenos"> 962</span></a>
</span><span id="MarkupLanguage-963"><a href="#MarkupLanguage-963"><span class="linenos"> 963</span></a>            <span class="n">previous_token</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="MarkupLanguage-964"><a href="#MarkupLanguage-964"><span class="linenos"> 964</span></a>
</span><span id="MarkupLanguage-965"><a href="#MarkupLanguage-965"><span class="linenos"> 965</span></a>            <span class="c1"># Macro unsetters are stored with None as their data</span>
</span><span id="MarkupLanguage-966"><a href="#MarkupLanguage-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage-967"><a href="#MarkupLanguage-967"><span class="linenos"> 967</span></a>                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="MarkupLanguage-968"><a href="#MarkupLanguage-968"><span class="linenos"> 968</span></a>                    <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="MarkupLanguage-969"><a href="#MarkupLanguage-969"><span class="linenos"> 969</span></a>                    <span class="k">assert</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-970"><a href="#MarkupLanguage-970"><span class="linenos"> 970</span></a>
</span><span id="MarkupLanguage-971"><a href="#MarkupLanguage-971"><span class="linenos"> 971</span></a>                    <span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage-972"><a href="#MarkupLanguage-972"><span class="linenos"> 972</span></a>
</span><span id="MarkupLanguage-973"><a href="#MarkupLanguage-973"><span class="linenos"> 973</span></a>                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">macro_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage-974"><a href="#MarkupLanguage-974"><span class="linenos"> 974</span></a>                        <span class="n">applied_macros</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage-975"><a href="#MarkupLanguage-975"><span class="linenos"> 975</span></a>
</span><span id="MarkupLanguage-976"><a href="#MarkupLanguage-976"><span class="linenos"> 976</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-977"><a href="#MarkupLanguage-977"><span class="linenos"> 977</span></a>
</span><span id="MarkupLanguage-978"><a href="#MarkupLanguage-978"><span class="linenos"> 978</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage-979"><a href="#MarkupLanguage-979"><span class="linenos"> 979</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage-980"><a href="#MarkupLanguage-980"><span class="linenos"> 980</span></a>
</span><span id="MarkupLanguage-981"><a href="#MarkupLanguage-981"><span class="linenos"> 981</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage-982"><a href="#MarkupLanguage-982"><span class="linenos"> 982</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-983"><a href="#MarkupLanguage-983"><span class="linenos"> 983</span></a>
</span><span id="MarkupLanguage-984"><a href="#MarkupLanguage-984"><span class="linenos"> 984</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-985"><a href="#MarkupLanguage-985"><span class="linenos"> 985</span></a>                <span class="n">applied</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="MarkupLanguage-986"><a href="#MarkupLanguage-986"><span class="linenos"> 986</span></a>
</span><span id="MarkupLanguage-987"><a href="#MarkupLanguage-987"><span class="linenos"> 987</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-988"><a href="#MarkupLanguage-988"><span class="linenos"> 988</span></a>                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">previous_sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-989"><a href="#MarkupLanguage-989"><span class="linenos"> 989</span></a>                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="MarkupLanguage-990"><a href="#MarkupLanguage-990"><span class="linenos"> 990</span></a>                            <span class="k">continue</span>
</span><span id="MarkupLanguage-991"><a href="#MarkupLanguage-991"><span class="linenos"> 991</span></a>
</span><span id="MarkupLanguage-992"><a href="#MarkupLanguage-992"><span class="linenos"> 992</span></a>                        <span class="n">item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage-993"><a href="#MarkupLanguage-993"><span class="linenos"> 993</span></a>                        <span class="n">applied</span> <span class="o">=</span> <span class="n">applied</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-994"><a href="#MarkupLanguage-994"><span class="linenos"> 994</span></a>
</span><span id="MarkupLanguage-995"><a href="#MarkupLanguage-995"><span class="linenos"> 995</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">applied</span> <span class="o">+</span> <span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage-996"><a href="#MarkupLanguage-996"><span class="linenos"> 996</span></a>                <span class="n">previous_sequence</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="MarkupLanguage-997"><a href="#MarkupLanguage-997"><span class="linenos"> 997</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-998"><a href="#MarkupLanguage-998"><span class="linenos"> 998</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-999"><a href="#MarkupLanguage-999"><span class="linenos"> 999</span></a>
</span><span id="MarkupLanguage-1000"><a href="#MarkupLanguage-1000"><span class="linenos">1000</span></a>            <span class="n">sequence</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage-1001"><a href="#MarkupLanguage-1001"><span class="linenos">1001</span></a>
</span><span id="MarkupLanguage-1002"><a href="#MarkupLanguage-1002"><span class="linenos">1002</span></a>        <span class="k">if</span> <span class="n">sequence</span> <span class="o">+</span> <span class="n">previous_sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage-1003"><a href="#MarkupLanguage-1003"><span class="linenos">1003</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage-1004"><a href="#MarkupLanguage-1004"><span class="linenos">1004</span></a>
</span><span id="MarkupLanguage-1005"><a href="#MarkupLanguage-1005"><span class="linenos">1005</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="MarkupLanguage-1006"><a href="#MarkupLanguage-1006"><span class="linenos">1006</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="MarkupLanguage-1007"><a href="#MarkupLanguage-1007"><span class="linenos">1007</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="MarkupLanguage-1008"><a href="#MarkupLanguage-1008"><span class="linenos">1008</span></a>
</span><span id="MarkupLanguage-1009"><a href="#MarkupLanguage-1009"><span class="linenos">1009</span></a>    <span class="k">def</span> <span class="nf">get_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1010"><a href="#MarkupLanguage-1010"><span class="linenos">1010</span></a>        <span class="sd">&quot;&quot;&quot;Generates markup from ANSI text.</span>
</span><span id="MarkupLanguage-1011"><a href="#MarkupLanguage-1011"><span class="linenos">1011</span></a>
</span><span id="MarkupLanguage-1012"><a href="#MarkupLanguage-1012"><span class="linenos">1012</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-1013"><a href="#MarkupLanguage-1013"><span class="linenos">1013</span></a><span class="sd">            ansi: The text to get markup from.</span>
</span><span id="MarkupLanguage-1014"><a href="#MarkupLanguage-1014"><span class="linenos">1014</span></a>
</span><span id="MarkupLanguage-1015"><a href="#MarkupLanguage-1015"><span class="linenos">1015</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-1016"><a href="#MarkupLanguage-1016"><span class="linenos">1016</span></a><span class="sd">            A markup string that can be parsed to get (visually) the same</span>
</span><span id="MarkupLanguage-1017"><a href="#MarkupLanguage-1017"><span class="linenos">1017</span></a><span class="sd">            result. Note that this conversion is lossy in a way: there are some</span>
</span><span id="MarkupLanguage-1018"><a href="#MarkupLanguage-1018"><span class="linenos">1018</span></a><span class="sd">            details (like macros) that cannot be preserved in an ANSI-&gt;Markup-&gt;ANSI</span>
</span><span id="MarkupLanguage-1019"><a href="#MarkupLanguage-1019"><span class="linenos">1019</span></a><span class="sd">            conversion.</span>
</span><span id="MarkupLanguage-1020"><a href="#MarkupLanguage-1020"><span class="linenos">1020</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1021"><a href="#MarkupLanguage-1021"><span class="linenos">1021</span></a>
</span><span id="MarkupLanguage-1022"><a href="#MarkupLanguage-1022"><span class="linenos">1022</span></a>        <span class="n">current_tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1023"><a href="#MarkupLanguage-1023"><span class="linenos">1023</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-1024"><a href="#MarkupLanguage-1024"><span class="linenos">1024</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage-1025"><a href="#MarkupLanguage-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage-1026"><a href="#MarkupLanguage-1026"><span class="linenos">1026</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MarkupLanguage-1027"><a href="#MarkupLanguage-1027"><span class="linenos">1027</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage-1028"><a href="#MarkupLanguage-1028"><span class="linenos">1028</span></a>
</span><span id="MarkupLanguage-1029"><a href="#MarkupLanguage-1029"><span class="linenos">1029</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage-1030"><a href="#MarkupLanguage-1030"><span class="linenos">1030</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="MarkupLanguage-1031"><a href="#MarkupLanguage-1031"><span class="linenos">1031</span></a>                <span class="n">current_tags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1032"><a href="#MarkupLanguage-1032"><span class="linenos">1032</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1033"><a href="#MarkupLanguage-1033"><span class="linenos">1033</span></a>
</span><span id="MarkupLanguage-1034"><a href="#MarkupLanguage-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span>
</span><span id="MarkupLanguage-1035"><a href="#MarkupLanguage-1035"><span class="linenos">1035</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage-1036"><a href="#MarkupLanguage-1036"><span class="linenos">1036</span></a>
</span><span id="MarkupLanguage-1037"><a href="#MarkupLanguage-1037"><span class="linenos">1037</span></a>                <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="MarkupLanguage-1038"><a href="#MarkupLanguage-1038"><span class="linenos">1038</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1039"><a href="#MarkupLanguage-1039"><span class="linenos">1039</span></a>
</span><span id="MarkupLanguage-1040"><a href="#MarkupLanguage-1040"><span class="linenos">1040</span></a>            <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage-1041"><a href="#MarkupLanguage-1041"><span class="linenos">1041</span></a>
</span><span id="MarkupLanguage-1042"><a href="#MarkupLanguage-1042"><span class="linenos">1042</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="MarkupLanguage-1043"><a href="#MarkupLanguage-1043"><span class="linenos">1043</span></a>
</span><span id="MarkupLanguage-1044"><a href="#MarkupLanguage-1044"><span class="linenos">1044</span></a>    <span class="k">def</span> <span class="nf">prettify_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1045"><a href="#MarkupLanguage-1045"><span class="linenos">1045</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) ANSI str.</span>
</span><span id="MarkupLanguage-1046"><a href="#MarkupLanguage-1046"><span class="linenos">1046</span></a>
</span><span id="MarkupLanguage-1047"><a href="#MarkupLanguage-1047"><span class="linenos">1047</span></a><span class="sd">        This is useful to quickly &quot;inspect&quot; a given ANSI string. However,</span>
</span><span id="MarkupLanguage-1048"><a href="#MarkupLanguage-1048"><span class="linenos">1048</span></a><span class="sd">        for most real uses `MarkupLanguage.prettify_markup` would be</span>
</span><span id="MarkupLanguage-1049"><a href="#MarkupLanguage-1049"><span class="linenos">1049</span></a><span class="sd">        preferable, given an argument of `MarkupLanguage.get_markup(text)`,</span>
</span><span id="MarkupLanguage-1050"><a href="#MarkupLanguage-1050"><span class="linenos">1050</span></a><span class="sd">        as it is much more verbose.</span>
</span><span id="MarkupLanguage-1051"><a href="#MarkupLanguage-1051"><span class="linenos">1051</span></a>
</span><span id="MarkupLanguage-1052"><a href="#MarkupLanguage-1052"><span class="linenos">1052</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-1053"><a href="#MarkupLanguage-1053"><span class="linenos">1053</span></a><span class="sd">            text: The ANSI-text to prettify.</span>
</span><span id="MarkupLanguage-1054"><a href="#MarkupLanguage-1054"><span class="linenos">1054</span></a>
</span><span id="MarkupLanguage-1055"><a href="#MarkupLanguage-1055"><span class="linenos">1055</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-1056"><a href="#MarkupLanguage-1056"><span class="linenos">1056</span></a><span class="sd">            The prettified ANSI text. This text&#39;s styles remain valid,</span>
</span><span id="MarkupLanguage-1057"><a href="#MarkupLanguage-1057"><span class="linenos">1057</span></a><span class="sd">            so copy-pasting the argument into a command (like printf)</span>
</span><span id="MarkupLanguage-1058"><a href="#MarkupLanguage-1058"><span class="linenos">1058</span></a><span class="sd">            that can show styled text will work the same way.</span>
</span><span id="MarkupLanguage-1059"><a href="#MarkupLanguage-1059"><span class="linenos">1059</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1060"><a href="#MarkupLanguage-1060"><span class="linenos">1060</span></a>
</span><span id="MarkupLanguage-1061"><a href="#MarkupLanguage-1061"><span class="linenos">1061</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-1062"><a href="#MarkupLanguage-1062"><span class="linenos">1062</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-1063"><a href="#MarkupLanguage-1063"><span class="linenos">1063</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage-1064"><a href="#MarkupLanguage-1064"><span class="linenos">1064</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage-1065"><a href="#MarkupLanguage-1065"><span class="linenos">1065</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage-1066"><a href="#MarkupLanguage-1066"><span class="linenos">1066</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="MarkupLanguage-1067"><a href="#MarkupLanguage-1067"><span class="linenos">1067</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1068"><a href="#MarkupLanguage-1068"><span class="linenos">1068</span></a>
</span><span id="MarkupLanguage-1069"><a href="#MarkupLanguage-1069"><span class="linenos">1069</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage-1070"><a href="#MarkupLanguage-1070"><span class="linenos">1070</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x1b&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-1071"><a href="#MarkupLanguage-1071"><span class="linenos">1071</span></a>            <span class="n">sequences</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage-1072"><a href="#MarkupLanguage-1072"><span class="linenos">1072</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="n">sequences</span>
</span><span id="MarkupLanguage-1073"><a href="#MarkupLanguage-1073"><span class="linenos">1073</span></a>
</span><span id="MarkupLanguage-1074"><a href="#MarkupLanguage-1074"><span class="linenos">1074</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="MarkupLanguage-1075"><a href="#MarkupLanguage-1075"><span class="linenos">1075</span></a>
</span><span id="MarkupLanguage-1076"><a href="#MarkupLanguage-1076"><span class="linenos">1076</span></a>    <span class="k">def</span> <span class="nf">prettify_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1077"><a href="#MarkupLanguage-1077"><span class="linenos">1077</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) markup str.</span>
</span><span id="MarkupLanguage-1078"><a href="#MarkupLanguage-1078"><span class="linenos">1078</span></a>
</span><span id="MarkupLanguage-1079"><a href="#MarkupLanguage-1079"><span class="linenos">1079</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-1080"><a href="#MarkupLanguage-1080"><span class="linenos">1080</span></a><span class="sd">            text: The markup-text to prettify.</span>
</span><span id="MarkupLanguage-1081"><a href="#MarkupLanguage-1081"><span class="linenos">1081</span></a>
</span><span id="MarkupLanguage-1082"><a href="#MarkupLanguage-1082"><span class="linenos">1082</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-1083"><a href="#MarkupLanguage-1083"><span class="linenos">1083</span></a><span class="sd">            Prettified markup. This markup, excluding its styles,</span>
</span><span id="MarkupLanguage-1084"><a href="#MarkupLanguage-1084"><span class="linenos">1084</span></a><span class="sd">            remains valid markup.</span>
</span><span id="MarkupLanguage-1085"><a href="#MarkupLanguage-1085"><span class="linenos">1085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1086"><a href="#MarkupLanguage-1086"><span class="linenos">1086</span></a>
</span><span id="MarkupLanguage-1087"><a href="#MarkupLanguage-1087"><span class="linenos">1087</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1088"><a href="#MarkupLanguage-1088"><span class="linenos">1088</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1089"><a href="#MarkupLanguage-1089"><span class="linenos">1089</span></a>
</span><span id="MarkupLanguage-1090"><a href="#MarkupLanguage-1090"><span class="linenos">1090</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage-1091"><a href="#MarkupLanguage-1091"><span class="linenos">1091</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage-1092"><a href="#MarkupLanguage-1092"><span class="linenos">1092</span></a>
</span><span id="MarkupLanguage-1093"><a href="#MarkupLanguage-1093"><span class="linenos">1093</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage-1094"><a href="#MarkupLanguage-1094"><span class="linenos">1094</span></a>
</span><span id="MarkupLanguage-1095"><a href="#MarkupLanguage-1095"><span class="linenos">1095</span></a>        <span class="k">def</span> <span class="nf">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-1096"><a href="#MarkupLanguage-1096"><span class="linenos">1096</span></a>            <span class="sd">&quot;&quot;&quot;Pops a macro from applied_macros.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1097"><a href="#MarkupLanguage-1097"><span class="linenos">1097</span></a>
</span><span id="MarkupLanguage-1098"><a href="#MarkupLanguage-1098"><span class="linenos">1098</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">macro_name</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">applied_macros</span><span class="p">):</span>
</span><span id="MarkupLanguage-1099"><a href="#MarkupLanguage-1099"><span class="linenos">1099</span></a>                <span class="k">if</span> <span class="n">macro_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage-1100"><a href="#MarkupLanguage-1100"><span class="linenos">1100</span></a>                    <span class="n">applied_macros</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="MarkupLanguage-1101"><a href="#MarkupLanguage-1101"><span class="linenos">1101</span></a>                    <span class="k">break</span>
</span><span id="MarkupLanguage-1102"><a href="#MarkupLanguage-1102"><span class="linenos">1102</span></a>
</span><span id="MarkupLanguage-1103"><a href="#MarkupLanguage-1103"><span class="linenos">1103</span></a>        <span class="k">def</span> <span class="nf">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1104"><a href="#MarkupLanguage-1104"><span class="linenos">1104</span></a>            <span class="sd">&quot;&quot;&quot;Adds ending cap to the given string.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1105"><a href="#MarkupLanguage-1105"><span class="linenos">1105</span></a>
</span><span id="MarkupLanguage-1106"><a href="#MarkupLanguage-1106"><span class="linenos">1106</span></a>            <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="MarkupLanguage-1107"><a href="#MarkupLanguage-1107"><span class="linenos">1107</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage-1108"><a href="#MarkupLanguage-1108"><span class="linenos">1108</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage-1109"><a href="#MarkupLanguage-1109"><span class="linenos">1109</span></a>
</span><span id="MarkupLanguage-1110"><a href="#MarkupLanguage-1110"><span class="linenos">1110</span></a>                <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage-1111"><a href="#MarkupLanguage-1111"><span class="linenos">1111</span></a>
</span><span id="MarkupLanguage-1112"><a href="#MarkupLanguage-1112"><span class="linenos">1112</span></a>            <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;[/]&quot;</span>
</span><span id="MarkupLanguage-1113"><a href="#MarkupLanguage-1113"><span class="linenos">1113</span></a>
</span><span id="MarkupLanguage-1114"><a href="#MarkupLanguage-1114"><span class="linenos">1114</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">TokenType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MarkupLanguage-1115"><a href="#MarkupLanguage-1115"><span class="linenos">1115</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span> <span class="s2">&quot;210&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage-1116"><a href="#MarkupLanguage-1116"><span class="linenos">1116</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span> <span class="s2">&quot;210 bold&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage-1117"><a href="#MarkupLanguage-1117"><span class="linenos">1117</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span> <span class="s2">&quot;strikethrough&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage-1118"><a href="#MarkupLanguage-1118"><span class="linenos">1118</span></a>        <span class="p">}</span>
</span><span id="MarkupLanguage-1119"><a href="#MarkupLanguage-1119"><span class="linenos">1119</span></a>
</span><span id="MarkupLanguage-1120"><a href="#MarkupLanguage-1120"><span class="linenos">1120</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1121"><a href="#MarkupLanguage-1121"><span class="linenos">1121</span></a>
</span><span id="MarkupLanguage-1122"><a href="#MarkupLanguage-1122"><span class="linenos">1122</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-1123"><a href="#MarkupLanguage-1123"><span class="linenos">1123</span></a>        <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MarkupLanguage-1124"><a href="#MarkupLanguage-1124"><span class="linenos">1124</span></a>        <span class="n">current_styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1125"><a href="#MarkupLanguage-1125"><span class="linenos">1125</span></a>
</span><span id="MarkupLanguage-1126"><a href="#MarkupLanguage-1126"><span class="linenos">1126</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage-1127"><a href="#MarkupLanguage-1127"><span class="linenos">1127</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">]:</span>
</span><span id="MarkupLanguage-1128"><a href="#MarkupLanguage-1128"><span class="linenos">1128</span></a>                <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="MarkupLanguage-1129"><a href="#MarkupLanguage-1129"><span class="linenos">1129</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage-1130"><a href="#MarkupLanguage-1130"><span class="linenos">1130</span></a>
</span><span id="MarkupLanguage-1131"><a href="#MarkupLanguage-1131"><span class="linenos">1131</span></a>                <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MarkupLanguage-1132"><a href="#MarkupLanguage-1132"><span class="linenos">1132</span></a>
</span><span id="MarkupLanguage-1133"><a href="#MarkupLanguage-1133"><span class="linenos">1133</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage-1134"><a href="#MarkupLanguage-1134"><span class="linenos">1134</span></a>                <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">current_styles</span><span class="p">:</span>
</span><span id="MarkupLanguage-1135"><a href="#MarkupLanguage-1135"><span class="linenos">1135</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-1136"><a href="#MarkupLanguage-1136"><span class="linenos">1136</span></a>                        <span class="k">continue</span>
</span><span id="MarkupLanguage-1137"><a href="#MarkupLanguage-1137"><span class="linenos">1137</span></a>
</span><span id="MarkupLanguage-1138"><a href="#MarkupLanguage-1138"><span class="linenos">1138</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage-1139"><a href="#MarkupLanguage-1139"><span class="linenos">1139</span></a>
</span><span id="MarkupLanguage-1140"><a href="#MarkupLanguage-1140"><span class="linenos">1140</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}{</span><span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage-1141"><a href="#MarkupLanguage-1141"><span class="linenos">1141</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1142"><a href="#MarkupLanguage-1142"><span class="linenos">1142</span></a>
</span><span id="MarkupLanguage-1143"><a href="#MarkupLanguage-1143"><span class="linenos">1143</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="k">if</span> <span class="n">in_sequence</span> <span class="k">else</span> <span class="s2">&quot;[&quot;</span>
</span><span id="MarkupLanguage-1144"><a href="#MarkupLanguage-1144"><span class="linenos">1144</span></a>            <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MarkupLanguage-1145"><a href="#MarkupLanguage-1145"><span class="linenos">1145</span></a>
</span><span id="MarkupLanguage-1146"><a href="#MarkupLanguage-1146"><span class="linenos">1146</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage-1147"><a href="#MarkupLanguage-1147"><span class="linenos">1147</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage-1148"><a href="#MarkupLanguage-1148"><span class="linenos">1148</span></a>                    <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1149"><a href="#MarkupLanguage-1149"><span class="linenos">1149</span></a>
</span><span id="MarkupLanguage-1150"><a href="#MarkupLanguage-1150"><span class="linenos">1150</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="MarkupLanguage-1151"><a href="#MarkupLanguage-1151"><span class="linenos">1151</span></a>
</span><span id="MarkupLanguage-1152"><a href="#MarkupLanguage-1152"><span class="linenos">1152</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="MarkupLanguage-1153"><a href="#MarkupLanguage-1153"><span class="linenos">1153</span></a>                    <span class="n">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage-1154"><a href="#MarkupLanguage-1154"><span class="linenos">1154</span></a>
</span><span id="MarkupLanguage-1155"><a href="#MarkupLanguage-1155"><span class="linenos">1155</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-1156"><a href="#MarkupLanguage-1156"><span class="linenos">1156</span></a>
</span><span id="MarkupLanguage-1157"><a href="#MarkupLanguage-1157"><span class="linenos">1157</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
</span><span id="MarkupLanguage-1158"><a href="#MarkupLanguage-1158"><span class="linenos">1158</span></a>                    <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-1159"><a href="#MarkupLanguage-1159"><span class="linenos">1159</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">styles</span><span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">]</span><span class="si">}</span><span class="s2">]/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage-1160"><a href="#MarkupLanguage-1160"><span class="linenos">1160</span></a>                <span class="p">)</span>
</span><span id="MarkupLanguage-1161"><a href="#MarkupLanguage-1161"><span class="linenos">1161</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1162"><a href="#MarkupLanguage-1162"><span class="linenos">1162</span></a>
</span><span id="MarkupLanguage-1163"><a href="#MarkupLanguage-1163"><span class="linenos">1163</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage-1164"><a href="#MarkupLanguage-1164"><span class="linenos">1164</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage-1165"><a href="#MarkupLanguage-1165"><span class="linenos">1165</span></a>
</span><span id="MarkupLanguage-1166"><a href="#MarkupLanguage-1166"><span class="linenos">1166</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage-1167"><a href="#MarkupLanguage-1167"><span class="linenos">1167</span></a>                <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage-1168"><a href="#MarkupLanguage-1168"><span class="linenos">1168</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)]</span>
</span><span id="MarkupLanguage-1169"><a href="#MarkupLanguage-1169"><span class="linenos">1169</span></a>
</span><span id="MarkupLanguage-1170"><a href="#MarkupLanguage-1170"><span class="linenos">1170</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage-1171"><a href="#MarkupLanguage-1171"><span class="linenos">1171</span></a>
</span><span id="MarkupLanguage-1172"><a href="#MarkupLanguage-1172"><span class="linenos">1172</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MarkupLanguage-1173"><a href="#MarkupLanguage-1173"><span class="linenos">1173</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage-1174"><a href="#MarkupLanguage-1174"><span class="linenos">1174</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-1175"><a href="#MarkupLanguage-1175"><span class="linenos">1175</span></a>
</span><span id="MarkupLanguage-1176"><a href="#MarkupLanguage-1176"><span class="linenos">1176</span></a>                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># Not enough arguments</span>
</span><span id="MarkupLanguage-1177"><a href="#MarkupLanguage-1177"><span class="linenos">1177</span></a>                    <span class="k">pass</span>
</span><span id="MarkupLanguage-1178"><a href="#MarkupLanguage-1178"><span class="linenos">1178</span></a>
</span><span id="MarkupLanguage-1179"><a href="#MarkupLanguage-1179"><span class="linenos">1179</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-1180"><a href="#MarkupLanguage-1180"><span class="linenos">1180</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-1181"><a href="#MarkupLanguage-1181"><span class="linenos">1181</span></a>
</span><span id="MarkupLanguage-1182"><a href="#MarkupLanguage-1182"><span class="linenos">1182</span></a>            <span class="n">style_markup</span> <span class="o">=</span> <span class="n">styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">ttype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage-1183"><a href="#MarkupLanguage-1183"><span class="linenos">1183</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">style_markup</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage-1184"><a href="#MarkupLanguage-1184"><span class="linenos">1184</span></a>
</span><span id="MarkupLanguage-1185"><a href="#MarkupLanguage-1185"><span class="linenos">1185</span></a>        <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">)</span>
</span><span id="MarkupLanguage-1186"><a href="#MarkupLanguage-1186"><span class="linenos">1186</span></a>
</span><span id="MarkupLanguage-1187"><a href="#MarkupLanguage-1187"><span class="linenos">1187</span></a>    <span class="k">def</span> <span class="nf">get_styled_plains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">StyledText</span><span class="p">]:</span>
</span><span id="MarkupLanguage-1188"><a href="#MarkupLanguage-1188"><span class="linenos">1188</span></a>        <span class="sd">&quot;&quot;&quot;Gets all plain tokens within text, with their respective styles applied.</span>
</span><span id="MarkupLanguage-1189"><a href="#MarkupLanguage-1189"><span class="linenos">1189</span></a>
</span><span id="MarkupLanguage-1190"><a href="#MarkupLanguage-1190"><span class="linenos">1190</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage-1191"><a href="#MarkupLanguage-1191"><span class="linenos">1191</span></a><span class="sd">            text: The ANSI-sequence containing string to find plains from.</span>
</span><span id="MarkupLanguage-1192"><a href="#MarkupLanguage-1192"><span class="linenos">1192</span></a>
</span><span id="MarkupLanguage-1193"><a href="#MarkupLanguage-1193"><span class="linenos">1193</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage-1194"><a href="#MarkupLanguage-1194"><span class="linenos">1194</span></a><span class="sd">            An iterator of `StyledText` objects, each yielded when a new plain token is found,</span>
</span><span id="MarkupLanguage-1195"><a href="#MarkupLanguage-1195"><span class="linenos">1195</span></a><span class="sd">            containing the styles that are relevant and active on the given plain.</span>
</span><span id="MarkupLanguage-1196"><a href="#MarkupLanguage-1196"><span class="linenos">1196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1197"><a href="#MarkupLanguage-1197"><span class="linenos">1197</span></a>
</span><span id="MarkupLanguage-1198"><a href="#MarkupLanguage-1198"><span class="linenos">1198</span></a>        <span class="k">def</span> <span class="nf">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage-1199"><a href="#MarkupLanguage-1199"><span class="linenos">1199</span></a>            <span class="sd">&quot;&quot;&quot;Applies given styles to text.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1200"><a href="#MarkupLanguage-1200"><span class="linenos">1200</span></a>
</span><span id="MarkupLanguage-1201"><a href="#MarkupLanguage-1201"><span class="linenos">1201</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="MarkupLanguage-1202"><a href="#MarkupLanguage-1202"><span class="linenos">1202</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage-1203"><a href="#MarkupLanguage-1203"><span class="linenos">1203</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage-1204"><a href="#MarkupLanguage-1204"><span class="linenos">1204</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage-1205"><a href="#MarkupLanguage-1205"><span class="linenos">1205</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-1206"><a href="#MarkupLanguage-1206"><span class="linenos">1206</span></a>
</span><span id="MarkupLanguage-1207"><a href="#MarkupLanguage-1207"><span class="linenos">1207</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage-1208"><a href="#MarkupLanguage-1208"><span class="linenos">1208</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage-1209"><a href="#MarkupLanguage-1209"><span class="linenos">1209</span></a>
</span><span id="MarkupLanguage-1210"><a href="#MarkupLanguage-1210"><span class="linenos">1210</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">text</span>
</span><span id="MarkupLanguage-1211"><a href="#MarkupLanguage-1211"><span class="linenos">1211</span></a>
</span><span id="MarkupLanguage-1212"><a href="#MarkupLanguage-1212"><span class="linenos">1212</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage-1213"><a href="#MarkupLanguage-1213"><span class="linenos">1213</span></a>
</span><span id="MarkupLanguage-1214"><a href="#MarkupLanguage-1214"><span class="linenos">1214</span></a>        <span class="k">def</span> <span class="nf">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage-1215"><a href="#MarkupLanguage-1215"><span class="linenos">1215</span></a>            <span class="sd">&quot;&quot;&quot;Removes an unsetter from the list, returns the new list.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage-1216"><a href="#MarkupLanguage-1216"><span class="linenos">1216</span></a>
</span><span id="MarkupLanguage-1217"><a href="#MarkupLanguage-1217"><span class="linenos">1217</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage-1218"><a href="#MarkupLanguage-1218"><span class="linenos">1218</span></a>                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tkn</span><span class="p">:</span> <span class="n">tkn</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">,</span> <span class="n">styles</span><span class="p">))</span>
</span><span id="MarkupLanguage-1219"><a href="#MarkupLanguage-1219"><span class="linenos">1219</span></a>
</span><span id="MarkupLanguage-1220"><a href="#MarkupLanguage-1220"><span class="linenos">1220</span></a>            <span class="n">target_name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="MarkupLanguage-1221"><a href="#MarkupLanguage-1221"><span class="linenos">1221</span></a>            <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="MarkupLanguage-1222"><a href="#MarkupLanguage-1222"><span class="linenos">1222</span></a>                <span class="c1"># bold &amp; dim unsetters represent the same character, so we have</span>
</span><span id="MarkupLanguage-1223"><a href="#MarkupLanguage-1223"><span class="linenos">1223</span></a>                <span class="c1"># to treat them the same way.</span>
</span><span id="MarkupLanguage-1224"><a href="#MarkupLanguage-1224"><span class="linenos">1224</span></a>                <span class="n">style_name</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage-1225"><a href="#MarkupLanguage-1225"><span class="linenos">1225</span></a>
</span><span id="MarkupLanguage-1226"><a href="#MarkupLanguage-1226"><span class="linenos">1226</span></a>                <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;dim&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage-1227"><a href="#MarkupLanguage-1227"><span class="linenos">1227</span></a>                    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
</span><span id="MarkupLanguage-1228"><a href="#MarkupLanguage-1228"><span class="linenos">1228</span></a>
</span><span id="MarkupLanguage-1229"><a href="#MarkupLanguage-1229"><span class="linenos">1229</span></a>                <span class="k">if</span> <span class="n">style_name</span> <span class="o">==</span> <span class="n">target_name</span><span class="p">:</span>
</span><span id="MarkupLanguage-1230"><a href="#MarkupLanguage-1230"><span class="linenos">1230</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage-1231"><a href="#MarkupLanguage-1231"><span class="linenos">1231</span></a>
</span><span id="MarkupLanguage-1232"><a href="#MarkupLanguage-1232"><span class="linenos">1232</span></a>                <span class="k">elif</span> <span class="p">(</span>
</span><span id="MarkupLanguage-1233"><a href="#MarkupLanguage-1233"><span class="linenos">1233</span></a>                    <span class="n">style_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
</span><span id="MarkupLanguage-1234"><a href="#MarkupLanguage-1234"><span class="linenos">1234</span></a>                    <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span>
</span><span id="MarkupLanguage-1235"><a href="#MarkupLanguage-1235"><span class="linenos">1235</span></a>                <span class="p">):</span>
</span><span id="MarkupLanguage-1236"><a href="#MarkupLanguage-1236"><span class="linenos">1236</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage-1237"><a href="#MarkupLanguage-1237"><span class="linenos">1237</span></a>
</span><span id="MarkupLanguage-1238"><a href="#MarkupLanguage-1238"><span class="linenos">1238</span></a>                <span class="k">elif</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage-1239"><a href="#MarkupLanguage-1239"><span class="linenos">1239</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage-1240"><a href="#MarkupLanguage-1240"><span class="linenos">1240</span></a>                    <span class="k">if</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;fg&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage-1241"><a href="#MarkupLanguage-1241"><span class="linenos">1241</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage-1242"><a href="#MarkupLanguage-1242"><span class="linenos">1242</span></a>
</span><span id="MarkupLanguage-1243"><a href="#MarkupLanguage-1243"><span class="linenos">1243</span></a>                    <span class="k">elif</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;bg&quot;</span> <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage-1244"><a href="#MarkupLanguage-1244"><span class="linenos">1244</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage-1245"><a href="#MarkupLanguage-1245"><span class="linenos">1245</span></a>
</span><span id="MarkupLanguage-1246"><a href="#MarkupLanguage-1246"><span class="linenos">1246</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="MarkupLanguage-1247"><a href="#MarkupLanguage-1247"><span class="linenos">1247</span></a>
</span><span id="MarkupLanguage-1248"><a href="#MarkupLanguage-1248"><span class="linenos">1248</span></a>        <span class="k">def</span> <span class="nf">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage-1249"><a href="#MarkupLanguage-1249"><span class="linenos">1249</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="MarkupLanguage-1250"><a href="#MarkupLanguage-1250"><span class="linenos">1250</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
</span><span id="MarkupLanguage-1251"><a href="#MarkupLanguage-1251"><span class="linenos">1251</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-1252"><a href="#MarkupLanguage-1252"><span class="linenos">1252</span></a>
</span><span id="MarkupLanguage-1253"><a href="#MarkupLanguage-1253"><span class="linenos">1253</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="MarkupLanguage-1254"><a href="#MarkupLanguage-1254"><span class="linenos">1254</span></a>
</span><span id="MarkupLanguage-1255"><a href="#MarkupLanguage-1255"><span class="linenos">1255</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage-1256"><a href="#MarkupLanguage-1256"><span class="linenos">1256</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage-1257"><a href="#MarkupLanguage-1257"><span class="linenos">1257</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage-1258"><a href="#MarkupLanguage-1258"><span class="linenos">1258</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">styles</span><span class="p">)):</span>
</span><span id="MarkupLanguage-1259"><a href="#MarkupLanguage-1259"><span class="linenos">1259</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage-1260"><a href="#MarkupLanguage-1260"><span class="linenos">1260</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage-1261"><a href="#MarkupLanguage-1261"><span class="linenos">1261</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage-1262"><a href="#MarkupLanguage-1262"><span class="linenos">1262</span></a>
</span><span id="MarkupLanguage-1263"><a href="#MarkupLanguage-1263"><span class="linenos">1263</span></a>                        <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">!=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage-1264"><a href="#MarkupLanguage-1264"><span class="linenos">1264</span></a>                            <span class="k">continue</span>
</span><span id="MarkupLanguage-1265"><a href="#MarkupLanguage-1265"><span class="linenos">1265</span></a>
</span><span id="MarkupLanguage-1266"><a href="#MarkupLanguage-1266"><span class="linenos">1266</span></a>                        <span class="n">styles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="MarkupLanguage-1267"><a href="#MarkupLanguage-1267"><span class="linenos">1267</span></a>                        <span class="k">break</span>
</span><span id="MarkupLanguage-1268"><a href="#MarkupLanguage-1268"><span class="linenos">1268</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage-1269"><a href="#MarkupLanguage-1269"><span class="linenos">1269</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-1270"><a href="#MarkupLanguage-1270"><span class="linenos">1270</span></a>
</span><span id="MarkupLanguage-1271"><a href="#MarkupLanguage-1271"><span class="linenos">1271</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1272"><a href="#MarkupLanguage-1272"><span class="linenos">1272</span></a>
</span><span id="MarkupLanguage-1273"><a href="#MarkupLanguage-1273"><span class="linenos">1273</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">LINK</span><span class="p">:</span>
</span><span id="MarkupLanguage-1274"><a href="#MarkupLanguage-1274"><span class="linenos">1274</span></a>                <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage-1275"><a href="#MarkupLanguage-1275"><span class="linenos">1275</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="MarkupLanguage-1276"><a href="#MarkupLanguage-1276"><span class="linenos">1276</span></a>
</span><span id="MarkupLanguage-1277"><a href="#MarkupLanguage-1277"><span class="linenos">1277</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage-1278"><a href="#MarkupLanguage-1278"><span class="linenos">1278</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage-1279"><a href="#MarkupLanguage-1279"><span class="linenos">1279</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage-1280"><a href="#MarkupLanguage-1280"><span class="linenos">1280</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
</span><span id="MarkupLanguage-1281"><a href="#MarkupLanguage-1281"><span class="linenos">1281</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1282"><a href="#MarkupLanguage-1282"><span class="linenos">1282</span></a>
</span><span id="MarkupLanguage-1283"><a href="#MarkupLanguage-1283"><span class="linenos">1283</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage-1284"><a href="#MarkupLanguage-1284"><span class="linenos">1284</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span>
</span><span id="MarkupLanguage-1285"><a href="#MarkupLanguage-1285"><span class="linenos">1285</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage-1286"><a href="#MarkupLanguage-1286"><span class="linenos">1286</span></a>
</span><span id="MarkupLanguage-1287"><a href="#MarkupLanguage-1287"><span class="linenos">1287</span></a>            <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class representing an instance of a Markup Language.</p>

<p>This class is used for all markup/ANSI parsing, tokenizing and usage.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytermgui</span> <span class="kn">import</span> <span class="n">tim</span>

<span class="n">tim</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;my-tag&quot;</span><span class="p">,</span> <span class="s2">&quot;@152 72 bold&quot;</span><span class="p">)</span>
<span class="n">tim</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;This is [my-tag]my-tag[/]!&quot;</span><span class="p">)</span>
</code></pre></div>

<p style="text-align: center">
    <img src="https://raw.githubusercontent.com/bczsalba/pytermgui/master/assets/docs/parser/markup_language.png"
    style="width: 80%">
</p>
</div>


                            <div id="MarkupLanguage.__init__" class="classattr">
                                        <input id="MarkupLanguage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MarkupLanguage</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">default_macros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="MarkupLanguage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.__init__-552"><a href="#MarkupLanguage.__init__-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_macros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.__init__-553"><a href="#MarkupLanguage.__init__-553"><span class="linenos">553</span></a>        <span class="sd">&quot;&quot;&quot;Initializes a MarkupLanguage.</span>
</span><span id="MarkupLanguage.__init__-554"><a href="#MarkupLanguage.__init__-554"><span class="linenos">554</span></a>
</span><span id="MarkupLanguage.__init__-555"><a href="#MarkupLanguage.__init__-555"><span class="linenos">555</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.__init__-556"><a href="#MarkupLanguage.__init__-556"><span class="linenos">556</span></a><span class="sd">            default_macros: If not set, the builtin macros are not defined.</span>
</span><span id="MarkupLanguage.__init__-557"><a href="#MarkupLanguage.__init__-557"><span class="linenos">557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.__init__-558"><a href="#MarkupLanguage.__init__-558"><span class="linenos">558</span></a>
</span><span id="MarkupLanguage.__init__-559"><a href="#MarkupLanguage.__init__-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">STYLE_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MarkupLanguage.__init__-560"><a href="#MarkupLanguage.__init__-560"><span class="linenos">560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage.__init__-561"><a href="#MarkupLanguage.__init__-561"><span class="linenos">561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCallable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage.__init__-562"><a href="#MarkupLanguage.__init__-562"><span class="linenos">562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkupLanguage.__init__-563"><a href="#MarkupLanguage.__init__-563"><span class="linenos">563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNSETTER_MAP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MarkupLanguage.__init__-564"><a href="#MarkupLanguage.__init__-564"><span class="linenos">564</span></a>
</span><span id="MarkupLanguage.__init__-565"><a href="#MarkupLanguage.__init__-565"><span class="linenos">565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MarkupLanguage.__init__-566"><a href="#MarkupLanguage.__init__-566"><span class="linenos">566</span></a>
</span><span id="MarkupLanguage.__init__-567"><a href="#MarkupLanguage.__init__-567"><span class="linenos">567</span></a>        <span class="k">if</span> <span class="n">default_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage.__init__-568"><a href="#MarkupLanguage.__init__-568"><span class="linenos">568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!link&quot;</span><span class="p">,</span> <span class="n">macro_link</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-569"><a href="#MarkupLanguage.__init__-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!align&quot;</span><span class="p">,</span> <span class="n">macro_align</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-570"><a href="#MarkupLanguage.__init__-570"><span class="linenos">570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!markup&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_markup</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-571"><a href="#MarkupLanguage.__init__-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!shuffle&quot;</span><span class="p">,</span> <span class="n">macro_shuffle</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-572"><a href="#MarkupLanguage.__init__-572"><span class="linenos">572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_bg&quot;</span><span class="p">,</span> <span class="n">macro_strip_bg</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-573"><a href="#MarkupLanguage.__init__-573"><span class="linenos">573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!strip_fg&quot;</span><span class="p">,</span> <span class="n">macro_strip_fg</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-574"><a href="#MarkupLanguage.__init__-574"><span class="linenos">574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!rainbow&quot;</span><span class="p">,</span> <span class="n">macro_rainbow</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-575"><a href="#MarkupLanguage.__init__-575"><span class="linenos">575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!gradient&quot;</span><span class="p">,</span> <span class="n">macro_gradient</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-576"><a href="#MarkupLanguage.__init__-576"><span class="linenos">576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!upper&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
</span><span id="MarkupLanguage.__init__-577"><a href="#MarkupLanguage.__init__-577"><span class="linenos">577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!lower&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</span><span id="MarkupLanguage.__init__-578"><a href="#MarkupLanguage.__init__-578"><span class="linenos">578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!title&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">()))</span>
</span><span id="MarkupLanguage.__init__-579"><a href="#MarkupLanguage.__init__-579"><span class="linenos">579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!capitalize&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()))</span>
</span><span id="MarkupLanguage.__init__-580"><a href="#MarkupLanguage.__init__-580"><span class="linenos">580</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!expand&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tag</span><span class="p">:</span> <span class="n">macro_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span><span id="MarkupLanguage.__init__-581"><a href="#MarkupLanguage.__init__-581"><span class="linenos">581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;!debug&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ascii</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">))</span>
</span><span id="MarkupLanguage.__init__-582"><a href="#MarkupLanguage.__init__-582"><span class="linenos">582</span></a>
</span><span id="MarkupLanguage.__init__-583"><a href="#MarkupLanguage.__init__-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;dim @black&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-584"><a href="#MarkupLanguage.__init__-584"><span class="linenos">584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.str&quot;</span><span class="p">,</span> <span class="s2">&quot;142&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-585"><a href="#MarkupLanguage.__init__-585"><span class="linenos">585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.multiline_str&quot;</span><span class="p">,</span> <span class="s2">&quot;code.str&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-586"><a href="#MarkupLanguage.__init__-586"><span class="linenos">586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.none&quot;</span><span class="p">,</span> <span class="s2">&quot;167&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-587"><a href="#MarkupLanguage.__init__-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.global&quot;</span><span class="p">,</span> <span class="s2">&quot;214&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-588"><a href="#MarkupLanguage.__init__-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.number&quot;</span><span class="p">,</span> <span class="s2">&quot;175&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-589"><a href="#MarkupLanguage.__init__-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.keyword&quot;</span><span class="p">,</span> <span class="s2">&quot;203&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-590"><a href="#MarkupLanguage.__init__-590"><span class="linenos">590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.identifier&quot;</span><span class="p">,</span> <span class="s2">&quot;109&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-591"><a href="#MarkupLanguage.__init__-591"><span class="linenos">591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.name&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-592"><a href="#MarkupLanguage.__init__-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.comment&quot;</span><span class="p">,</span> <span class="s2">&quot;240 italic&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-593"><a href="#MarkupLanguage.__init__-593"><span class="linenos">593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.builtin&quot;</span><span class="p">,</span> <span class="s2">&quot;code.global&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-594"><a href="#MarkupLanguage.__init__-594"><span class="linenos">594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.file&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.__init__-595"><a href="#MarkupLanguage.__init__-595"><span class="linenos">595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;code.symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;code.identifier&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a MarkupLanguage.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>default_macros:</strong>  If not set, the builtin macros are not defined.</li>
</ul>
</div>


                            </div>
                            <div id="MarkupLanguage.raise_unknown_markup" class="classattr">
                                <div class="attr variable">
            <span class="name">raise_unknown_markup</span><span class="annotation">: bool</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#MarkupLanguage.raise_unknown_markup"></a>
    
            <div class="docstring"><p>Raise <code><a href="exceptions.html#MarkupSyntaxError">pytermgui.exceptions.MarkupSyntaxError</a></code> when encountering unknown markup tags.</p>
</div>


                            </div>
                            <div id="MarkupLanguage.print" class="classattr">
                                        <input id="MarkupLanguage.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.print-636"><a href="#MarkupLanguage.print-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.print-637"><a href="#MarkupLanguage.print-637"><span class="linenos">637</span></a>        <span class="sd">&quot;&quot;&quot;Parse all arguments and pass them through to print, along with kwargs.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.print-638"><a href="#MarkupLanguage.print-638"><span class="linenos">638</span></a>
</span><span id="MarkupLanguage.print-639"><a href="#MarkupLanguage.print-639"><span class="linenos">639</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.print-640"><a href="#MarkupLanguage.print-640"><span class="linenos">640</span></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="MarkupLanguage.print-641"><a href="#MarkupLanguage.print-641"><span class="linenos">641</span></a>            <span class="n">parsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</span><span id="MarkupLanguage.print-642"><a href="#MarkupLanguage.print-642"><span class="linenos">642</span></a>
</span><span id="MarkupLanguage.print-643"><a href="#MarkupLanguage.print-643"><span class="linenos">643</span></a>        <span class="n">get_terminal</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">parsed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parse all arguments and pass them through to print, along with kwargs.</p>
</div>


                            </div>
                            <div id="MarkupLanguage.tokenize_markup" class="classattr">
                                        <input id="MarkupLanguage.tokenize_markup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tokenize_markup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n">pytermgui</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.tokenize_markup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.tokenize_markup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.tokenize_markup-645"><a href="#MarkupLanguage.tokenize_markup-645"><span class="linenos">645</span></a>    <span class="k">def</span> <span class="nf">tokenize_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage.tokenize_markup-646"><a href="#MarkupLanguage.tokenize_markup-646"><span class="linenos">646</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given markup string into an iterator of `Token`.</span>
</span><span id="MarkupLanguage.tokenize_markup-647"><a href="#MarkupLanguage.tokenize_markup-647"><span class="linenos">647</span></a>
</span><span id="MarkupLanguage.tokenize_markup-648"><a href="#MarkupLanguage.tokenize_markup-648"><span class="linenos">648</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.tokenize_markup-649"><a href="#MarkupLanguage.tokenize_markup-649"><span class="linenos">649</span></a><span class="sd">            markup_text: The text to look at.</span>
</span><span id="MarkupLanguage.tokenize_markup-650"><a href="#MarkupLanguage.tokenize_markup-650"><span class="linenos">650</span></a>
</span><span id="MarkupLanguage.tokenize_markup-651"><a href="#MarkupLanguage.tokenize_markup-651"><span class="linenos">651</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.tokenize_markup-652"><a href="#MarkupLanguage.tokenize_markup-652"><span class="linenos">652</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="MarkupLanguage.tokenize_markup-653"><a href="#MarkupLanguage.tokenize_markup-653"><span class="linenos">653</span></a><span class="sd">            on memory.</span>
</span><span id="MarkupLanguage.tokenize_markup-654"><a href="#MarkupLanguage.tokenize_markup-654"><span class="linenos">654</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.tokenize_markup-655"><a href="#MarkupLanguage.tokenize_markup-655"><span class="linenos">655</span></a>
</span><span id="MarkupLanguage.tokenize_markup-656"><a href="#MarkupLanguage.tokenize_markup-656"><span class="linenos">656</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_markup-657"><a href="#MarkupLanguage.tokenize_markup-657"><span class="linenos">657</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_markup-658"><a href="#MarkupLanguage.tokenize_markup-658"><span class="linenos">658</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_markup-659"><a href="#MarkupLanguage.tokenize_markup-659"><span class="linenos">659</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_MARKUP</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="MarkupLanguage.tokenize_markup-660"><a href="#MarkupLanguage.tokenize_markup-660"><span class="linenos">660</span></a>            <span class="n">full</span><span class="p">,</span> <span class="n">escapes</span><span class="p">,</span> <span class="n">tag_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="MarkupLanguage.tokenize_markup-661"><a href="#MarkupLanguage.tokenize_markup-661"><span class="linenos">661</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="MarkupLanguage.tokenize_markup-662"><a href="#MarkupLanguage.tokenize_markup-662"><span class="linenos">662</span></a>
</span><span id="MarkupLanguage.tokenize_markup-663"><a href="#MarkupLanguage.tokenize_markup-663"><span class="linenos">663</span></a>            <span class="c1"># Add plain text between last and current match</span>
</span><span id="MarkupLanguage.tokenize_markup-664"><a href="#MarkupLanguage.tokenize_markup-664"><span class="linenos">664</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-665"><a href="#MarkupLanguage.tokenize_markup-665"><span class="linenos">665</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span id="MarkupLanguage.tokenize_markup-666"><a href="#MarkupLanguage.tokenize_markup-666"><span class="linenos">666</span></a>
</span><span id="MarkupLanguage.tokenize_markup-667"><a href="#MarkupLanguage.tokenize_markup-667"><span class="linenos">667</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">escapes</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-668"><a href="#MarkupLanguage.tokenize_markup-668"><span class="linenos">668</span></a>                <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage.tokenize_markup-669"><a href="#MarkupLanguage.tokenize_markup-669"><span class="linenos">669</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">escapes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:])</span>
</span><span id="MarkupLanguage.tokenize_markup-670"><a href="#MarkupLanguage.tokenize_markup-670"><span class="linenos">670</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.tokenize_markup-671"><a href="#MarkupLanguage.tokenize_markup-671"><span class="linenos">671</span></a>
</span><span id="MarkupLanguage.tokenize_markup-672"><a href="#MarkupLanguage.tokenize_markup-672"><span class="linenos">672</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="MarkupLanguage.tokenize_markup-673"><a href="#MarkupLanguage.tokenize_markup-673"><span class="linenos">673</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_style_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-674"><a href="#MarkupLanguage.tokenize_markup-674"><span class="linenos">674</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-675"><a href="#MarkupLanguage.tokenize_markup-675"><span class="linenos">675</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="MarkupLanguage.tokenize_markup-676"><a href="#MarkupLanguage.tokenize_markup-676"><span class="linenos">676</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.tokenize_markup-677"><a href="#MarkupLanguage.tokenize_markup-677"><span class="linenos">677</span></a>
</span><span id="MarkupLanguage.tokenize_markup-678"><a href="#MarkupLanguage.tokenize_markup-678"><span class="linenos">678</span></a>                <span class="c1"># Try to find a color token</span>
</span><span id="MarkupLanguage.tokenize_markup-679"><a href="#MarkupLanguage.tokenize_markup-679"><span class="linenos">679</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_color_token</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-680"><a href="#MarkupLanguage.tokenize_markup-680"><span class="linenos">680</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-681"><a href="#MarkupLanguage.tokenize_markup-681"><span class="linenos">681</span></a>                    <span class="k">yield</span> <span class="n">token</span>
</span><span id="MarkupLanguage.tokenize_markup-682"><a href="#MarkupLanguage.tokenize_markup-682"><span class="linenos">682</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.tokenize_markup-683"><a href="#MarkupLanguage.tokenize_markup-683"><span class="linenos">683</span></a>
</span><span id="MarkupLanguage.tokenize_markup-684"><a href="#MarkupLanguage.tokenize_markup-684"><span class="linenos">684</span></a>                <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-685"><a href="#MarkupLanguage.tokenize_markup-685"><span class="linenos">685</span></a>                <span class="k">if</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-686"><a href="#MarkupLanguage.tokenize_markup-686"><span class="linenos">686</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="MarkupLanguage.tokenize_markup-687"><a href="#MarkupLanguage.tokenize_markup-687"><span class="linenos">687</span></a>                    <span class="n">macro_args</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-688"><a href="#MarkupLanguage.tokenize_markup-688"><span class="linenos">688</span></a>
</span><span id="MarkupLanguage.tokenize_markup-689"><a href="#MarkupLanguage.tokenize_markup-689"><span class="linenos">689</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-690"><a href="#MarkupLanguage.tokenize_markup-690"><span class="linenos">690</span></a>                        <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage.tokenize_markup-691"><a href="#MarkupLanguage.tokenize_markup-691"><span class="linenos">691</span></a>                            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="MarkupLanguage.tokenize_markup-692"><a href="#MarkupLanguage.tokenize_markup-692"><span class="linenos">692</span></a>                            <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;is not a defined macro&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage.tokenize_markup-693"><a href="#MarkupLanguage.tokenize_markup-693"><span class="linenos">693</span></a>                            <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span><span class="p">,</span>
</span><span id="MarkupLanguage.tokenize_markup-694"><a href="#MarkupLanguage.tokenize_markup-694"><span class="linenos">694</span></a>                        <span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-695"><a href="#MarkupLanguage.tokenize_markup-695"><span class="linenos">695</span></a>
</span><span id="MarkupLanguage.tokenize_markup-696"><a href="#MarkupLanguage.tokenize_markup-696"><span class="linenos">696</span></a>                    <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span>
</span><span id="MarkupLanguage.tokenize_markup-697"><a href="#MarkupLanguage.tokenize_markup-697"><span class="linenos">697</span></a>                        <span class="n">name</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
</span><span id="MarkupLanguage.tokenize_markup-698"><a href="#MarkupLanguage.tokenize_markup-698"><span class="linenos">698</span></a>                        <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">,</span>
</span><span id="MarkupLanguage.tokenize_markup-699"><a href="#MarkupLanguage.tokenize_markup-699"><span class="linenos">699</span></a>                        <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">macro_args</span><span class="p">),</span>
</span><span id="MarkupLanguage.tokenize_markup-700"><a href="#MarkupLanguage.tokenize_markup-700"><span class="linenos">700</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-701"><a href="#MarkupLanguage.tokenize_markup-701"><span class="linenos">701</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.tokenize_markup-702"><a href="#MarkupLanguage.tokenize_markup-702"><span class="linenos">702</span></a>
</span><span id="MarkupLanguage.tokenize_markup-703"><a href="#MarkupLanguage.tokenize_markup-703"><span class="linenos">703</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_unknown_markup</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-704"><a href="#MarkupLanguage.tokenize_markup-704"><span class="linenos">704</span></a>                    <span class="k">raise</span> <span class="n">MarkupSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage.tokenize_markup-705"><a href="#MarkupLanguage.tokenize_markup-705"><span class="linenos">705</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not defined&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">markup_text</span>
</span><span id="MarkupLanguage.tokenize_markup-706"><a href="#MarkupLanguage.tokenize_markup-706"><span class="linenos">706</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_markup-707"><a href="#MarkupLanguage.tokenize_markup-707"><span class="linenos">707</span></a>
</span><span id="MarkupLanguage.tokenize_markup-708"><a href="#MarkupLanguage.tokenize_markup-708"><span class="linenos">708</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage.tokenize_markup-709"><a href="#MarkupLanguage.tokenize_markup-709"><span class="linenos">709</span></a>
</span><span id="MarkupLanguage.tokenize_markup-710"><a href="#MarkupLanguage.tokenize_markup-710"><span class="linenos">710</span></a>        <span class="c1"># Add remaining text as plain</span>
</span><span id="MarkupLanguage.tokenize_markup-711"><a href="#MarkupLanguage.tokenize_markup-711"><span class="linenos">711</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markup_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_markup-712"><a href="#MarkupLanguage.tokenize_markup-712"><span class="linenos">712</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markup_text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:])</span>
</span></pre></div>


            <div class="docstring"><p>Converts the given markup string into an iterator of <code>Token</code>.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>markup_text:</strong>  The text to look at.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>An iterator of tokens. The reason this is an iterator is to possibly save
  on memory.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.tokenize_ansi" class="classattr">
                                        <input id="MarkupLanguage.tokenize_ansi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tokenize_ansi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n">pytermgui</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.tokenize_ansi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.tokenize_ansi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.tokenize_ansi-714"><a href="#MarkupLanguage.tokenize_ansi-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">tokenize_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage.tokenize_ansi-715"><a href="#MarkupLanguage.tokenize_ansi-715"><span class="linenos">715</span></a>        <span class="sd">&quot;&quot;&quot;Converts the given ANSI string into an iterator of `Token`.</span>
</span><span id="MarkupLanguage.tokenize_ansi-716"><a href="#MarkupLanguage.tokenize_ansi-716"><span class="linenos">716</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-717"><a href="#MarkupLanguage.tokenize_ansi-717"><span class="linenos">717</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.tokenize_ansi-718"><a href="#MarkupLanguage.tokenize_ansi-718"><span class="linenos">718</span></a><span class="sd">            ansi: The text to look at.</span>
</span><span id="MarkupLanguage.tokenize_ansi-719"><a href="#MarkupLanguage.tokenize_ansi-719"><span class="linenos">719</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-720"><a href="#MarkupLanguage.tokenize_ansi-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.tokenize_ansi-721"><a href="#MarkupLanguage.tokenize_ansi-721"><span class="linenos">721</span></a><span class="sd">            An iterator of tokens. The reason this is an iterator is to possibly save</span>
</span><span id="MarkupLanguage.tokenize_ansi-722"><a href="#MarkupLanguage.tokenize_ansi-722"><span class="linenos">722</span></a><span class="sd">            on memory.</span>
</span><span id="MarkupLanguage.tokenize_ansi-723"><a href="#MarkupLanguage.tokenize_ansi-723"><span class="linenos">723</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.tokenize_ansi-724"><a href="#MarkupLanguage.tokenize_ansi-724"><span class="linenos">724</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-725"><a href="#MarkupLanguage.tokenize_ansi-725"><span class="linenos">725</span></a>        <span class="k">def</span> <span class="nf">_is_in_tags</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-726"><a href="#MarkupLanguage.tokenize_ansi-726"><span class="linenos">726</span></a>            <span class="sd">&quot;&quot;&quot;Determines whether a code is in the given dict of tags.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.tokenize_ansi-727"><a href="#MarkupLanguage.tokenize_ansi-727"><span class="linenos">727</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-728"><a href="#MarkupLanguage.tokenize_ansi-728"><span class="linenos">728</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MarkupLanguage.tokenize_ansi-729"><a href="#MarkupLanguage.tokenize_ansi-729"><span class="linenos">729</span></a>                <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">code</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-730"><a href="#MarkupLanguage.tokenize_ansi-730"><span class="linenos">730</span></a>                    <span class="k">return</span> <span class="n">name</span>
</span><span id="MarkupLanguage.tokenize_ansi-731"><a href="#MarkupLanguage.tokenize_ansi-731"><span class="linenos">731</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-732"><a href="#MarkupLanguage.tokenize_ansi-732"><span class="linenos">732</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.tokenize_ansi-733"><a href="#MarkupLanguage.tokenize_ansi-733"><span class="linenos">733</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-734"><a href="#MarkupLanguage.tokenize_ansi-734"><span class="linenos">734</span></a>        <span class="k">def</span> <span class="nf">_generate_color</span><span class="p">(</span>
</span><span id="MarkupLanguage.tokenize_ansi-735"><a href="#MarkupLanguage.tokenize_ansi-735"><span class="linenos">735</span></a>            <span class="n">parts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MarkupLanguage.tokenize_ansi-736"><a href="#MarkupLanguage.tokenize_ansi-736"><span class="linenos">736</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenType</span><span class="p">,</span> <span class="n">Color</span><span class="p">]:</span>
</span><span id="MarkupLanguage.tokenize_ansi-737"><a href="#MarkupLanguage.tokenize_ansi-737"><span class="linenos">737</span></a>            <span class="sd">&quot;&quot;&quot;Generates a color token.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.tokenize_ansi-738"><a href="#MarkupLanguage.tokenize_ansi-738"><span class="linenos">738</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-739"><a href="#MarkupLanguage.tokenize_ansi-739"><span class="linenos">739</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">Color</span>
</span><span id="MarkupLanguage.tokenize_ansi-740"><a href="#MarkupLanguage.tokenize_ansi-740"><span class="linenos">740</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-741"><a href="#MarkupLanguage.tokenize_ansi-741"><span class="linenos">741</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">StandardColor</span><span class="o">.</span><span class="n">from_ansi</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-742"><a href="#MarkupLanguage.tokenize_ansi-742"><span class="linenos">742</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage.tokenize_ansi-743"><a href="#MarkupLanguage.tokenize_ansi-743"><span class="linenos">743</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="MarkupLanguage.tokenize_ansi-744"><a href="#MarkupLanguage.tokenize_ansi-744"><span class="linenos">744</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-745"><a href="#MarkupLanguage.tokenize_ansi-745"><span class="linenos">745</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-746"><a href="#MarkupLanguage.tokenize_ansi-746"><span class="linenos">746</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">str_to_color</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-747"><a href="#MarkupLanguage.tokenize_ansi-747"><span class="linenos">747</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage.tokenize_ansi-748"><a href="#MarkupLanguage.tokenize_ansi-748"><span class="linenos">748</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span>
</span><span id="MarkupLanguage.tokenize_ansi-749"><a href="#MarkupLanguage.tokenize_ansi-749"><span class="linenos">749</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-750"><a href="#MarkupLanguage.tokenize_ansi-750"><span class="linenos">750</span></a>            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MarkupLanguage.tokenize_ansi-751"><a href="#MarkupLanguage.tokenize_ansi-751"><span class="linenos">751</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-752"><a href="#MarkupLanguage.tokenize_ansi-752"><span class="linenos">752</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_ansi-753"><a href="#MarkupLanguage.tokenize_ansi-753"><span class="linenos">753</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_ansi-754"><a href="#MarkupLanguage.tokenize_ansi-754"><span class="linenos">754</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.tokenize_ansi-755"><a href="#MarkupLanguage.tokenize_ansi-755"><span class="linenos">755</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-756"><a href="#MarkupLanguage.tokenize_ansi-756"><span class="linenos">756</span></a>        <span class="c1"># StyledText messes with indexing, so we need to cast it</span>
</span><span id="MarkupLanguage.tokenize_ansi-757"><a href="#MarkupLanguage.tokenize_ansi-757"><span class="linenos">757</span></a>        <span class="c1"># back to str.</span>
</span><span id="MarkupLanguage.tokenize_ansi-758"><a href="#MarkupLanguage.tokenize_ansi-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ansi</span><span class="p">,</span> <span class="n">StyledText</span><span class="p">):</span>
</span><span id="MarkupLanguage.tokenize_ansi-759"><a href="#MarkupLanguage.tokenize_ansi-759"><span class="linenos">759</span></a>            <span class="n">ansi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ansi</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-760"><a href="#MarkupLanguage.tokenize_ansi-760"><span class="linenos">760</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-761"><a href="#MarkupLanguage.tokenize_ansi-761"><span class="linenos">761</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">RE_ANSI</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage.tokenize_ansi-762"><a href="#MarkupLanguage.tokenize_ansi-762"><span class="linenos">762</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage.tokenize_ansi-763"><a href="#MarkupLanguage.tokenize_ansi-763"><span class="linenos">763</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="MarkupLanguage.tokenize_ansi-764"><a href="#MarkupLanguage.tokenize_ansi-764"><span class="linenos">764</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-765"><a href="#MarkupLanguage.tokenize_ansi-765"><span class="linenos">765</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-766"><a href="#MarkupLanguage.tokenize_ansi-766"><span class="linenos">766</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.tokenize_ansi-767"><a href="#MarkupLanguage.tokenize_ansi-767"><span class="linenos">767</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-768"><a href="#MarkupLanguage.tokenize_ansi-768"><span class="linenos">768</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-769"><a href="#MarkupLanguage.tokenize_ansi-769"><span class="linenos">769</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-770"><a href="#MarkupLanguage.tokenize_ansi-770"><span class="linenos">770</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-771"><a href="#MarkupLanguage.tokenize_ansi-771"><span class="linenos">771</span></a>                <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
</span><span id="MarkupLanguage.tokenize_ansi-772"><a href="#MarkupLanguage.tokenize_ansi-772"><span class="linenos">772</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-773"><a href="#MarkupLanguage.tokenize_ansi-773"><span class="linenos">773</span></a>                <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">plain</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-774"><a href="#MarkupLanguage.tokenize_ansi-774"><span class="linenos">774</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-775"><a href="#MarkupLanguage.tokenize_ansi-775"><span class="linenos">775</span></a>            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">code</span>
</span><span id="MarkupLanguage.tokenize_ansi-776"><a href="#MarkupLanguage.tokenize_ansi-776"><span class="linenos">776</span></a>            <span class="n">ttype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.tokenize_ansi-777"><a href="#MarkupLanguage.tokenize_ansi-777"><span class="linenos">777</span></a>            <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage.tokenize_ansi-778"><a href="#MarkupLanguage.tokenize_ansi-778"><span class="linenos">778</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-779"><a href="#MarkupLanguage.tokenize_ansi-779"><span class="linenos">779</span></a>            <span class="c1"># Styles &amp; Unsetters</span>
</span><span id="MarkupLanguage.tokenize_ansi-780"><a href="#MarkupLanguage.tokenize_ansi-780"><span class="linenos">780</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-781"><a href="#MarkupLanguage.tokenize_ansi-781"><span class="linenos">781</span></a>                <span class="c1"># Covariancy is not an issue here, even though mypy seems to think so.</span>
</span><span id="MarkupLanguage.tokenize_ansi-782"><a href="#MarkupLanguage.tokenize_ansi-782"><span class="linenos">782</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="MarkupLanguage.tokenize_ansi-783"><a href="#MarkupLanguage.tokenize_ansi-783"><span class="linenos">783</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-784"><a href="#MarkupLanguage.tokenize_ansi-784"><span class="linenos">784</span></a>                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span>
</span><span id="MarkupLanguage.tokenize_ansi-785"><a href="#MarkupLanguage.tokenize_ansi-785"><span class="linenos">785</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-786"><a href="#MarkupLanguage.tokenize_ansi-786"><span class="linenos">786</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-787"><a href="#MarkupLanguage.tokenize_ansi-787"><span class="linenos">787</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">_is_in_tags</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-788"><a href="#MarkupLanguage.tokenize_ansi-788"><span class="linenos">788</span></a>                    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-789"><a href="#MarkupLanguage.tokenize_ansi-789"><span class="linenos">789</span></a>                        <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">STYLE</span>
</span><span id="MarkupLanguage.tokenize_ansi-790"><a href="#MarkupLanguage.tokenize_ansi-790"><span class="linenos">790</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-791"><a href="#MarkupLanguage.tokenize_ansi-791"><span class="linenos">791</span></a>            <span class="c1"># Colors</span>
</span><span id="MarkupLanguage.tokenize_ansi-792"><a href="#MarkupLanguage.tokenize_ansi-792"><span class="linenos">792</span></a>            <span class="k">if</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-793"><a href="#MarkupLanguage.tokenize_ansi-793"><span class="linenos">793</span></a>                <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">ColorSyntaxError</span><span class="p">):</span>
</span><span id="MarkupLanguage.tokenize_ansi-794"><a href="#MarkupLanguage.tokenize_ansi-794"><span class="linenos">794</span></a>                    <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_generate_color</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-795"><a href="#MarkupLanguage.tokenize_ansi-795"><span class="linenos">795</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-796"><a href="#MarkupLanguage.tokenize_ansi-796"><span class="linenos">796</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-797"><a href="#MarkupLanguage.tokenize_ansi-797"><span class="linenos">797</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MarkupLanguage.tokenize_ansi-798"><a href="#MarkupLanguage.tokenize_ansi-798"><span class="linenos">798</span></a>                    <span class="k">raise</span> <span class="n">AnsiSyntaxError</span><span class="p">(</span>
</span><span id="MarkupLanguage.tokenize_ansi-799"><a href="#MarkupLanguage.tokenize_ansi-799"><span class="linenos">799</span></a>                        <span class="n">tag</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;not recognized&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ansi</span>
</span><span id="MarkupLanguage.tokenize_ansi-800"><a href="#MarkupLanguage.tokenize_ansi-800"><span class="linenos">800</span></a>                    <span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-801"><a href="#MarkupLanguage.tokenize_ansi-801"><span class="linenos">801</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-802"><a href="#MarkupLanguage.tokenize_ansi-802"><span class="linenos">802</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
</span><span id="MarkupLanguage.tokenize_ansi-803"><a href="#MarkupLanguage.tokenize_ansi-803"><span class="linenos">803</span></a>                <span class="n">ttype</span> <span class="o">=</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span>
</span><span id="MarkupLanguage.tokenize_ansi-804"><a href="#MarkupLanguage.tokenize_ansi-804"><span class="linenos">804</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
</span><span id="MarkupLanguage.tokenize_ansi-805"><a href="#MarkupLanguage.tokenize_ansi-805"><span class="linenos">805</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-806"><a href="#MarkupLanguage.tokenize_ansi-806"><span class="linenos">806</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">ttype</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="MarkupLanguage.tokenize_ansi-807"><a href="#MarkupLanguage.tokenize_ansi-807"><span class="linenos">807</span></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="MarkupLanguage.tokenize_ansi-808"><a href="#MarkupLanguage.tokenize_ansi-808"><span class="linenos">808</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-809"><a href="#MarkupLanguage.tokenize_ansi-809"><span class="linenos">809</span></a>        <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage.tokenize_ansi-810"><a href="#MarkupLanguage.tokenize_ansi-810"><span class="linenos">810</span></a>            <span class="n">plain</span> <span class="o">=</span> <span class="n">ansi</span><span class="p">[</span><span class="n">cursor</span><span class="p">:]</span>
</span><span id="MarkupLanguage.tokenize_ansi-811"><a href="#MarkupLanguage.tokenize_ansi-811"><span class="linenos">811</span></a>
</span><span id="MarkupLanguage.tokenize_ansi-812"><a href="#MarkupLanguage.tokenize_ansi-812"><span class="linenos">812</span></a>            <span class="k">yield</span> <span class="n">Token</span><span class="p">(</span><span class="n">ttype</span><span class="o">=</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">plain</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Converts the given ANSI string into an iterator of <code>Token</code>.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>ansi:</strong>  The text to look at.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>An iterator of tokens. The reason this is an iterator is to possibly save
  on memory.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.define" class="classattr">
                                        <input id="MarkupLanguage.define-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">define</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.define-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.define"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.define-814"><a href="#MarkupLanguage.define-814"><span class="linenos">814</span></a>    <span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">MacroCallable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.define-815"><a href="#MarkupLanguage.define-815"><span class="linenos">815</span></a>        <span class="sd">&quot;&quot;&quot;Defines a Macro tag that executes the given method.</span>
</span><span id="MarkupLanguage.define-816"><a href="#MarkupLanguage.define-816"><span class="linenos">816</span></a>
</span><span id="MarkupLanguage.define-817"><a href="#MarkupLanguage.define-817"><span class="linenos">817</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.define-818"><a href="#MarkupLanguage.define-818"><span class="linenos">818</span></a><span class="sd">            name: The name the given method will be reachable by within markup.</span>
</span><span id="MarkupLanguage.define-819"><a href="#MarkupLanguage.define-819"><span class="linenos">819</span></a><span class="sd">                The given value gets &quot;!&quot; prepended if it isn&#39;t present already.</span>
</span><span id="MarkupLanguage.define-820"><a href="#MarkupLanguage.define-820"><span class="linenos">820</span></a><span class="sd">            method: The method this macro will execute.</span>
</span><span id="MarkupLanguage.define-821"><a href="#MarkupLanguage.define-821"><span class="linenos">821</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.define-822"><a href="#MarkupLanguage.define-822"><span class="linenos">822</span></a>
</span><span id="MarkupLanguage.define-823"><a href="#MarkupLanguage.define-823"><span class="linenos">823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.define-824"><a href="#MarkupLanguage.define-824"><span class="linenos">824</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;!</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage.define-825"><a href="#MarkupLanguage.define-825"><span class="linenos">825</span></a>
</span><span id="MarkupLanguage.define-826"><a href="#MarkupLanguage.define-826"><span class="linenos">826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
</span><span id="MarkupLanguage.define-827"><a href="#MarkupLanguage.define-827"><span class="linenos">827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Defines a Macro tag that executes the given method.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>name:</strong>  The name the given method will be reachable by within markup.
The given value gets "!" prepended if it isn't present already.</li>
<li><strong>method:</strong>  The method this macro will execute.</li>
</ul>
</div>


                            </div>
                            <div id="MarkupLanguage.alias" class="classattr">
                                        <input id="MarkupLanguage.alias-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">alias</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.alias-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.alias"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.alias-829"><a href="#MarkupLanguage.alias-829"><span class="linenos">829</span></a>    <span class="k">def</span> <span class="nf">alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-830"><a href="#MarkupLanguage.alias-830"><span class="linenos">830</span></a>        <span class="sd">&quot;&quot;&quot;Aliases the given name to a value, and generates an unsetter for it.</span>
</span><span id="MarkupLanguage.alias-831"><a href="#MarkupLanguage.alias-831"><span class="linenos">831</span></a>
</span><span id="MarkupLanguage.alias-832"><a href="#MarkupLanguage.alias-832"><span class="linenos">832</span></a><span class="sd">        Note that it is not possible to alias macros.</span>
</span><span id="MarkupLanguage.alias-833"><a href="#MarkupLanguage.alias-833"><span class="linenos">833</span></a>
</span><span id="MarkupLanguage.alias-834"><a href="#MarkupLanguage.alias-834"><span class="linenos">834</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.alias-835"><a href="#MarkupLanguage.alias-835"><span class="linenos">835</span></a><span class="sd">            name: The name of the new tag.</span>
</span><span id="MarkupLanguage.alias-836"><a href="#MarkupLanguage.alias-836"><span class="linenos">836</span></a><span class="sd">            value: The value the new tag will stand for.</span>
</span><span id="MarkupLanguage.alias-837"><a href="#MarkupLanguage.alias-837"><span class="linenos">837</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.alias-838"><a href="#MarkupLanguage.alias-838"><span class="linenos">838</span></a>
</span><span id="MarkupLanguage.alias-839"><a href="#MarkupLanguage.alias-839"><span class="linenos">839</span></a>        <span class="k">def</span> <span class="nf">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-840"><a href="#MarkupLanguage.alias-840"><span class="linenos">840</span></a>            <span class="sd">&quot;&quot;&quot;Get unsetter for a token&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.alias-841"><a href="#MarkupLanguage.alias-841"><span class="linenos">841</span></a>
</span><span id="MarkupLanguage.alias-842"><a href="#MarkupLanguage.alias-842"><span class="linenos">842</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-843"><a href="#MarkupLanguage.alias-843"><span class="linenos">843</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.alias-844"><a href="#MarkupLanguage.alias-844"><span class="linenos">844</span></a>
</span><span id="MarkupLanguage.alias-845"><a href="#MarkupLanguage.alias-845"><span class="linenos">845</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-846"><a href="#MarkupLanguage.alias-846"><span class="linenos">846</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-847"><a href="#MarkupLanguage.alias-847"><span class="linenos">847</span></a>
</span><span id="MarkupLanguage.alias-848"><a href="#MarkupLanguage.alias-848"><span class="linenos">848</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-849"><a href="#MarkupLanguage.alias-849"><span class="linenos">849</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-850"><a href="#MarkupLanguage.alias-850"><span class="linenos">850</span></a>
</span><span id="MarkupLanguage.alias-851"><a href="#MarkupLanguage.alias-851"><span class="linenos">851</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-852"><a href="#MarkupLanguage.alias-852"><span class="linenos">852</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/bg&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-853"><a href="#MarkupLanguage.alias-853"><span class="linenos">853</span></a>
</span><span id="MarkupLanguage.alias-854"><a href="#MarkupLanguage.alias-854"><span class="linenos">854</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="s2">&quot;/fg&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-855"><a href="#MarkupLanguage.alias-855"><span class="linenos">855</span></a>
</span><span id="MarkupLanguage.alias-856"><a href="#MarkupLanguage.alias-856"><span class="linenos">856</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage.alias-857"><a href="#MarkupLanguage.alias-857"><span class="linenos">857</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-858"><a href="#MarkupLanguage.alias-858"><span class="linenos">858</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find unsetter for token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-859"><a href="#MarkupLanguage.alias-859"><span class="linenos">859</span></a>
</span><span id="MarkupLanguage.alias-860"><a href="#MarkupLanguage.alias-860"><span class="linenos">860</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-861"><a href="#MarkupLanguage.alias-861"><span class="linenos">861</span></a>
</span><span id="MarkupLanguage.alias-862"><a href="#MarkupLanguage.alias-862"><span class="linenos">862</span></a>        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.alias-863"><a href="#MarkupLanguage.alias-863"><span class="linenos">863</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only macro tags can always start with &quot;!&quot;.&#39;</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-864"><a href="#MarkupLanguage.alias-864"><span class="linenos">864</span></a>
</span><span id="MarkupLanguage.alias-865"><a href="#MarkupLanguage.alias-865"><span class="linenos">865</span></a>        <span class="n">setter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.alias-866"><a href="#MarkupLanguage.alias-866"><span class="linenos">866</span></a>        <span class="n">unsetter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.alias-867"><a href="#MarkupLanguage.alias-867"><span class="linenos">867</span></a>
</span><span id="MarkupLanguage.alias-868"><a href="#MarkupLanguage.alias-868"><span class="linenos">868</span></a>        <span class="c1"># Try to link to existing tag</span>
</span><span id="MarkupLanguage.alias-869"><a href="#MarkupLanguage.alias-869"><span class="linenos">869</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-870"><a href="#MarkupLanguage.alias-870"><span class="linenos">870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-871"><a href="#MarkupLanguage.alias-871"><span class="linenos">871</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
</span><span id="MarkupLanguage.alias-872"><a href="#MarkupLanguage.alias-872"><span class="linenos">872</span></a>            <span class="k">return</span>
</span><span id="MarkupLanguage.alias-873"><a href="#MarkupLanguage.alias-873"><span class="linenos">873</span></a>
</span><span id="MarkupLanguage.alias-874"><a href="#MarkupLanguage.alias-874"><span class="linenos">874</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.alias-875"><a href="#MarkupLanguage.alias-875"><span class="linenos">875</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-876"><a href="#MarkupLanguage.alias-876"><span class="linenos">876</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.alias-877"><a href="#MarkupLanguage.alias-877"><span class="linenos">877</span></a>
</span><span id="MarkupLanguage.alias-878"><a href="#MarkupLanguage.alias-878"><span class="linenos">878</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.alias-879"><a href="#MarkupLanguage.alias-879"><span class="linenos">879</span></a>            <span class="n">setter</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage.alias-880"><a href="#MarkupLanguage.alias-880"><span class="linenos">880</span></a>
</span><span id="MarkupLanguage.alias-881"><a href="#MarkupLanguage.alias-881"><span class="linenos">881</span></a>            <span class="n">t_unsetter</span> <span class="o">=</span> <span class="n">_get_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-882"><a href="#MarkupLanguage.alias-882"><span class="linenos">882</span></a>            <span class="n">unsetter</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">t_unsetter</span><span class="si">}</span><span class="s2">m&quot;</span>
</span><span id="MarkupLanguage.alias-883"><a href="#MarkupLanguage.alias-883"><span class="linenos">883</span></a>
</span><span id="MarkupLanguage.alias-884"><a href="#MarkupLanguage.alias-884"><span class="linenos">884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unsetter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-885"><a href="#MarkupLanguage.alias-885"><span class="linenos">885</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">setter</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-886"><a href="#MarkupLanguage.alias-886"><span class="linenos">886</span></a>
</span><span id="MarkupLanguage.alias-887"><a href="#MarkupLanguage.alias-887"><span class="linenos">887</span></a>        <span class="n">marked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.alias-888"><a href="#MarkupLanguage.alias-888"><span class="linenos">888</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-889"><a href="#MarkupLanguage.alias-889"><span class="linenos">889</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-890"><a href="#MarkupLanguage.alias-890"><span class="linenos">890</span></a>                <span class="n">marked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="MarkupLanguage.alias-891"><a href="#MarkupLanguage.alias-891"><span class="linenos">891</span></a>
</span><span id="MarkupLanguage.alias-892"><a href="#MarkupLanguage.alias-892"><span class="linenos">892</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
</span><span id="MarkupLanguage.alias-893"><a href="#MarkupLanguage.alias-893"><span class="linenos">893</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Aliases the given name to a value, and generates an unsetter for it.</p>

<p>Note that it is not possible to alias macros.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>name:</strong>  The name of the new tag.</li>
<li><strong>value:</strong>  The value the new tag will stand for.</li>
</ul>
</div>


                            </div>
                            <div id="MarkupLanguage.parse" class="classattr">
                                        <input id="MarkupLanguage.parse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#StyledText">pytermgui.parser.StyledText</a></span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.parse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.parse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.parse-897"><a href="#MarkupLanguage.parse-897"><span class="linenos"> 897</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-branches</span>
</span><span id="MarkupLanguage.parse-898"><a href="#MarkupLanguage.parse-898"><span class="linenos"> 898</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">markup_text</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MarkupLanguage.parse-899"><a href="#MarkupLanguage.parse-899"><span class="linenos"> 899</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StyledText</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-900"><a href="#MarkupLanguage.parse-900"><span class="linenos"> 900</span></a>        <span class="sd">&quot;&quot;&quot;Parses the given markup.</span>
</span><span id="MarkupLanguage.parse-901"><a href="#MarkupLanguage.parse-901"><span class="linenos"> 901</span></a>
</span><span id="MarkupLanguage.parse-902"><a href="#MarkupLanguage.parse-902"><span class="linenos"> 902</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.parse-903"><a href="#MarkupLanguage.parse-903"><span class="linenos"> 903</span></a><span class="sd">            markup_text: The markup to parse.</span>
</span><span id="MarkupLanguage.parse-904"><a href="#MarkupLanguage.parse-904"><span class="linenos"> 904</span></a>
</span><span id="MarkupLanguage.parse-905"><a href="#MarkupLanguage.parse-905"><span class="linenos"> 905</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.parse-906"><a href="#MarkupLanguage.parse-906"><span class="linenos"> 906</span></a><span class="sd">            A `StyledText` instance of the result of parsing the input. This</span>
</span><span id="MarkupLanguage.parse-907"><a href="#MarkupLanguage.parse-907"><span class="linenos"> 907</span></a><span class="sd">            custom `str` class is used to allow accessing the plain value of</span>
</span><span id="MarkupLanguage.parse-908"><a href="#MarkupLanguage.parse-908"><span class="linenos"> 908</span></a><span class="sd">            the output, as well as to cleanly index within it. It is analogous</span>
</span><span id="MarkupLanguage.parse-909"><a href="#MarkupLanguage.parse-909"><span class="linenos"> 909</span></a><span class="sd">            to builtin `str`, only adds extra things on top.</span>
</span><span id="MarkupLanguage.parse-910"><a href="#MarkupLanguage.parse-910"><span class="linenos"> 910</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-911"><a href="#MarkupLanguage.parse-911"><span class="linenos"> 911</span></a>
</span><span id="MarkupLanguage.parse-912"><a href="#MarkupLanguage.parse-912"><span class="linenos"> 912</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.parse-913"><a href="#MarkupLanguage.parse-913"><span class="linenos"> 913</span></a>        <span class="n">previous_token</span><span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.parse-914"><a href="#MarkupLanguage.parse-914"><span class="linenos"> 914</span></a>        <span class="n">previous_sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-915"><a href="#MarkupLanguage.parse-915"><span class="linenos"> 915</span></a>        <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-916"><a href="#MarkupLanguage.parse-916"><span class="linenos"> 916</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-917"><a href="#MarkupLanguage.parse-917"><span class="linenos"> 917</span></a>
</span><span id="MarkupLanguage.parse-918"><a href="#MarkupLanguage.parse-918"><span class="linenos"> 918</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-919"><a href="#MarkupLanguage.parse-919"><span class="linenos"> 919</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-920"><a href="#MarkupLanguage.parse-920"><span class="linenos"> 920</span></a>
</span><span id="MarkupLanguage.parse-921"><a href="#MarkupLanguage.parse-921"><span class="linenos"> 921</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-922"><a href="#MarkupLanguage.parse-922"><span class="linenos"> 922</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-923"><a href="#MarkupLanguage.parse-923"><span class="linenos"> 923</span></a>
</span><span id="MarkupLanguage.parse-924"><a href="#MarkupLanguage.parse-924"><span class="linenos"> 924</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage.parse-925"><a href="#MarkupLanguage.parse-925"><span class="linenos"> 925</span></a>
</span><span id="MarkupLanguage.parse-926"><a href="#MarkupLanguage.parse-926"><span class="linenos"> 926</span></a>        <span class="k">def</span> <span class="nf">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-927"><a href="#MarkupLanguage.parse-927"><span class="linenos"> 927</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">):</span>
</span><span id="MarkupLanguage.parse-928"><a href="#MarkupLanguage.parse-928"><span class="linenos"> 928</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="MarkupLanguage.parse-929"><a href="#MarkupLanguage.parse-929"><span class="linenos"> 929</span></a>
</span><span id="MarkupLanguage.parse-930"><a href="#MarkupLanguage.parse-930"><span class="linenos"> 930</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="MarkupLanguage.parse-931"><a href="#MarkupLanguage.parse-931"><span class="linenos"> 931</span></a>                <span class="nb">type</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-932"><a href="#MarkupLanguage.parse-932"><span class="linenos"> 932</span></a>                <span class="ow">and</span> <span class="n">previous</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span>
</span><span id="MarkupLanguage.parse-933"><a href="#MarkupLanguage.parse-933"><span class="linenos"> 933</span></a>            <span class="p">)</span>
</span><span id="MarkupLanguage.parse-934"><a href="#MarkupLanguage.parse-934"><span class="linenos"> 934</span></a>
</span><span id="MarkupLanguage.parse-935"><a href="#MarkupLanguage.parse-935"><span class="linenos"> 935</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="MarkupLanguage.parse-936"><a href="#MarkupLanguage.parse-936"><span class="linenos"> 936</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">should_cache</span>
</span><span id="MarkupLanguage.parse-937"><a href="#MarkupLanguage.parse-937"><span class="linenos"> 937</span></a>            <span class="ow">and</span> <span class="n">markup_text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span>
</span><span id="MarkupLanguage.parse-938"><a href="#MarkupLanguage.parse-938"><span class="linenos"> 938</span></a>            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">RE_MACRO</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">markup_text</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MarkupLanguage.parse-939"><a href="#MarkupLanguage.parse-939"><span class="linenos"> 939</span></a>        <span class="p">):</span>
</span><span id="MarkupLanguage.parse-940"><a href="#MarkupLanguage.parse-940"><span class="linenos"> 940</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span>
</span><span id="MarkupLanguage.parse-941"><a href="#MarkupLanguage.parse-941"><span class="linenos"> 941</span></a>
</span><span id="MarkupLanguage.parse-942"><a href="#MarkupLanguage.parse-942"><span class="linenos"> 942</span></a>        <span class="n">token</span><span class="p">:</span> <span class="n">Token</span>
</span><span id="MarkupLanguage.parse-943"><a href="#MarkupLanguage.parse-943"><span class="linenos"> 943</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">markup_text</span><span class="p">):</span>
</span><span id="MarkupLanguage.parse-944"><a href="#MarkupLanguage.parse-944"><span class="linenos"> 944</span></a>            <span class="k">if</span> <span class="n">sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">previous_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-945"><a href="#MarkupLanguage.parse-945"><span class="linenos"> 945</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-946"><a href="#MarkupLanguage.parse-946"><span class="linenos"> 946</span></a>
</span><span id="MarkupLanguage.parse-947"><a href="#MarkupLanguage.parse-947"><span class="linenos"> 947</span></a>            <span class="c1"># Optimize out previously added color tokens, as only the most</span>
</span><span id="MarkupLanguage.parse-948"><a href="#MarkupLanguage.parse-948"><span class="linenos"> 948</span></a>            <span class="c1"># recent would be visible anyways.</span>
</span><span id="MarkupLanguage.parse-949"><a href="#MarkupLanguage.parse-949"><span class="linenos"> 949</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MarkupLanguage.parse-950"><a href="#MarkupLanguage.parse-950"><span class="linenos"> 950</span></a>                <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.parse-951"><a href="#MarkupLanguage.parse-951"><span class="linenos"> 951</span></a>                <span class="ow">and</span> <span class="n">previous_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.parse-952"><a href="#MarkupLanguage.parse-952"><span class="linenos"> 952</span></a>                <span class="ow">and</span> <span class="n">_is_same_colorgroup</span><span class="p">(</span><span class="n">previous_token</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-953"><a href="#MarkupLanguage.parse-953"><span class="linenos"> 953</span></a>            <span class="p">):</span>
</span><span id="MarkupLanguage.parse-954"><a href="#MarkupLanguage.parse-954"><span class="linenos"> 954</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage.parse-955"><a href="#MarkupLanguage.parse-955"><span class="linenos"> 955</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-956"><a href="#MarkupLanguage.parse-956"><span class="linenos"> 956</span></a>
</span><span id="MarkupLanguage.parse-957"><a href="#MarkupLanguage.parse-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-958"><a href="#MarkupLanguage.parse-958"><span class="linenos"> 958</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage.parse-959"><a href="#MarkupLanguage.parse-959"><span class="linenos"> 959</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-960"><a href="#MarkupLanguage.parse-960"><span class="linenos"> 960</span></a>                <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.parse-961"><a href="#MarkupLanguage.parse-961"><span class="linenos"> 961</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-962"><a href="#MarkupLanguage.parse-962"><span class="linenos"> 962</span></a>
</span><span id="MarkupLanguage.parse-963"><a href="#MarkupLanguage.parse-963"><span class="linenos"> 963</span></a>            <span class="n">previous_token</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="MarkupLanguage.parse-964"><a href="#MarkupLanguage.parse-964"><span class="linenos"> 964</span></a>
</span><span id="MarkupLanguage.parse-965"><a href="#MarkupLanguage.parse-965"><span class="linenos"> 965</span></a>            <span class="c1"># Macro unsetters are stored with None as their data</span>
</span><span id="MarkupLanguage.parse-966"><a href="#MarkupLanguage.parse-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-967"><a href="#MarkupLanguage.parse-967"><span class="linenos"> 967</span></a>                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="MarkupLanguage.parse-968"><a href="#MarkupLanguage.parse-968"><span class="linenos"> 968</span></a>                    <span class="n">macro_match</span> <span class="o">=</span> <span class="n">RE_MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-969"><a href="#MarkupLanguage.parse-969"><span class="linenos"> 969</span></a>                    <span class="k">assert</span> <span class="n">macro_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.parse-970"><a href="#MarkupLanguage.parse-970"><span class="linenos"> 970</span></a>
</span><span id="MarkupLanguage.parse-971"><a href="#MarkupLanguage.parse-971"><span class="linenos"> 971</span></a>                    <span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MarkupLanguage.parse-972"><a href="#MarkupLanguage.parse-972"><span class="linenos"> 972</span></a>
</span><span id="MarkupLanguage.parse-973"><a href="#MarkupLanguage.parse-973"><span class="linenos"> 973</span></a>                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">macro_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-974"><a href="#MarkupLanguage.parse-974"><span class="linenos"> 974</span></a>                        <span class="n">applied_macros</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage.parse-975"><a href="#MarkupLanguage.parse-975"><span class="linenos"> 975</span></a>
</span><span id="MarkupLanguage.parse-976"><a href="#MarkupLanguage.parse-976"><span class="linenos"> 976</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-977"><a href="#MarkupLanguage.parse-977"><span class="linenos"> 977</span></a>
</span><span id="MarkupLanguage.parse-978"><a href="#MarkupLanguage.parse-978"><span class="linenos"> 978</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-979"><a href="#MarkupLanguage.parse-979"><span class="linenos"> 979</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-980"><a href="#MarkupLanguage.parse-980"><span class="linenos"> 980</span></a>
</span><span id="MarkupLanguage.parse-981"><a href="#MarkupLanguage.parse-981"><span class="linenos"> 981</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage.parse-982"><a href="#MarkupLanguage.parse-982"><span class="linenos"> 982</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-983"><a href="#MarkupLanguage.parse-983"><span class="linenos"> 983</span></a>
</span><span id="MarkupLanguage.parse-984"><a href="#MarkupLanguage.parse-984"><span class="linenos"> 984</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-985"><a href="#MarkupLanguage.parse-985"><span class="linenos"> 985</span></a>                <span class="n">applied</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="MarkupLanguage.parse-986"><a href="#MarkupLanguage.parse-986"><span class="linenos"> 986</span></a>
</span><span id="MarkupLanguage.parse-987"><a href="#MarkupLanguage.parse-987"><span class="linenos"> 987</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.parse-988"><a href="#MarkupLanguage.parse-988"><span class="linenos"> 988</span></a>                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">previous_sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.parse-989"><a href="#MarkupLanguage.parse-989"><span class="linenos"> 989</span></a>                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsetters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="MarkupLanguage.parse-990"><a href="#MarkupLanguage.parse-990"><span class="linenos"> 990</span></a>                            <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-991"><a href="#MarkupLanguage.parse-991"><span class="linenos"> 991</span></a>
</span><span id="MarkupLanguage.parse-992"><a href="#MarkupLanguage.parse-992"><span class="linenos"> 992</span></a>                        <span class="n">item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage.parse-993"><a href="#MarkupLanguage.parse-993"><span class="linenos"> 993</span></a>                        <span class="n">applied</span> <span class="o">=</span> <span class="n">applied</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-994"><a href="#MarkupLanguage.parse-994"><span class="linenos"> 994</span></a>
</span><span id="MarkupLanguage.parse-995"><a href="#MarkupLanguage.parse-995"><span class="linenos"> 995</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">applied</span> <span class="o">+</span> <span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-996"><a href="#MarkupLanguage.parse-996"><span class="linenos"> 996</span></a>                <span class="n">previous_sequence</span> <span class="o">=</span> <span class="n">sequence</span>
</span><span id="MarkupLanguage.parse-997"><a href="#MarkupLanguage.parse-997"><span class="linenos"> 997</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.parse-998"><a href="#MarkupLanguage.parse-998"><span class="linenos"> 998</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.parse-999"><a href="#MarkupLanguage.parse-999"><span class="linenos"> 999</span></a>
</span><span id="MarkupLanguage.parse-1000"><a href="#MarkupLanguage.parse-1000"><span class="linenos">1000</span></a>            <span class="n">sequence</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage.parse-1001"><a href="#MarkupLanguage.parse-1001"><span class="linenos">1001</span></a>
</span><span id="MarkupLanguage.parse-1002"><a href="#MarkupLanguage.parse-1002"><span class="linenos">1002</span></a>        <span class="k">if</span> <span class="n">sequence</span> <span class="o">+</span> <span class="n">previous_sequence</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage.parse-1003"><a href="#MarkupLanguage.parse-1003"><span class="linenos">1003</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage.parse-1004"><a href="#MarkupLanguage.parse-1004"><span class="linenos">1004</span></a>
</span><span id="MarkupLanguage.parse-1005"><a href="#MarkupLanguage.parse-1005"><span class="linenos">1005</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="MarkupLanguage.parse-1006"><a href="#MarkupLanguage.parse-1006"><span class="linenos">1006</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">markup_text</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="MarkupLanguage.parse-1007"><a href="#MarkupLanguage.parse-1007"><span class="linenos">1007</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Parses the given markup.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>markup_text:</strong>  The markup to parse.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A <code><a href="#StyledText">StyledText</a></code> instance of the result of parsing the input. This
  custom <code>str</code> class is used to allow accessing the plain value of
  the output, as well as to cleanly index within it. It is analogous
  to builtin <code>str</code>, only adds extra things on top.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.get_markup" class="classattr">
                                        <input id="MarkupLanguage.get_markup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_markup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.get_markup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.get_markup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.get_markup-1009"><a href="#MarkupLanguage.get_markup-1009"><span class="linenos">1009</span></a>    <span class="k">def</span> <span class="nf">get_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ansi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_markup-1010"><a href="#MarkupLanguage.get_markup-1010"><span class="linenos">1010</span></a>        <span class="sd">&quot;&quot;&quot;Generates markup from ANSI text.</span>
</span><span id="MarkupLanguage.get_markup-1011"><a href="#MarkupLanguage.get_markup-1011"><span class="linenos">1011</span></a>
</span><span id="MarkupLanguage.get_markup-1012"><a href="#MarkupLanguage.get_markup-1012"><span class="linenos">1012</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.get_markup-1013"><a href="#MarkupLanguage.get_markup-1013"><span class="linenos">1013</span></a><span class="sd">            ansi: The text to get markup from.</span>
</span><span id="MarkupLanguage.get_markup-1014"><a href="#MarkupLanguage.get_markup-1014"><span class="linenos">1014</span></a>
</span><span id="MarkupLanguage.get_markup-1015"><a href="#MarkupLanguage.get_markup-1015"><span class="linenos">1015</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.get_markup-1016"><a href="#MarkupLanguage.get_markup-1016"><span class="linenos">1016</span></a><span class="sd">            A markup string that can be parsed to get (visually) the same</span>
</span><span id="MarkupLanguage.get_markup-1017"><a href="#MarkupLanguage.get_markup-1017"><span class="linenos">1017</span></a><span class="sd">            result. Note that this conversion is lossy in a way: there are some</span>
</span><span id="MarkupLanguage.get_markup-1018"><a href="#MarkupLanguage.get_markup-1018"><span class="linenos">1018</span></a><span class="sd">            details (like macros) that cannot be preserved in an ANSI-&gt;Markup-&gt;ANSI</span>
</span><span id="MarkupLanguage.get_markup-1019"><a href="#MarkupLanguage.get_markup-1019"><span class="linenos">1019</span></a><span class="sd">            conversion.</span>
</span><span id="MarkupLanguage.get_markup-1020"><a href="#MarkupLanguage.get_markup-1020"><span class="linenos">1020</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.get_markup-1021"><a href="#MarkupLanguage.get_markup-1021"><span class="linenos">1021</span></a>
</span><span id="MarkupLanguage.get_markup-1022"><a href="#MarkupLanguage.get_markup-1022"><span class="linenos">1022</span></a>        <span class="n">current_tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.get_markup-1023"><a href="#MarkupLanguage.get_markup-1023"><span class="linenos">1023</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.get_markup-1024"><a href="#MarkupLanguage.get_markup-1024"><span class="linenos">1024</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">ansi</span><span class="p">):</span>
</span><span id="MarkupLanguage.get_markup-1025"><a href="#MarkupLanguage.get_markup-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_markup-1026"><a href="#MarkupLanguage.get_markup-1026"><span class="linenos">1026</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_markup-1027"><a href="#MarkupLanguage.get_markup-1027"><span class="linenos">1027</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_tags</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage.get_markup-1028"><a href="#MarkupLanguage.get_markup-1028"><span class="linenos">1028</span></a>
</span><span id="MarkupLanguage.get_markup-1029"><a href="#MarkupLanguage.get_markup-1029"><span class="linenos">1029</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_markup-1030"><a href="#MarkupLanguage.get_markup-1030"><span class="linenos">1030</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="MarkupLanguage.get_markup-1031"><a href="#MarkupLanguage.get_markup-1031"><span class="linenos">1031</span></a>                <span class="n">current_tags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.get_markup-1032"><a href="#MarkupLanguage.get_markup-1032"><span class="linenos">1032</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.get_markup-1033"><a href="#MarkupLanguage.get_markup-1033"><span class="linenos">1033</span></a>
</span><span id="MarkupLanguage.get_markup-1034"><a href="#MarkupLanguage.get_markup-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_markup-1035"><a href="#MarkupLanguage.get_markup-1035"><span class="linenos">1035</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_markup-1036"><a href="#MarkupLanguage.get_markup-1036"><span class="linenos">1036</span></a>
</span><span id="MarkupLanguage.get_markup-1037"><a href="#MarkupLanguage.get_markup-1037"><span class="linenos">1037</span></a>                <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_markup-1038"><a href="#MarkupLanguage.get_markup-1038"><span class="linenos">1038</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.get_markup-1039"><a href="#MarkupLanguage.get_markup-1039"><span class="linenos">1039</span></a>
</span><span id="MarkupLanguage.get_markup-1040"><a href="#MarkupLanguage.get_markup-1040"><span class="linenos">1040</span></a>            <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_markup-1041"><a href="#MarkupLanguage.get_markup-1041"><span class="linenos">1041</span></a>
</span><span id="MarkupLanguage.get_markup-1042"><a href="#MarkupLanguage.get_markup-1042"><span class="linenos">1042</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Generates markup from ANSI text.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>ansi:</strong>  The text to get markup from.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A markup string that can be parsed to get (visually) the same
  result. Note that this conversion is lossy in a way: there are some
  details (like macros) that cannot be preserved in an ANSI->Markup->ANSI
  conversion.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.prettify_ansi" class="classattr">
                                        <input id="MarkupLanguage.prettify_ansi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prettify_ansi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.prettify_ansi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.prettify_ansi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.prettify_ansi-1044"><a href="#MarkupLanguage.prettify_ansi-1044"><span class="linenos">1044</span></a>    <span class="k">def</span> <span class="nf">prettify_ansi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_ansi-1045"><a href="#MarkupLanguage.prettify_ansi-1045"><span class="linenos">1045</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) ANSI str.</span>
</span><span id="MarkupLanguage.prettify_ansi-1046"><a href="#MarkupLanguage.prettify_ansi-1046"><span class="linenos">1046</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1047"><a href="#MarkupLanguage.prettify_ansi-1047"><span class="linenos">1047</span></a><span class="sd">        This is useful to quickly &quot;inspect&quot; a given ANSI string. However,</span>
</span><span id="MarkupLanguage.prettify_ansi-1048"><a href="#MarkupLanguage.prettify_ansi-1048"><span class="linenos">1048</span></a><span class="sd">        for most real uses `MarkupLanguage.prettify_markup` would be</span>
</span><span id="MarkupLanguage.prettify_ansi-1049"><a href="#MarkupLanguage.prettify_ansi-1049"><span class="linenos">1049</span></a><span class="sd">        preferable, given an argument of `MarkupLanguage.get_markup(text)`,</span>
</span><span id="MarkupLanguage.prettify_ansi-1050"><a href="#MarkupLanguage.prettify_ansi-1050"><span class="linenos">1050</span></a><span class="sd">        as it is much more verbose.</span>
</span><span id="MarkupLanguage.prettify_ansi-1051"><a href="#MarkupLanguage.prettify_ansi-1051"><span class="linenos">1051</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1052"><a href="#MarkupLanguage.prettify_ansi-1052"><span class="linenos">1052</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.prettify_ansi-1053"><a href="#MarkupLanguage.prettify_ansi-1053"><span class="linenos">1053</span></a><span class="sd">            text: The ANSI-text to prettify.</span>
</span><span id="MarkupLanguage.prettify_ansi-1054"><a href="#MarkupLanguage.prettify_ansi-1054"><span class="linenos">1054</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1055"><a href="#MarkupLanguage.prettify_ansi-1055"><span class="linenos">1055</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.prettify_ansi-1056"><a href="#MarkupLanguage.prettify_ansi-1056"><span class="linenos">1056</span></a><span class="sd">            The prettified ANSI text. This text&#39;s styles remain valid,</span>
</span><span id="MarkupLanguage.prettify_ansi-1057"><a href="#MarkupLanguage.prettify_ansi-1057"><span class="linenos">1057</span></a><span class="sd">            so copy-pasting the argument into a command (like printf)</span>
</span><span id="MarkupLanguage.prettify_ansi-1058"><a href="#MarkupLanguage.prettify_ansi-1058"><span class="linenos">1058</span></a><span class="sd">            that can show styled text will work the same way.</span>
</span><span id="MarkupLanguage.prettify_ansi-1059"><a href="#MarkupLanguage.prettify_ansi-1059"><span class="linenos">1059</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_ansi-1060"><a href="#MarkupLanguage.prettify_ansi-1060"><span class="linenos">1060</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1061"><a href="#MarkupLanguage.prettify_ansi-1061"><span class="linenos">1061</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_ansi-1062"><a href="#MarkupLanguage.prettify_ansi-1062"><span class="linenos">1062</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_ansi-1063"><a href="#MarkupLanguage.prettify_ansi-1063"><span class="linenos">1063</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage.prettify_ansi-1064"><a href="#MarkupLanguage.prettify_ansi-1064"><span class="linenos">1064</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_ansi-1065"><a href="#MarkupLanguage.prettify_ansi-1065"><span class="linenos">1065</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_ansi-1066"><a href="#MarkupLanguage.prettify_ansi-1066"><span class="linenos">1066</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span>
</span><span id="MarkupLanguage.prettify_ansi-1067"><a href="#MarkupLanguage.prettify_ansi-1067"><span class="linenos">1067</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.prettify_ansi-1068"><a href="#MarkupLanguage.prettify_ansi-1068"><span class="linenos">1068</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1069"><a href="#MarkupLanguage.prettify_ansi-1069"><span class="linenos">1069</span></a>            <span class="k">assert</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MarkupLanguage.prettify_ansi-1070"><a href="#MarkupLanguage.prettify_ansi-1070"><span class="linenos">1070</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x1b&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_ansi-1071"><a href="#MarkupLanguage.prettify_ansi-1071"><span class="linenos">1071</span></a>            <span class="n">sequences</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage.prettify_ansi-1072"><a href="#MarkupLanguage.prettify_ansi-1072"><span class="linenos">1072</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="n">sequences</span>
</span><span id="MarkupLanguage.prettify_ansi-1073"><a href="#MarkupLanguage.prettify_ansi-1073"><span class="linenos">1073</span></a>
</span><span id="MarkupLanguage.prettify_ansi-1074"><a href="#MarkupLanguage.prettify_ansi-1074"><span class="linenos">1074</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Returns a prettified (syntax-highlighted) ANSI str.</p>

<p>This is useful to quickly "inspect" a given ANSI string. However,
for most real uses <code><a href="#MarkupLanguage.prettify_markup">MarkupLanguage.prettify_markup</a></code> would be
preferable, given an argument of <code><a href="#MarkupLanguage.get_markup">MarkupLanguage.get_markup</a>(text)</code>,
as it is much more verbose.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>text:</strong>  The ANSI-text to prettify.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The prettified ANSI text. This text's styles remain valid,
  so copy-pasting the argument into a command (like printf)
  that can show styled text will work the same way.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.prettify_markup" class="classattr">
                                        <input id="MarkupLanguage.prettify_markup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prettify_markup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.prettify_markup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.prettify_markup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.prettify_markup-1076"><a href="#MarkupLanguage.prettify_markup-1076"><span class="linenos">1076</span></a>    <span class="k">def</span> <span class="nf">prettify_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1077"><a href="#MarkupLanguage.prettify_markup-1077"><span class="linenos">1077</span></a>        <span class="sd">&quot;&quot;&quot;Returns a prettified (syntax-highlighted) markup str.</span>
</span><span id="MarkupLanguage.prettify_markup-1078"><a href="#MarkupLanguage.prettify_markup-1078"><span class="linenos">1078</span></a>
</span><span id="MarkupLanguage.prettify_markup-1079"><a href="#MarkupLanguage.prettify_markup-1079"><span class="linenos">1079</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.prettify_markup-1080"><a href="#MarkupLanguage.prettify_markup-1080"><span class="linenos">1080</span></a><span class="sd">            text: The markup-text to prettify.</span>
</span><span id="MarkupLanguage.prettify_markup-1081"><a href="#MarkupLanguage.prettify_markup-1081"><span class="linenos">1081</span></a>
</span><span id="MarkupLanguage.prettify_markup-1082"><a href="#MarkupLanguage.prettify_markup-1082"><span class="linenos">1082</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.prettify_markup-1083"><a href="#MarkupLanguage.prettify_markup-1083"><span class="linenos">1083</span></a><span class="sd">            Prettified markup. This markup, excluding its styles,</span>
</span><span id="MarkupLanguage.prettify_markup-1084"><a href="#MarkupLanguage.prettify_markup-1084"><span class="linenos">1084</span></a><span class="sd">            remains valid markup.</span>
</span><span id="MarkupLanguage.prettify_markup-1085"><a href="#MarkupLanguage.prettify_markup-1085"><span class="linenos">1085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1086"><a href="#MarkupLanguage.prettify_markup-1086"><span class="linenos">1086</span></a>
</span><span id="MarkupLanguage.prettify_markup-1087"><a href="#MarkupLanguage.prettify_markup-1087"><span class="linenos">1087</span></a>        <span class="k">def</span> <span class="nf">_apply_macros</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1088"><a href="#MarkupLanguage.prettify_markup-1088"><span class="linenos">1088</span></a>            <span class="sd">&quot;&quot;&quot;Apply current macros to text&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1089"><a href="#MarkupLanguage.prettify_markup-1089"><span class="linenos">1089</span></a>
</span><span id="MarkupLanguage.prettify_markup-1090"><a href="#MarkupLanguage.prettify_markup-1090"><span class="linenos">1090</span></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="n">applied_macros</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1091"><a href="#MarkupLanguage.prettify_markup-1091"><span class="linenos">1091</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1092"><a href="#MarkupLanguage.prettify_markup-1092"><span class="linenos">1092</span></a>
</span><span id="MarkupLanguage.prettify_markup-1093"><a href="#MarkupLanguage.prettify_markup-1093"><span class="linenos">1093</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage.prettify_markup-1094"><a href="#MarkupLanguage.prettify_markup-1094"><span class="linenos">1094</span></a>
</span><span id="MarkupLanguage.prettify_markup-1095"><a href="#MarkupLanguage.prettify_markup-1095"><span class="linenos">1095</span></a>        <span class="k">def</span> <span class="nf">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1096"><a href="#MarkupLanguage.prettify_markup-1096"><span class="linenos">1096</span></a>            <span class="sd">&quot;&quot;&quot;Pops a macro from applied_macros.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1097"><a href="#MarkupLanguage.prettify_markup-1097"><span class="linenos">1097</span></a>
</span><span id="MarkupLanguage.prettify_markup-1098"><a href="#MarkupLanguage.prettify_markup-1098"><span class="linenos">1098</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">macro_name</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">applied_macros</span><span class="p">):</span>
</span><span id="MarkupLanguage.prettify_markup-1099"><a href="#MarkupLanguage.prettify_markup-1099"><span class="linenos">1099</span></a>                <span class="k">if</span> <span class="n">macro_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1100"><a href="#MarkupLanguage.prettify_markup-1100"><span class="linenos">1100</span></a>                    <span class="n">applied_macros</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1101"><a href="#MarkupLanguage.prettify_markup-1101"><span class="linenos">1101</span></a>                    <span class="k">break</span>
</span><span id="MarkupLanguage.prettify_markup-1102"><a href="#MarkupLanguage.prettify_markup-1102"><span class="linenos">1102</span></a>
</span><span id="MarkupLanguage.prettify_markup-1103"><a href="#MarkupLanguage.prettify_markup-1103"><span class="linenos">1103</span></a>        <span class="k">def</span> <span class="nf">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1104"><a href="#MarkupLanguage.prettify_markup-1104"><span class="linenos">1104</span></a>            <span class="sd">&quot;&quot;&quot;Adds ending cap to the given string.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1105"><a href="#MarkupLanguage.prettify_markup-1105"><span class="linenos">1105</span></a>
</span><span id="MarkupLanguage.prettify_markup-1106"><a href="#MarkupLanguage.prettify_markup-1106"><span class="linenos">1106</span></a>            <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1107"><a href="#MarkupLanguage.prettify_markup-1107"><span class="linenos">1107</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
</span><span id="MarkupLanguage.prettify_markup-1108"><a href="#MarkupLanguage.prettify_markup-1108"><span class="linenos">1108</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1109"><a href="#MarkupLanguage.prettify_markup-1109"><span class="linenos">1109</span></a>
</span><span id="MarkupLanguage.prettify_markup-1110"><a href="#MarkupLanguage.prettify_markup-1110"><span class="linenos">1110</span></a>                <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1111"><a href="#MarkupLanguage.prettify_markup-1111"><span class="linenos">1111</span></a>
</span><span id="MarkupLanguage.prettify_markup-1112"><a href="#MarkupLanguage.prettify_markup-1112"><span class="linenos">1112</span></a>            <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;[/]&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1113"><a href="#MarkupLanguage.prettify_markup-1113"><span class="linenos">1113</span></a>
</span><span id="MarkupLanguage.prettify_markup-1114"><a href="#MarkupLanguage.prettify_markup-1114"><span class="linenos">1114</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">TokenType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MarkupLanguage.prettify_markup-1115"><a href="#MarkupLanguage.prettify_markup-1115"><span class="linenos">1115</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span> <span class="s2">&quot;210&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage.prettify_markup-1116"><a href="#MarkupLanguage.prettify_markup-1116"><span class="linenos">1116</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">:</span> <span class="s2">&quot;210 bold&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage.prettify_markup-1117"><a href="#MarkupLanguage.prettify_markup-1117"><span class="linenos">1117</span></a>            <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span> <span class="s2">&quot;strikethrough&quot;</span><span class="p">,</span>
</span><span id="MarkupLanguage.prettify_markup-1118"><a href="#MarkupLanguage.prettify_markup-1118"><span class="linenos">1118</span></a>        <span class="p">}</span>
</span><span id="MarkupLanguage.prettify_markup-1119"><a href="#MarkupLanguage.prettify_markup-1119"><span class="linenos">1119</span></a>
</span><span id="MarkupLanguage.prettify_markup-1120"><a href="#MarkupLanguage.prettify_markup-1120"><span class="linenos">1120</span></a>        <span class="n">applied_macros</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MacroCall</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.prettify_markup-1121"><a href="#MarkupLanguage.prettify_markup-1121"><span class="linenos">1121</span></a>
</span><span id="MarkupLanguage.prettify_markup-1122"><a href="#MarkupLanguage.prettify_markup-1122"><span class="linenos">1122</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1123"><a href="#MarkupLanguage.prettify_markup-1123"><span class="linenos">1123</span></a>        <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MarkupLanguage.prettify_markup-1124"><a href="#MarkupLanguage.prettify_markup-1124"><span class="linenos">1124</span></a>        <span class="n">current_styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.prettify_markup-1125"><a href="#MarkupLanguage.prettify_markup-1125"><span class="linenos">1125</span></a>
</span><span id="MarkupLanguage.prettify_markup-1126"><a href="#MarkupLanguage.prettify_markup-1126"><span class="linenos">1126</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_markup</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage.prettify_markup-1127"><a href="#MarkupLanguage.prettify_markup-1127"><span class="linenos">1127</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">ESCAPED</span><span class="p">]:</span>
</span><span id="MarkupLanguage.prettify_markup-1128"><a href="#MarkupLanguage.prettify_markup-1128"><span class="linenos">1128</span></a>                <span class="k">if</span> <span class="n">in_sequence</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1129"><a href="#MarkupLanguage.prettify_markup-1129"><span class="linenos">1129</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1130"><a href="#MarkupLanguage.prettify_markup-1130"><span class="linenos">1130</span></a>
</span><span id="MarkupLanguage.prettify_markup-1131"><a href="#MarkupLanguage.prettify_markup-1131"><span class="linenos">1131</span></a>                <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MarkupLanguage.prettify_markup-1132"><a href="#MarkupLanguage.prettify_markup-1132"><span class="linenos">1132</span></a>
</span><span id="MarkupLanguage.prettify_markup-1133"><a href="#MarkupLanguage.prettify_markup-1133"><span class="linenos">1133</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1134"><a href="#MarkupLanguage.prettify_markup-1134"><span class="linenos">1134</span></a>                <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">current_styles</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1135"><a href="#MarkupLanguage.prettify_markup-1135"><span class="linenos">1135</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1136"><a href="#MarkupLanguage.prettify_markup-1136"><span class="linenos">1136</span></a>                        <span class="k">continue</span>
</span><span id="MarkupLanguage.prettify_markup-1137"><a href="#MarkupLanguage.prettify_markup-1137"><span class="linenos">1137</span></a>
</span><span id="MarkupLanguage.prettify_markup-1138"><a href="#MarkupLanguage.prettify_markup-1138"><span class="linenos">1138</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">style</span><span class="o">.</span><span class="n">sequence</span>
</span><span id="MarkupLanguage.prettify_markup-1139"><a href="#MarkupLanguage.prettify_markup-1139"><span class="linenos">1139</span></a>
</span><span id="MarkupLanguage.prettify_markup-1140"><a href="#MarkupLanguage.prettify_markup-1140"><span class="linenos">1140</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sequence</span><span class="si">}{</span><span class="n">_apply_macros</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1141"><a href="#MarkupLanguage.prettify_markup-1141"><span class="linenos">1141</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.prettify_markup-1142"><a href="#MarkupLanguage.prettify_markup-1142"><span class="linenos">1142</span></a>
</span><span id="MarkupLanguage.prettify_markup-1143"><a href="#MarkupLanguage.prettify_markup-1143"><span class="linenos">1143</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="k">if</span> <span class="n">in_sequence</span> <span class="k">else</span> <span class="s2">&quot;[&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1144"><a href="#MarkupLanguage.prettify_markup-1144"><span class="linenos">1144</span></a>            <span class="n">in_sequence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MarkupLanguage.prettify_markup-1145"><a href="#MarkupLanguage.prettify_markup-1145"><span class="linenos">1145</span></a>
</span><span id="MarkupLanguage.prettify_markup-1146"><a href="#MarkupLanguage.prettify_markup-1146"><span class="linenos">1146</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1147"><a href="#MarkupLanguage.prettify_markup-1147"><span class="linenos">1147</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1148"><a href="#MarkupLanguage.prettify_markup-1148"><span class="linenos">1148</span></a>                    <span class="n">applied_macros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.prettify_markup-1149"><a href="#MarkupLanguage.prettify_markup-1149"><span class="linenos">1149</span></a>
</span><span id="MarkupLanguage.prettify_markup-1150"><a href="#MarkupLanguage.prettify_markup-1150"><span class="linenos">1150</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="MarkupLanguage.prettify_markup-1151"><a href="#MarkupLanguage.prettify_markup-1151"><span class="linenos">1151</span></a>
</span><span id="MarkupLanguage.prettify_markup-1152"><a href="#MarkupLanguage.prettify_markup-1152"><span class="linenos">1152</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1153"><a href="#MarkupLanguage.prettify_markup-1153"><span class="linenos">1153</span></a>                    <span class="n">_pop_macro</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1154"><a href="#MarkupLanguage.prettify_markup-1154"><span class="linenos">1154</span></a>
</span><span id="MarkupLanguage.prettify_markup-1155"><a href="#MarkupLanguage.prettify_markup-1155"><span class="linenos">1155</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1156"><a href="#MarkupLanguage.prettify_markup-1156"><span class="linenos">1156</span></a>
</span><span id="MarkupLanguage.prettify_markup-1157"><a href="#MarkupLanguage.prettify_markup-1157"><span class="linenos">1157</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
</span><span id="MarkupLanguage.prettify_markup-1158"><a href="#MarkupLanguage.prettify_markup-1158"><span class="linenos">1158</span></a>                    <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_tags</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1159"><a href="#MarkupLanguage.prettify_markup-1159"><span class="linenos">1159</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">styles</span><span class="p">[</span><span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">]</span><span class="si">}</span><span class="s2">]/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MarkupLanguage.prettify_markup-1160"><a href="#MarkupLanguage.prettify_markup-1160"><span class="linenos">1160</span></a>                <span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1161"><a href="#MarkupLanguage.prettify_markup-1161"><span class="linenos">1161</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.prettify_markup-1162"><a href="#MarkupLanguage.prettify_markup-1162"><span class="linenos">1162</span></a>
</span><span id="MarkupLanguage.prettify_markup-1163"><a href="#MarkupLanguage.prettify_markup-1163"><span class="linenos">1163</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1164"><a href="#MarkupLanguage.prettify_markup-1164"><span class="linenos">1164</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1165"><a href="#MarkupLanguage.prettify_markup-1165"><span class="linenos">1165</span></a>
</span><span id="MarkupLanguage.prettify_markup-1166"><a href="#MarkupLanguage.prettify_markup-1166"><span class="linenos">1166</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage.prettify_markup-1167"><a href="#MarkupLanguage.prettify_markup-1167"><span class="linenos">1167</span></a>                <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1168"><a href="#MarkupLanguage.prettify_markup-1168"><span class="linenos">1168</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)]</span>
</span><span id="MarkupLanguage.prettify_markup-1169"><a href="#MarkupLanguage.prettify_markup-1169"><span class="linenos">1169</span></a>
</span><span id="MarkupLanguage.prettify_markup-1170"><a href="#MarkupLanguage.prettify_markup-1170"><span class="linenos">1170</span></a>                <span class="n">applied_macros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage.prettify_markup-1171"><a href="#MarkupLanguage.prettify_markup-1171"><span class="linenos">1171</span></a>
</span><span id="MarkupLanguage.prettify_markup-1172"><a href="#MarkupLanguage.prettify_markup-1172"><span class="linenos">1172</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1173"><a href="#MarkupLanguage.prettify_markup-1173"><span class="linenos">1173</span></a>                    <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1174"><a href="#MarkupLanguage.prettify_markup-1174"><span class="linenos">1174</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.prettify_markup-1175"><a href="#MarkupLanguage.prettify_markup-1175"><span class="linenos">1175</span></a>
</span><span id="MarkupLanguage.prettify_markup-1176"><a href="#MarkupLanguage.prettify_markup-1176"><span class="linenos">1176</span></a>                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># Not enough arguments</span>
</span><span id="MarkupLanguage.prettify_markup-1177"><a href="#MarkupLanguage.prettify_markup-1177"><span class="linenos">1177</span></a>                    <span class="k">pass</span>
</span><span id="MarkupLanguage.prettify_markup-1178"><a href="#MarkupLanguage.prettify_markup-1178"><span class="linenos">1178</span></a>
</span><span id="MarkupLanguage.prettify_markup-1179"><a href="#MarkupLanguage.prettify_markup-1179"><span class="linenos">1179</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.prettify_markup-1180"><a href="#MarkupLanguage.prettify_markup-1180"><span class="linenos">1180</span></a>                <span class="n">current_styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1181"><a href="#MarkupLanguage.prettify_markup-1181"><span class="linenos">1181</span></a>
</span><span id="MarkupLanguage.prettify_markup-1182"><a href="#MarkupLanguage.prettify_markup-1182"><span class="linenos">1182</span></a>            <span class="n">style_markup</span> <span class="o">=</span> <span class="n">styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">ttype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage.prettify_markup-1183"><a href="#MarkupLanguage.prettify_markup-1183"><span class="linenos">1183</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">style_markup</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkupLanguage.prettify_markup-1184"><a href="#MarkupLanguage.prettify_markup-1184"><span class="linenos">1184</span></a>
</span><span id="MarkupLanguage.prettify_markup-1185"><a href="#MarkupLanguage.prettify_markup-1185"><span class="linenos">1185</span></a>        <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">in_sequence</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a prettified (syntax-highlighted) markup str.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>text:</strong>  The markup-text to prettify.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Prettified markup. This markup, excluding its styles,
  remains valid markup.</p>
</blockquote>
</div>


                            </div>
                            <div id="MarkupLanguage.get_styled_plains" class="classattr">
                                        <input id="MarkupLanguage.get_styled_plains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_styled_plains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#StyledText">pytermgui.parser.StyledText</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MarkupLanguage.get_styled_plains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkupLanguage.get_styled_plains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkupLanguage.get_styled_plains-1187"><a href="#MarkupLanguage.get_styled_plains-1187"><span class="linenos">1187</span></a>    <span class="k">def</span> <span class="nf">get_styled_plains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">StyledText</span><span class="p">]:</span>
</span><span id="MarkupLanguage.get_styled_plains-1188"><a href="#MarkupLanguage.get_styled_plains-1188"><span class="linenos">1188</span></a>        <span class="sd">&quot;&quot;&quot;Gets all plain tokens within text, with their respective styles applied.</span>
</span><span id="MarkupLanguage.get_styled_plains-1189"><a href="#MarkupLanguage.get_styled_plains-1189"><span class="linenos">1189</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1190"><a href="#MarkupLanguage.get_styled_plains-1190"><span class="linenos">1190</span></a><span class="sd">        Args:</span>
</span><span id="MarkupLanguage.get_styled_plains-1191"><a href="#MarkupLanguage.get_styled_plains-1191"><span class="linenos">1191</span></a><span class="sd">            text: The ANSI-sequence containing string to find plains from.</span>
</span><span id="MarkupLanguage.get_styled_plains-1192"><a href="#MarkupLanguage.get_styled_plains-1192"><span class="linenos">1192</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1193"><a href="#MarkupLanguage.get_styled_plains-1193"><span class="linenos">1193</span></a><span class="sd">        Returns:</span>
</span><span id="MarkupLanguage.get_styled_plains-1194"><a href="#MarkupLanguage.get_styled_plains-1194"><span class="linenos">1194</span></a><span class="sd">            An iterator of `StyledText` objects, each yielded when a new plain token is found,</span>
</span><span id="MarkupLanguage.get_styled_plains-1195"><a href="#MarkupLanguage.get_styled_plains-1195"><span class="linenos">1195</span></a><span class="sd">            containing the styles that are relevant and active on the given plain.</span>
</span><span id="MarkupLanguage.get_styled_plains-1196"><a href="#MarkupLanguage.get_styled_plains-1196"><span class="linenos">1196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.get_styled_plains-1197"><a href="#MarkupLanguage.get_styled_plains-1197"><span class="linenos">1197</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1198"><a href="#MarkupLanguage.get_styled_plains-1198"><span class="linenos">1198</span></a>        <span class="k">def</span> <span class="nf">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1199"><a href="#MarkupLanguage.get_styled_plains-1199"><span class="linenos">1199</span></a>            <span class="sd">&quot;&quot;&quot;Applies given styles to text.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.get_styled_plains-1200"><a href="#MarkupLanguage.get_styled_plains-1200"><span class="linenos">1200</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1201"><a href="#MarkupLanguage.get_styled_plains-1201"><span class="linenos">1201</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1202"><a href="#MarkupLanguage.get_styled_plains-1202"><span class="linenos">1202</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1203"><a href="#MarkupLanguage.get_styled_plains-1203"><span class="linenos">1203</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1204"><a href="#MarkupLanguage.get_styled_plains-1204"><span class="linenos">1204</span></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1205"><a href="#MarkupLanguage.get_styled_plains-1205"><span class="linenos">1205</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1206"><a href="#MarkupLanguage.get_styled_plains-1206"><span class="linenos">1206</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1207"><a href="#MarkupLanguage.get_styled_plains-1207"><span class="linenos">1207</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1208"><a href="#MarkupLanguage.get_styled_plains-1208"><span class="linenos">1208</span></a>                    <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1209"><a href="#MarkupLanguage.get_styled_plains-1209"><span class="linenos">1209</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1210"><a href="#MarkupLanguage.get_styled_plains-1210"><span class="linenos">1210</span></a>                <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sequence</span> <span class="o">+</span> <span class="n">text</span>
</span><span id="MarkupLanguage.get_styled_plains-1211"><a href="#MarkupLanguage.get_styled_plains-1211"><span class="linenos">1211</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1212"><a href="#MarkupLanguage.get_styled_plains-1212"><span class="linenos">1212</span></a>            <span class="k">return</span> <span class="n">text</span>
</span><span id="MarkupLanguage.get_styled_plains-1213"><a href="#MarkupLanguage.get_styled_plains-1213"><span class="linenos">1213</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1214"><a href="#MarkupLanguage.get_styled_plains-1214"><span class="linenos">1214</span></a>        <span class="k">def</span> <span class="nf">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage.get_styled_plains-1215"><a href="#MarkupLanguage.get_styled_plains-1215"><span class="linenos">1215</span></a>            <span class="sd">&quot;&quot;&quot;Removes an unsetter from the list, returns the new list.&quot;&quot;&quot;</span>
</span><span id="MarkupLanguage.get_styled_plains-1216"><a href="#MarkupLanguage.get_styled_plains-1216"><span class="linenos">1216</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1217"><a href="#MarkupLanguage.get_styled_plains-1217"><span class="linenos">1217</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1218"><a href="#MarkupLanguage.get_styled_plains-1218"><span class="linenos">1218</span></a>                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tkn</span><span class="p">:</span> <span class="n">tkn</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">,</span> <span class="n">styles</span><span class="p">))</span>
</span><span id="MarkupLanguage.get_styled_plains-1219"><a href="#MarkupLanguage.get_styled_plains-1219"><span class="linenos">1219</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1220"><a href="#MarkupLanguage.get_styled_plains-1220"><span class="linenos">1220</span></a>            <span class="n">target_name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="MarkupLanguage.get_styled_plains-1221"><a href="#MarkupLanguage.get_styled_plains-1221"><span class="linenos">1221</span></a>            <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1222"><a href="#MarkupLanguage.get_styled_plains-1222"><span class="linenos">1222</span></a>                <span class="c1"># bold &amp; dim unsetters represent the same character, so we have</span>
</span><span id="MarkupLanguage.get_styled_plains-1223"><a href="#MarkupLanguage.get_styled_plains-1223"><span class="linenos">1223</span></a>                <span class="c1"># to treat them the same way.</span>
</span><span id="MarkupLanguage.get_styled_plains-1224"><a href="#MarkupLanguage.get_styled_plains-1224"><span class="linenos">1224</span></a>                <span class="n">style_name</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="MarkupLanguage.get_styled_plains-1225"><a href="#MarkupLanguage.get_styled_plains-1225"><span class="linenos">1225</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1226"><a href="#MarkupLanguage.get_styled_plains-1226"><span class="linenos">1226</span></a>                <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;dim&quot;</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1227"><a href="#MarkupLanguage.get_styled_plains-1227"><span class="linenos">1227</span></a>                    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
</span><span id="MarkupLanguage.get_styled_plains-1228"><a href="#MarkupLanguage.get_styled_plains-1228"><span class="linenos">1228</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1229"><a href="#MarkupLanguage.get_styled_plains-1229"><span class="linenos">1229</span></a>                <span class="k">if</span> <span class="n">style_name</span> <span class="o">==</span> <span class="n">target_name</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1230"><a href="#MarkupLanguage.get_styled_plains-1230"><span class="linenos">1230</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1231"><a href="#MarkupLanguage.get_styled_plains-1231"><span class="linenos">1231</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1232"><a href="#MarkupLanguage.get_styled_plains-1232"><span class="linenos">1232</span></a>                <span class="k">elif</span> <span class="p">(</span>
</span><span id="MarkupLanguage.get_styled_plains-1233"><a href="#MarkupLanguage.get_styled_plains-1233"><span class="linenos">1233</span></a>                    <span class="n">style_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1234"><a href="#MarkupLanguage.get_styled_plains-1234"><span class="linenos">1234</span></a>                    <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MACRO</span>
</span><span id="MarkupLanguage.get_styled_plains-1235"><a href="#MarkupLanguage.get_styled_plains-1235"><span class="linenos">1235</span></a>                <span class="p">):</span>
</span><span id="MarkupLanguage.get_styled_plains-1236"><a href="#MarkupLanguage.get_styled_plains-1236"><span class="linenos">1236</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1237"><a href="#MarkupLanguage.get_styled_plains-1237"><span class="linenos">1237</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1238"><a href="#MarkupLanguage.get_styled_plains-1238"><span class="linenos">1238</span></a>                <span class="k">elif</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1239"><a href="#MarkupLanguage.get_styled_plains-1239"><span class="linenos">1239</span></a>                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1240"><a href="#MarkupLanguage.get_styled_plains-1240"><span class="linenos">1240</span></a>                    <span class="k">if</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;fg&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1241"><a href="#MarkupLanguage.get_styled_plains-1241"><span class="linenos">1241</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1242"><a href="#MarkupLanguage.get_styled_plains-1242"><span class="linenos">1242</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1243"><a href="#MarkupLanguage.get_styled_plains-1243"><span class="linenos">1243</span></a>                    <span class="k">elif</span> <span class="n">target_name</span> <span class="o">==</span> <span class="s2">&quot;bg&quot;</span> <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1244"><a href="#MarkupLanguage.get_styled_plains-1244"><span class="linenos">1244</span></a>                        <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1245"><a href="#MarkupLanguage.get_styled_plains-1245"><span class="linenos">1245</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1246"><a href="#MarkupLanguage.get_styled_plains-1246"><span class="linenos">1246</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="MarkupLanguage.get_styled_plains-1247"><a href="#MarkupLanguage.get_styled_plains-1247"><span class="linenos">1247</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1248"><a href="#MarkupLanguage.get_styled_plains-1248"><span class="linenos">1248</span></a>        <span class="k">def</span> <span class="nf">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
</span><span id="MarkupLanguage.get_styled_plains-1249"><a href="#MarkupLanguage.get_styled_plains-1249"><span class="linenos">1249</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">styles</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="MarkupLanguage.get_styled_plains-1250"><a href="#MarkupLanguage.get_styled_plains-1250"><span class="linenos">1250</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1251"><a href="#MarkupLanguage.get_styled_plains-1251"><span class="linenos">1251</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1252"><a href="#MarkupLanguage.get_styled_plains-1252"><span class="linenos">1252</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1253"><a href="#MarkupLanguage.get_styled_plains-1253"><span class="linenos">1253</span></a>            <span class="k">return</span> <span class="n">styles</span>
</span><span id="MarkupLanguage.get_styled_plains-1254"><a href="#MarkupLanguage.get_styled_plains-1254"><span class="linenos">1254</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1255"><a href="#MarkupLanguage.get_styled_plains-1255"><span class="linenos">1255</span></a>        <span class="n">styles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MarkupLanguage.get_styled_plains-1256"><a href="#MarkupLanguage.get_styled_plains-1256"><span class="linenos">1256</span></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="MarkupLanguage.get_styled_plains-1257"><a href="#MarkupLanguage.get_styled_plains-1257"><span class="linenos">1257</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1258"><a href="#MarkupLanguage.get_styled_plains-1258"><span class="linenos">1258</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">styles</span><span class="p">)):</span>
</span><span id="MarkupLanguage.get_styled_plains-1259"><a href="#MarkupLanguage.get_styled_plains-1259"><span class="linenos">1259</span></a>                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">COLOR</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1260"><a href="#MarkupLanguage.get_styled_plains-1260"><span class="linenos">1260</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1261"><a href="#MarkupLanguage.get_styled_plains-1261"><span class="linenos">1261</span></a>                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1262"><a href="#MarkupLanguage.get_styled_plains-1262"><span class="linenos">1262</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1263"><a href="#MarkupLanguage.get_styled_plains-1263"><span class="linenos">1263</span></a>                        <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span> <span class="o">!=</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1264"><a href="#MarkupLanguage.get_styled_plains-1264"><span class="linenos">1264</span></a>                            <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1265"><a href="#MarkupLanguage.get_styled_plains-1265"><span class="linenos">1265</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1266"><a href="#MarkupLanguage.get_styled_plains-1266"><span class="linenos">1266</span></a>                        <span class="n">styles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="MarkupLanguage.get_styled_plains-1267"><a href="#MarkupLanguage.get_styled_plains-1267"><span class="linenos">1267</span></a>                        <span class="k">break</span>
</span><span id="MarkupLanguage.get_styled_plains-1268"><a href="#MarkupLanguage.get_styled_plains-1268"><span class="linenos">1268</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1269"><a href="#MarkupLanguage.get_styled_plains-1269"><span class="linenos">1269</span></a>                    <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1270"><a href="#MarkupLanguage.get_styled_plains-1270"><span class="linenos">1270</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1271"><a href="#MarkupLanguage.get_styled_plains-1271"><span class="linenos">1271</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1272"><a href="#MarkupLanguage.get_styled_plains-1272"><span class="linenos">1272</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1273"><a href="#MarkupLanguage.get_styled_plains-1273"><span class="linenos">1273</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">LINK</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1274"><a href="#MarkupLanguage.get_styled_plains-1274"><span class="linenos">1274</span></a>                <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1275"><a href="#MarkupLanguage.get_styled_plains-1275"><span class="linenos">1275</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="MarkupLanguage.get_styled_plains-1276"><a href="#MarkupLanguage.get_styled_plains-1276"><span class="linenos">1276</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1277"><a href="#MarkupLanguage.get_styled_plains-1277"><span class="linenos">1277</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">PLAIN</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1278"><a href="#MarkupLanguage.get_styled_plains-1278"><span class="linenos">1278</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1279"><a href="#MarkupLanguage.get_styled_plains-1279"><span class="linenos">1279</span></a>                <span class="k">yield</span> <span class="n">StyledText</span><span class="p">(</span><span class="n">_apply_styles</span><span class="p">(</span><span class="n">styles</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="MarkupLanguage.get_styled_plains-1280"><a href="#MarkupLanguage.get_styled_plains-1280"><span class="linenos">1280</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_position</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1281"><a href="#MarkupLanguage.get_styled_plains-1281"><span class="linenos">1281</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1282"><a href="#MarkupLanguage.get_styled_plains-1282"><span class="linenos">1282</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1283"><a href="#MarkupLanguage.get_styled_plains-1283"><span class="linenos">1283</span></a>            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">is</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">UNSETTER</span><span class="p">:</span>
</span><span id="MarkupLanguage.get_styled_plains-1284"><a href="#MarkupLanguage.get_styled_plains-1284"><span class="linenos">1284</span></a>                <span class="n">styles</span> <span class="o">=</span> <span class="n">_pop_unsetter</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span>
</span><span id="MarkupLanguage.get_styled_plains-1285"><a href="#MarkupLanguage.get_styled_plains-1285"><span class="linenos">1285</span></a>                <span class="k">continue</span>
</span><span id="MarkupLanguage.get_styled_plains-1286"><a href="#MarkupLanguage.get_styled_plains-1286"><span class="linenos">1286</span></a>
</span><span id="MarkupLanguage.get_styled_plains-1287"><a href="#MarkupLanguage.get_styled_plains-1287"><span class="linenos">1287</span></a>            <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets all plain tokens within text, with their respective styles applied.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>text:</strong>  The ANSI-sequence containing string to find plains from.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>An iterator of <code><a href="#StyledText">StyledText</a></code> objects, each yielded when a new plain token is found,
  containing the styles that are relevant and active on the given plain.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="markup">
                    <div class="attr variable">
            <span class="name">markup</span><span class="default_value"> = &lt;<a href="#MarkupLanguage">pytermgui.parser.MarkupLanguage</a> object&gt;</span>

        
    </div>
    <a class="headerlink" href="#markup"></a>
    
    

                </section>
                <section id="tim">
                    <div class="attr variable">
            <span class="name">tim</span><span class="default_value"> = &lt;<a href="#MarkupLanguage">pytermgui.parser.MarkupLanguage</a> object&gt;</span>

        
    </div>
    <a class="headerlink" href="#tim"></a>
    
    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>